
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The Metropolis algorithm &#8212; Applying Maths in the Chemical &amp; Biomolecular Sciences</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Solutions Q1 - 6" href="monte-carlo-answers1-6.html" />
    <link rel="prev" title="Questions 11 - 17" href="monte-carlo-Q11-17.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/book-cover.jpg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Applying Maths in the Chemical & Biomolecular Sciences</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Applying Maths in the Chemical and Biomolecular Sciences.
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../chapter-1/chapter1-intro.html">
   1. Numbers, Equations, Operators, and Algorithms.
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-1/chapter1-A.html">
     Numbers to Algorithms.
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-1/chapter1-Q1-7.html">
     Questions 1 - 7
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-1/chapter1-B.html">
     Trig, hyperbolic and inverse functions, waves, polar coordinates &amp; factorials
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-1/chapter1-Q8-16.html">
     Questions 8 - 16
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-1/chapter1-C.html">
     Sophisticated Counting.
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-1/chapter1-Q17-34.html">
     Questions 17 - 34
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-1/chapter1-D.html">
     Modulo arithmetic,
     <span class="math notranslate nohighlight">
      \(\delta\)
     </span>
     functions, types of  series &amp;  estimating quantities
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-1/chapter1-Q35-39.html">
     Questions 35 - 39
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-1/chapter1-answers-1-7.html">
     Solutions Q1 - 7
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-1/chapter1-answers-8-16.html">
     Solutions Q8 - 16
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-1/chapter1-answers-17-34.html">
     Solutions Q17 - 34
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-1/chapter1-answers-35-39.html">
     Solutions Q35 - 39
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../chapter-2/chapter2-intro.html">
   2. Complex numbers.
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-2/chapter2-A.html">
     Real, imaginary, conjugate and modulus
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-2/chapter2-Q-1-9.html">
     Questions 1 - 9
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-2/chapter2-B.html">
     De Moivre’s theorem and integer powers of complex numbers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-2/chapter2-Q-10-13.html">
     Questions 10 -13
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-2/chapter2-C.html">
     Euler’s theorem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-2/chapter2-Q-14-27.html">
     Questions 14 - 27
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-2/chapter2-answers.html">
     Solutions Q1 - 27
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../chapter-3/differen-intro.html">
   3. Differentiation.
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-A.html">
     Differentiation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-B.html">
     Trig functions, logs, power, reciprocals and integrals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-C-Q-4-11.html">
     Questions 1-11
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-D.html">
     Product rule and function of function or chain rule.
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-E-Q-12-42.html">
     Questions 12-42
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-F.html">
     Limits, l’Hopital’s rule, max and min and Calculus of Variations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-G-Q-43-73.html">
     Questions 43 - 73
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-H.html">
     Numerically finding the roots of an equation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-I-Q-74-85.html">
     Questions 74 - 85
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-J.html">
     Minimizing or maximizing with constraints: Lagrange Undetermined Multipliers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-K-Q-86-92.html">
     Questions 86 - 92
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-L.html">
     Partial differentiation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-M-Q-93-114.html">
     Questions 93-114
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-M1.html">
     Differentiation of vectors
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-N-answers-1-11.html">
     Solutions Q 1-11
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-O-answers-12-42.html">
     Solutions Q 12-42
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-P-answers-43-73.html">
     Solutions Q 43 - 73
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-Q-answers-74-85.html">
     Solutions Q 74 - 85
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-R-answers-86-92.html">
     Solutions Q 86 - 94
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-S-answers-93-114.html">
     Solutions Q 93-114
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../chapter-4/integration-intro.html">
   4. Integration.
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-A.html">
     Integration basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-Q1-14.html">
     Questions 1-14
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-B.html">
     Integration by substitution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-Q15-30.html">
     Questions 15-30
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-C.html">
     Using parametric equations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-Q31-48.html">
     Questions 31 - 48
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-D.html">
     Calculating an Average Value.
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-Q49-72.html">
     Questions 49 - 72
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-E.html">
     The Variational Method in Quantum Mechanics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-Q73-77.html">
     Questions 73 - 77
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-F.html">
     Multiple integrals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-Q78-86.html">
     Questions 78 - 86
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-G.html">
     Calculating the energy of a chemical bond using molecular orbitals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-H.html">
     Line integrals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-Q87-96.html">
     Questions 87 - 96
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-answers-1-14.html">
     Solutions Q1 - 14
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-answers-15-30.html">
     Solutions Q15 - 30
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-answers-31-48.html">
     Solutions Q31 - 48
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-answers-49-72.html">
     Solutions Q49 - 72
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-answers-73-96.html">
     Solutions Q73 - 96
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../chapter-5/chapter-5-intro.html">
   5. Summations, Series and expansion of Functions.
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-5/chapter-5-A.html">
     Series, averages, partition functions, DNA melting, atom entropy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-5/chapter-5-B-Q1-13.html">
     Questions 1 - 13
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-5/chapter-5-E.html">
     Maclaurin and Taylor series expansions. Paramagnetic spins. Euler-Maclaurin formula.
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-5/chapter-5-F-Q14-34.html">
     Questions 14 - 34
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-5/chapter-5-G-Q35-44.html">
     Questions 35 - 44
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-5/chapter-5-perturbation-A.html">
     Perturbation Theory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-5/chapter-5-perturbation-B-Q45-48.html">
     Questions 45 - 48
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-5/chapter-5-perturbation-C.html">
     Quantum superposition and wavepackets.
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-5/chapter-5-perturbation-D-Q49-52.html">
     Questions 49 - 52
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-5/chapter-5-answers-1-7.html">
     Solutions Q 1 - 7
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-5/chapter-5-answers-8-13.html">
     Solutions Q8 - 13
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-5/chapter-5-answers-14-26.html">
     Solutions Q 14 - 26
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-5/chapter-5-answers-27-32.html">
     Solutions Q27 - 34
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-5/chapter-5-answers-33-44.html">
     Solutions Q33 - 44
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-5/chapter-5-answers-45-52.html">
     Solutions Q45 - 52
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../chapter-6/vectors-intro.html">
   6. Vectors.
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-A.html">
     Vector basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-Q1-24.html">
     Questions 1 - 24
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-B.html">
     Projections and components
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-Q25-32.html">
     Questions 25 - 32
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-C.html">
     Axes need not be right-angled or of equal length
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-Q33-38.html">
     Questions 33 - 38
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-D.html">
     Basis sets with more than three dimensions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-Q39-46.html">
     Questions 39 - 46
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-E.html">
     Cross product or vector product
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-Q47-52.html">
     Questions 47 - 52
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-F.html">
     Torsion or dihedral angles
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-Q53-48.html">
     Questions 53 - 48
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-G.html">
     Torque and angular momentum
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-Q59-61.html">
     Questions 59 - 61
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-answers-Q1-24.html">
     Solutions Q1 - 24
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-answers-Q25-32.html">
     Solutions Q25 - 32
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-answers-Q33-38.html">
     Solutions Q33 - 38
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-answers-Q39-46.html">
     Solutions Q39 - 46
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-answers-Q47-52.html">
     Solutions Q47 - 52
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-answers-Q53-61.html">
     Solutions Q53 - 61
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../chapter-7/matrices-intro.html">
   7. Matrices
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-A.html">
     Determinants
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-Q1-10.html">
     Questions  1 - 10
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-B.html">
     Matrices
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-Q11-16.html">
     Questions  11 - 16
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-C.html">
     Molecular Group Theory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-Q17-30.html">
     Questions  17 - 30
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-D.html">
     Rotation matrices: moving molecules
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-Q31-34.html">
     Questions 31 - 34
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-E.html">
     Matrices in optics and designing laser cavities
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-Q35-39.html">
     Questions 35 - 39
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-F.html">
     Polarizing optics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-Q40-44.html">
     Questions 40 - 44
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-G.html">
     Solving equations using matrices. Eigenvectors &amp; Eigenvalues.
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-Q45-50.html">
     Questions 45 - 50
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-H.html">
     Rate equations and Chemical Kinetics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-Q51-54.html">
     Questions 51 - 54
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-I.html">
     Molecular vibrations and pendulums
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-Q55-58.html">
     Questions 55 - 58
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-J.html">
     Moments of Inertia
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-Q59-60.html">
     Questions 59 - 62
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-K.html">
     Calculating a bond length using moments of inertia
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-Q61.html">
     Question 61
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-L.html">
     Principal axes for Moments of Inertia
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-Q62.html">
     Question 62
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-answersQ1-10.html">
     Solutions Q1 - 10
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-answersQ11-16.html">
     Solutions Q11 - 16
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-answersQ17-30.html">
     Solutions Q17 - 30
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-answersQ31-34.html">
     Solutions Q31 - 34
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-answersQ35-39.html">
     Solutions Q35 - 39
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-answersQ40-44.html">
     Solutions Q40 - 44
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-answersQ45-50.html">
     Solutions Q45 - 50
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-answersQ51-54.html">
     Solutions Q51 - 54
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-answersQ55-58.html">
     Solutions Q55 - 58
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-answersQ59-61.html">
     Solutions Q59 - 61
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../chapter-8/matricesQM-intro.html">
   8. Matrices in Quantum Mechanics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-8/matricesQM-A.html">
     Matrices in Quantum Mechanics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-8/matricesQM-Q1-7.html">
     Questions 1 - 7
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-8/matricesQM-B.html">
     Basis sets and bra-ket algebra
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-8/matricesQM-Q8-12.html">
     Questions 8 - 12
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-8/matricesQM-C.html">
     Continuous basis sets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-8/matricesQM-answers1-7.html">
     Solutions Q1 - 7
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-8/matricesQM-answers8-12.html">
     Solutions Q8 - 12
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../chapter-9/Fourier-intro.html">
   9. Fourier Series and Transforms.
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-9/Fourier-A-B.html">
     Fourier series, Gibbs phenomenon, generalised series.
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-9/Fourier-questions-1-6.html">
     Questions 1 - 6
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-9/Fourier-C.html">
     Fourier Transforms
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-9/Fourier-questions-7-15.html">
     Questions 7 - 15
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-9/Fourier-D.html">
     Convolution and Autocorrelation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-9/Fourier-questions-16-21.html">
     Questions 16 - 21
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-9/Fourier-E.html">
     Discrete Fourier  (DFT)  and Fast Fourier transforms (FFT)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-9/Fourier-F.html">
     The Hadamard Transform: Encoding and Decoding
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-9/Fourier-answers-1-6.html">
     Solutions Q 1 - 6
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-9/Fourier-answers-7-15.html">
     Solutions Q 7 - 15
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-9/Fourier-answers-16-21.html">
     Solutions Q 16 - 21
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-9/Fourier-2D-Diffraction.html">
     The Fourier transform in two dimensions: images and x-ray Diffraction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-9/Fourier-tomography.html">
     Computed Tomography
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../chapter-10/Diff-eqns-intro.html">
   10. Differential Equations.
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-10/Diff-eqns-A.html">
     Differential Equations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-10/Diff-eqns-Q1-23.html">
     Questions 1 - 23
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-10/Diff-eqns-B.html">
     Integrating factors can solve differential equations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-10/Diff-eqns-C.html">
     The ‘D’ operator.  Solving linear differential equations with constant coefficients
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-10/Diff-eqns-D.html">
     Simultaneous equations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-10/Diff-eqns-Q24-37.html">
     Questions 24 - 37
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-10/Diff-eqns-E.html">
     Linear equations with variable coefficients
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-10/Diff-eqns-F.html">
     Partial Differential Equations, PDE
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-10/Diff-eqns-G.html">
     PDE examples continued
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-10/Diff-eqns-answers-1-21.html">
     Solutions Q1 - 21
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-10/Diff-eqns-answers-22-37.html">
     Solutions Q22 - 37
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../chapter-11/num-methods-intro.html">
   11. Numerical Methods
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-11/num-methods-A.html">
     Numerical Methods
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-11/num-methods-Q1-7.html">
     Questions 1 - 7
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-11/num-methods-B.html">
     Numerical solution of differential equations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-11/num-methods-Q8-12.html">
     Questions 8 - 12
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-11/num-methods-C.html">
     Coupled equations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-11/num-methods-Q13-16.html">
     Questions 13 - 16
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-11/num-methods-D.html">
     The phase plane, nullclines, and stable points
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-11/num-methods-Q17-20.html">
     Questions 17 - 20
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-11/num-methods-E.html">
     Reaction schemes with feedback
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-11/num-methods-Q21-34.html">
     Questions 21 - 34
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-11/num-methods-F.html">
     Boundary value problems.
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-11/num-methods-Q35-40.html">
     Questions 35 - 40
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-11/num-methods-answers1-7.html">
     Solutions Q1 - 7
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-11/num-methods-answers8-12.html">
     Solutions Q8 - 12
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-11/num-methods-answers13-16.html">
     Solutions Q13 - 16
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-11/num-methods-answers17-20.html">
     Solutions Q17 - 20
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-11/num-methods-answers21-34.html">
     Solutions Q21 - 34
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-11/num-methods-answers35-40.html">
     Solutions Q35 - 40
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="monte-carlo-intro.html">
   12. Monte Carlo Methods
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="monte-carlo-A.html">
     Monte - Carlo Methods
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="monte-carlo-Q1-6.html">
     Questions 1 - 6
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="monte-carlo-B.html">
     Solving rate equations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="monte-carlo-Q7-10.html">
     Questions 7 - 10
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="monte-carlo-CC.html">
     Monte Carlo Simulations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="monte-carlo-C.html">
     Energy transfer. Autocatalytic reaction and spreading of fires
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="monte-carlo-Q11-17.html">
     Questions 11 - 17
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     The Metropolis algorithm
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="monte-carlo-answers1-6.html">
     Solutions Q1 - 6
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="monte-carlo-answers7-10.html">
     Solutions Q7 - 10
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="monte-carlo-answers11-17.html">
     Solutions Q11 - 17
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../chapter-13/analysis-intro.html">
   13. Data Analysis
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
  <label for="toctree-checkbox-13">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-13/analysis-A.html">
     Characterizing experimental data. Accuracy, precision, mean and standard deviation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-13/analysis-Q1-3.html">
     Questions 1 - 3
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-13/analysis-B.html">
     Modelling data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-13/analysis-Q4-9.html">
     Questions 4 - 9
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-13/analysis-C.html">
     Modelling data is simpler using matrices
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-13/analysis-Q10-11.html">
     Questions 10 - 13
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-13/analysis-D.html">
     Non-linear least squares. Least absolute deviation. Principal component analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-13/analysis-answers1-11.html">
     Solutions Q1 -11
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../chapter-1/chapter1-E.html">
   SI units, Rounding, converting units &amp; Glossary.
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../references/References.html">
   References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../references/Python%20crib.html">
   Some basic Python instructions with a few examples.
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/chapter-12/monte-carlo-D.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/chapter-12/monte-carlo-D.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction-to-the-metropolis-algorithm">
   Introduction to the Metropolis algorithm
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#basis-of-the-algorithm">
   Basis of the Algorithm
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#average-energy-heat-capacity-and-displacement-of-a-harmonic-oscillator">
   6.1 Average energy,  heat capacity  and displacement of a harmonic oscillator
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#maxwell-distribution">
     <strong>
      Maxwell distribution
     </strong>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ising-spin-model">
   6.2 Ising spin model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#d-spin-model">
   1D spin model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#calculating-the-entropy">
     <strong>
      Calculating the Entropy
     </strong>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#phase-change">
     <strong>
      Phase Change
     </strong>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#magnetisation">
     <strong>
      Magnetisation
     </strong>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#algebraic-calculation-of-1d-ising-spin-energy">
     <strong>
      Algebraic calculation of 1D Ising spin energy
     </strong>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   2D Spin model
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="the-metropolis-algorithm">
<h1>The Metropolis algorithm<a class="headerlink" href="#the-metropolis-algorithm" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">init_printing</span><span class="p">()</span>                         <span class="c1"># allows printing of SymPy results in typeset maths format</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">})</span>  <span class="c1"># set font size for plots</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="introduction-to-the-metropolis-algorithm">
<h2>Introduction to the Metropolis algorithm<a class="headerlink" href="#introduction-to-the-metropolis-algorithm" title="Permalink to this headline">¶</a></h2>
<p>This is a extremely important algorithm because it speeds up many calculations bringing them into the realm of possibilities. The algorithm calculates average properties by using Monte-Carlo methods to preferentially sample important contributions to the result and thus does not waste time on unimportant ones. In illustrating this algorithm examples from statistical thermodynamics and quantum mechanics are used.</p>
<p>In statistical mechanics, if the partition function or ‘sum over states’ <span class="math notranslate nohighlight">\(Z\)</span> is calculated, all other thermodynamic properties such as internal energy, entropy or heat capacity, can be evaluated. For example, the internal energy <span class="math notranslate nohighlight">\(U\)</span> at constant volume is</p>
<div class="math notranslate nohighlight">
\[\displaystyle U=U_0+k_BT^2\frac{\partial \ln(Z)}{\partial T}\bigg|_V\]</div>
<p>where <span class="math notranslate nohighlight">\(U_0\)</span> is the internal energy at <span class="math notranslate nohighlight">\(T=0\)</span>.  As a result, a great deal of attention is paid in textbooks to evaluating <span class="math notranslate nohighlight">\(Z\)</span> for different problems, such as the harmonic oscillator or rigid rotor. If a thermodynamic ‘system’ is in contact with a heat bath, then the canonical (ensemble) partition function <span class="math notranslate nohighlight">\(Z\)</span> (at constant <span class="math notranslate nohighlight">\(N,\; V,\; T\)</span>) is defined as the ‘sum over states’ hence</p>
<div class="math notranslate nohighlight">
\[\displaystyle Z = \sum_n g_ne^{-E_n/k_BT}\]</div>
<p>where the energy of level or state <span class="math notranslate nohighlight">\(n\)</span> is <span class="math notranslate nohighlight">\(E_n,\; k_B\)</span> is Boltzmann’s constant, and <span class="math notranslate nohighlight">\(T\)</span> the temperature. The degeneracy of level <span class="math notranslate nohighlight">\(n\)</span> is <span class="math notranslate nohighlight">\(g_n\)</span>.</p>
<p>The heat capacity <span class="math notranslate nohighlight">\(C_V\)</span> be calculated by differentiating <span class="math notranslate nohighlight">\(U\)</span>; then using <span class="math notranslate nohighlight">\(S =\int C_V/TdT\)</span> the entropy is obtained as</p>
<div class="math notranslate nohighlight">
\[\displaystyle S=\frac{U-U_0}{T}+k_B\ln(Z)\]</div>
<p>There is, however, another way of calculating internal energy and heat capacity, and this is via the relationships <span class="math notranslate nohighlight">\(\langle E\rangle \equiv U - U_0\)</span>, giving</p>
<div class="math notranslate nohighlight">
\[\displaystyle  C_V=\frac{1}{k_BT^2}\left( \langle E^2 \rangle -  \langle E \rangle^2 \right) \]</div>
<p>where <span class="math notranslate nohighlight">\(\langle E \rangle\)</span> is the average energy and <span class="math notranslate nohighlight">\(\langle E^2 \rangle\)</span> is the average of the square of the energy. If the partition function can be calculated, then these averages  are not needed. In many cases, however, there are obstacles to calculating the partition function and then the Metropolis algorithm can be used.</p>
<p>The harmonic oscillator’s energies are <span class="math notranslate nohighlight">\(E_n = h\nu(n + 1/2)\)</span>, the quantum numbers <span class="math notranslate nohighlight">\(n = 1, \;2, \;3,\cdots\)</span>, and levels are singly degenerate; <span class="math notranslate nohighlight">\(g_n = 1\)</span>. The summation forming the partition function can be evaluated algebraically, but even if no algebraic solution was forthcoming, such as is the case for the anharmonic oscillator, <span class="math notranslate nohighlight">\(Z\)</span> could be evaluated numerically because with increasing energy the exponential terms very rapidly become insignificant and contribute negligibly to the total sum. In practice, the summation has a limited, rather than infinite, number of terms. The small value of terms when the energy is large can be appreciated by comparing the <span class="math notranslate nohighlight">\(n = 0\)</span> term with that when <span class="math notranslate nohighlight">\(n = 15\)</span> where clearly <span class="math notranslate nohighlight">\(\displaystyle e^{-h\nu/2k_BT} \gg e^{-31h\nu/2k_BT}\)</span>; the ratio of the two terms is <span class="math notranslate nohighlight">\(\approx 1330\)</span>. This ratio increases dramatically as <span class="math notranslate nohighlight">\(\nu\)</span> increases or <span class="math notranslate nohighlight">\(T\)</span> decreases.</p>
<p>Now consider a more involved case of calculating the partition function for rotation around bonds in a protein. The purpose of this would be to estimate the lowest energy configuration and so the folded structure of the protein from its amino acid sequence<span class="math notranslate nohighlight">\(^*\)</span>. Suppose that there are 100 amino acids in the protein and the interaction energy between adjacent amino acids, caused by bond rotations, can take only three values, then there are <span class="math notranslate nohighlight">\(3^{100} \approx 5 \cdot 10^{47}\)</span> configurations to calculate! Unlike the harmonic oscillator, there are now only three energies to consider, and these are similar in value. However, there are so many combinations of these that the partition function cannot be estimated by summation because the summation does not tend to a limit as more terms are added. This is quite unlike the harmonic oscillator, where terms become progressively and rapidly smaller as more are added. The number of configurations, <span class="math notranslate nohighlight">\(5 \cdot 10^{47}\)</span>, may not seem so large; large numbers can easily be imagined, Avogadro’s number for instance, or even larger a googol <span class="math notranslate nohighlight">\(10^{100}\)</span> or a googolplex <span class="math notranslate nohighlight">\(\displaystyle 10^{10^{100}}\)</span>, for example. To put our number into context, there have only been <span class="math notranslate nohighlight">\(\approx 4 \cdot 10^{17}\)</span> s since the universe was created, and even if it were possible with a supercomputer to calculate <span class="math notranslate nohighlight">\(10^{15}\)</span> configurations each second, this single calculation would still take longer than the age of the universe to complete. Quite a challenge!</p>
<p><span class="math notranslate nohighlight">\(^*\)</span>( The problem is more complicated than this because folding is cooperative, but we shall suppose that we do not know this. The allowed and forbidden angles, which are those with large steric repulsion, produce the Ramachandran plot, which shows how much <span class="math notranslate nohighlight">\(\alpha\)</span>-helix, <span class="math notranslate nohighlight">\(\beta\)</span>-sheet, and random coil a protein contains. See Chapter 6.20 for a description of how to calculate this from the X-ray structure.)</p>
<p>A second example is the Ising spin model problem studied by physicists. In this, a two- or three-dimensional grid of paramagnetic transition metal atoms is imagined either with or without an external magnetic field. The unpaired electrons have a spin that is either ‘up’ or ‘down’. The problem is to find the minimum energy, magnetization, or spin heat capacity when the spins interact with one another and with an external magnetic field. If the grid of atoms is small, such as <span class="math notranslate nohighlight">\(10 \times 10\)</span>, as each atom can have only one of two spin states, there are <span class="math notranslate nohighlight">\(2^{100}\)</span> or <span class="math notranslate nohighlight">\(\approx 10^{30}\)</span> configurations to search to find the minimum energy; again a computational disaster. Two quantum states are present for each spin, which are similar in energy. The total energy for any configuration is the sum of all these individual but similar terms. Again, the partition function summation does not obviously tend to a limit as it does in the harmonic oscillator case, and hence, all configurations have to be evaluated. Two configurations of the <span class="math notranslate nohighlight">\(2^{256}\approx 10^{77}\)</span> possible ones in a <span class="math notranslate nohighlight">\(16 \times 16\)</span> lattice of spins, are shown in Figure 20.</p>
<p>The Metropolis algorithm is a Monte Carlo method that allows various average properties to be calculated, such as energy and magnetization, by sampling mainly those configurations that are important contributors to the average value; see Metropolis et al. (1953), Frenkel &amp; Smit (1996), Newman &amp; Barkema (1999) and Krauth (2006). The algorithm is general and can be used to perform ray-tracing in computer graphics and to work out the ‘travelling salesman’ problem, which is to find the shortest route when visiting several cities. The biasing in this case is based on how far the next city is from the one you are presently at, and so gives a very low weighting to routes that zigzag the country compared to those that visit neighbours.</p>
<p>Suppose, that instead of calculating the partition function, the energy or some other quantity could be calculated directly. If this quantity is called <span class="math notranslate nohighlight">\(Q\)</span>, the equation to evaluate the average is the same as has been met before (Chapter 4.8.2) and is</p>
<div class="math notranslate nohighlight">
\[\displaystyle  \langle Q \rangle =\frac{\int Q P(x)dx}{\int P(x)dx}\]</div>
<p>where <span class="math notranslate nohighlight">\(P(x)\)</span> is a probability distribution and in the Metropolis algorithm the Boltzmann distribution is used which means that sampling is energy biased. If energy levels are discrete, the integral can be replaced with a summation. Alternatively, if only finite changes to a parameter are possible, a spin changing from <span class="math notranslate nohighlight">\(-1/2\)</span> to <span class="math notranslate nohighlight">\(1/2\)</span> for example, then the integral can also be replaced with a sum. The average, or expectation value of <span class="math notranslate nohighlight">\(Q\)</span> becomes</p>
<div class="math notranslate nohighlight">
\[\displaystyle  \langle Q \rangle =\frac{\sum_n Q_n e^{-E_n/k_BT}}{\sum_n e^{-E_n/k_BT}}=\frac{\sum_n Q_n e^{-E_n/k_BT}}{Z}\tag{13a}\]</div>
<p>where <span class="math notranslate nohighlight">\(Z\)</span> is the partition function.</p>
</div>
<div class="section" id="basis-of-the-algorithm">
<h2>Basis of the Algorithm<a class="headerlink" href="#basis-of-the-algorithm" title="Permalink to this headline">¶</a></h2>
<p>The Metropolis algorithm allows an estimation of the ratio of the two sums to be made in an efficient way. This avoids having to calculate <span class="math notranslate nohighlight">\(Z\)</span>, which, as we have seen, may be impossible. The algorithm overcomes the necessity to search all the ‘phase space’, as configurations are generically called, and biases the random guessing of which configuration to add to the total, by using the Boltzmann distribution of energies. In doing this, the algorithm tries to add to the estimate of <span class="math notranslate nohighlight">\(Q\)</span> only those configurations contributing significantly to its value and, in doing so, performs a random walk among the configurations; see Figure 12 for a picture of two configurations. This random walk is also called a <em>Markov process</em>. This is defined as a process whereby a ‘system’ goes from one state to another in a random fashion, but has no memory of its previous condition.</p>
<p>To sample points in configuration space, according to the Boltzmann distribution, it is sufficient, but not necessary, to impose ‘detailed balance’ between any two configurations. This means that if <span class="math notranslate nohighlight">\(w_{12}\)</span> is the rate to go from configuration (or state) 1 with energy <span class="math notranslate nohighlight">\(E_1\)</span>, to a new state 2 with energy <span class="math notranslate nohighlight">\(E_2\)</span>, then the reverse transition <span class="math notranslate nohighlight">\(w_{21}\)</span> is related by</p>
<div class="math notranslate nohighlight">
\[\displaystyle  w_{12}e^{-E_1/k_BT} = w_{21}e^{-E_2/k_BT}\]</div>
<p>or more familiarly</p>
<div class="math notranslate nohighlight">
\[\displaystyle  w_{12} = w_{21}e^{-\Delta E/k_BT}, \qquad \Delta E = E_2 - E_1\]</div>
<p>The ratio of rates is the same as the ratio of probabilities of going between two configurations. The detailed balance condition ensures that any one configuration can be reached from another in a finite number of steps, and this condition is called ergodicity. This condition means that no configurations are systematically missed. Furthermore, if a sufficient number of samples are used in the calculation, all configurations will be sampled in proportion to their importance in contributing to <span class="math notranslate nohighlight">\(\langle Q \rangle\)</span>. The algorithm can also be viewed as a random walk among the many configurations, preferentially adding in those that contribute most to the average. The result is that states are produced in proportion to their Boltzmann distribution just as the states in reality are supposed to do.</p>
<p>All the basics of the algorithm are now assembled. The Metropolis idea is to compare two energies <span class="math notranslate nohighlight">\(E_1\)</span> and <span class="math notranslate nohighlight">\(E_2\)</span> from two guessed configurations 1 and 2. If the new one, 2, has the lower energy, then this configuration is accepted. If not, the chance of the new one, 2, contributing to <span class="math notranslate nohighlight">\(\langle Q \rangle\)</span> is guessed by comparing <span class="math notranslate nohighlight">\(e^{-(E_2-E_1)/k_BT }\)</span> to a uniform random number from zero to one and accepting configuration 2 if the random number is smaller; otherwise, the old configuration 1 is accepted, and so on.</p>
<p>To illustrate using equation 13a, in the next few examples it is calculated exactly and then by the Metropolis method.  Consider calculating the average kinetic energy of a molecule of mass <span class="math notranslate nohighlight">\(m\)</span> moving in one dimension, but doing so in contact with a heat bath at temperature <span class="math notranslate nohighlight">\(T\)</span> so that it undergoes random thermal motion. If <span class="math notranslate nohighlight">\(v\)</span> is the velocity at any instant, the average kinetic energy <span class="math notranslate nohighlight">\(\langle E\rangle_k\)</span>  is found with <span class="math notranslate nohighlight">\(Q(v) = mv^2/2\)</span>, and the ratio of integrals is (see also eqn 13 a)</p>
<div class="math notranslate nohighlight">
\[\displaystyle  \langle E\rangle_k  =\frac{\int_{-\infty}^\infty v^2e^{-mv^2/(2k_BT)} dv} {\int_{-\infty}^\infty e^{-mv^2/(2k_BT)}dv}=\frac{1}{2}k_BT \tag{13b} \]</div>
<p>As <span class="math notranslate nohighlight">\(\langle E^2\rangle = 3(k_BT/2)^2\)</span>, the heat capacity is <span class="math notranslate nohighlight">\(C_V = k_B/2\)</span>. It should be noted here that in the integration 13b the energy must always be specified in terms of its parameters. In this example, this means changing <span class="math notranslate nohighlight">\(dv\)</span> to <span class="math notranslate nohighlight">\(dE\)</span> via <span class="math notranslate nohighlight">\(dv = dE/(2mE)^{1/2}\)</span>. Only then will integrating over <span class="math notranslate nohighlight">\(E\)</span> return the correct result.</p>
<p>Consider next either the classical harmonic oscillator or the quantum harmonic oscillator at high temperature. There is a kinetic energy contribution to the total energy because the atoms are moving relative to one another about their equilibrium position with velocity <span class="math notranslate nohighlight">\(v\)</span>. Equation 13b again gives the average kinetic energy. Additionally, there is the potential energy <span class="math notranslate nohighlight">\(Q(x) = E_p = kx^2/2\)</span>, where <span class="math notranslate nohighlight">\(x\)</span> is the displacement from the equilibrium position. Mathematically this is the same calculation as eqn. 13b and produces the same result, but <span class="math notranslate nohighlight">\(x\)</span> is used instead of <span class="math notranslate nohighlight">\(v\)</span> and <span class="math notranslate nohighlight">\(k\)</span> instead of mass <span class="math notranslate nohighlight">\(m\)</span>. The total average energy is therefore <span class="math notranslate nohighlight">\(k_BT\)</span>. This result is a consequence of the equipartition theorem of classical mechanics where each quadratic term in the energy representing either the momentum <span class="math notranslate nohighlight">\(p_x\)</span> (kinetic energy <span class="math notranslate nohighlight">\(E = p^2_x/(2m))\)</span> or position <span class="math notranslate nohighlight">\(x\)</span>, contributes <span class="math notranslate nohighlight">\(k_BT/2\)</span> to the total energy.</p>
<p>Just as in an experiment where repeated measurements improve the precision, in a Monte Carlo calculation increasing the number of trials acts similarly. Experimental measurements on individual molecules produce results that can be different from those on an ensemble of a large number because rare events can be observed. In an ensemble measurement, the fluctuations experienced by any individual molecule are always averaged out. These fluctuations are a result of numerous interactions with the ‘thermal bath’. To illustrate the difference between a single versus many measurements, the standard deviation <span class="math notranslate nohighlight">\(\sigma\)</span> of the average energy <span class="math notranslate nohighlight">\(\langle E\rangle\)</span> can be used. This is defined as</p>
<div class="math notranslate nohighlight">
\[\displaystyle \sigma =\sqrt{\langle E^2\rangle-\langle E\rangle^2}\]</div>
<p>and the fractional error is, using the equation for <span class="math notranslate nohighlight">\(C_V\)</span>,</p>
<div class="math notranslate nohighlight">
\[\displaystyle \frac{\sigma}{\langle E\rangle}=\frac{\sqrt{k_BT^2C_V}}{\langle E\rangle}\]</div>
<p>For a single particle, <span class="math notranslate nohighlight">\(C_V = k_B/2\)</span> and <span class="math notranslate nohighlight">\(\langle E\rangle = k_BT/2\)</span>, making <span class="math notranslate nohighlight">\(\sigma/\langle E\rangle = 1\)</span>. Thus, the average energy obtained from a measurement on a single particle has, not surprisingly, a very large standard deviation. When <span class="math notranslate nohighlight">\(N\)</span> particles are measured (or <span class="math notranslate nohighlight">\(N\)</span> repeated measurements of the same one), then <span class="math notranslate nohighlight">\(C_V = Nk_B/2, \;\langle E\rangle = Nk_BT/2\)</span> and now <span class="math notranslate nohighlight">\(\sigma/\langle E\rangle \approx 1/\sqrt{N}\)</span> which is a vanishingly small quantity if <span class="math notranslate nohighlight">\(N\)</span> is large, and a good estimate of the true <span class="math notranslate nohighlight">\(\langle E\rangle\)</span> is obtained. Similarly, with a Monte Carlo simulation, the more samples that are included, the more accurate the result becomes and the standard deviation improves in proportion to <span class="math notranslate nohighlight">\(1/\sqrt{N}\)</span>.</p>
<p>To calculate an average quantity <span class="math notranslate nohighlight">\(\langle Q \rangle\)</span> the steps are:</p>
<p><strong>(1)</strong> Initialize parameters</p>
<p><span class="math notranslate nohighlight">\(\quad\)</span><strong>(i)</strong><span class="math notranslate nohighlight">\(\quad\)</span> Calculate <span class="math notranslate nohighlight">\(E_1\)</span> for any first configuration or state you choose.</p>
<p><span class="math notranslate nohighlight">\(\quad\)</span><strong>(ii)</strong><span class="math notranslate nohighlight">\(\quad\)</span> Calculate the initial value <span class="math notranslate nohighlight">\(Q_1\)</span>.</p>
<p><strong>(2)</strong> Start a loop</p>
<p><span class="math notranslate nohighlight">\(\quad\)</span><strong>(i)</strong><span class="math notranslate nohighlight">\(\quad\)</span> Calculate <span class="math notranslate nohighlight">\(E_2\)</span> for another state chosen at random.</p>
<p><span class="math notranslate nohighlight">\(\quad\)</span><strong>(ii)</strong><span class="math notranslate nohighlight">\(\quad\)</span>  If <span class="math notranslate nohighlight">\(E_2 \lt E_1\)</span>, keep the new state and add <span class="math notranslate nohighlight">\(Q_2\)</span> to a total quantity <span class="math notranslate nohighlight">\(Q_{tot}\)</span>.</p>
<p><span class="math notranslate nohighlight">\(\quad\)</span><strong>(iii)</strong><span class="math notranslate nohighlight">\(\quad\)</span>  If <span class="math notranslate nohighlight">\(E_2 \gt E_1\)</span>, then calculate <span class="math notranslate nohighlight">\(e^{-(E_2-E_1)/k_BT}\)</span>:</p>
<p><span class="math notranslate nohighlight">\(\quad\)</span><strong>(iv)</strong><span class="math notranslate nohighlight">\(\quad\)</span>  If <span class="math notranslate nohighlight">\(e^{-(E_2-E_1)/k_BT} \gt r\)</span>, where <span class="math notranslate nohighlight">\(r\)</span> is a uniform random number between 0 and 1, keep
the new state and add <span class="math notranslate nohighlight">\(Q_2\)</span> to <span class="math notranslate nohighlight">\(Q_{tot}\)</span>.</p>
<p><span class="math notranslate nohighlight">\(\quad\)</span><strong>(v)</strong><span class="math notranslate nohighlight">\(\quad\)</span> If <span class="math notranslate nohighlight">\(e^{-(E_2-E_1)/k_BT} \lt r\)</span>, retain the old state and add <span class="math notranslate nohighlight">\(Q_1\)</span> to <span class="math notranslate nohighlight">\(Q_{tot}\)</span>.</p>
<p><strong>(3)</strong> Continue the loop until <span class="math notranslate nohighlight">\(Q_{tot}\)</span> is obtained to a sufficient accuracy, or a fixed number of trials has been done.</p>
<p><strong>(v)</strong> Average<span class="math notranslate nohighlight">\(\langle Q \rangle= Q_{tot}/N\)</span> for <span class="math notranslate nohighlight">\(N\)</span> calculations.</p>
<p>Notice that even if a new state is not accepted the last used value <span class="math notranslate nohighlight">\(Q_1\)</span> is still added to the total, because each (randomly chosen) configuration has to be added into the total.</p>
<p>As a particular example, the mean potential energy of a harmonic oscillator will be calculated; the quantity <span class="math notranslate nohighlight">\(Q\)</span> is the energy and can be calculated exactly and is <span class="math notranslate nohighlight">\(k_BT/2\)</span>. The mean square energy will also be found which can also be calculated exactly, and is <span class="math notranslate nohighlight">\(3(k_BT)^2/4\)</span>. The standard deviation of the energy is</p>
<div class="math notranslate nohighlight">
\[\displaystyle \sqrt{\langle E^2\rangle - \langle E \rangle^2} = k_BT/\sqrt{2}  \]</div>
</div>
<div class="section" id="average-energy-heat-capacity-and-displacement-of-a-harmonic-oscillator">
<h2>6.1 Average energy,  heat capacity  and displacement of a harmonic oscillator<a class="headerlink" href="#average-energy-heat-capacity-and-displacement-of-a-harmonic-oscillator" title="Permalink to this headline">¶</a></h2>
<p>In the next example, the harmonic oscillator, <span class="math notranslate nohighlight">\(k=2\)</span> and <span class="math notranslate nohighlight">\(k_BT = 0.1\)</span>. Random guesses of the values of <span class="math notranslate nohighlight">\(x\)</span>, (the configuration or state) are made, and the average energy calculated. The range of <span class="math notranslate nohighlight">\(x\)</span> must be large enough to allow <span class="math notranslate nohighlight">\(e^{-E/k_BT}\)</span> to be very small, <span class="math notranslate nohighlight">\(\approx10^{-7}\)</span> or less, to allow proper sampling of the distribution. In addition, the range of <span class="math notranslate nohighlight">\(x\)</span> must be positive as well as negative. The random number has 1/2 subtracted from it to ensure this. If this is not done, then microscopic reversibility is not achieved because not all the possible configurations, in this case bond extension, can be sampled. The calculation continues for <span class="math notranslate nohighlight">\(20000\)</span> samples.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Algorithm: Metropolis  Harmonic oscillator  </span>

<span class="c1"># np.random.ranf() calculates one random number in the range 0 - 1</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">20000</span>                         <span class="c1"># number of samples</span>
<span class="n">deltax</span><span class="o">=</span> <span class="mf">0.4</span>                       <span class="c1"># max displacement</span>
<span class="n">kB</span>    <span class="o">=</span> <span class="mf">1.38e-5</span>                   <span class="c1"># in kg/nm^2/s^2/K == 1.38e^(-23) J/k</span>
<span class="n">nm</span>    <span class="o">=</span> <span class="mf">1e-9</span>
<span class="n">T</span>     <span class="o">=</span> <span class="mf">300.0</span>
<span class="n">kBT</span>   <span class="o">=</span> <span class="n">kB</span><span class="o">*</span><span class="n">T</span>
<span class="n">Etot</span>  <span class="o">=</span> <span class="mf">0.0</span>                       <span class="c1"># initial &lt;E&gt;</span>
<span class="n">E2tot</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">k</span>     <span class="o">=</span> <span class="mf">10.0</span>                      <span class="c1"># force constant </span>
<span class="n">V</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span>          <span class="c1"># potential energy PE </span>
<span class="n">x1</span><span class="o">=</span> <span class="mf">0.0</span>                           <span class="c1"># first guess of x</span>
<span class="n">E1</span><span class="o">=</span> <span class="n">V</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span>                         <span class="c1"># first guess of PE </span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>                <span class="c1"># start loop step(2)   </span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">ranf</span><span class="p">()</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="n">deltax</span>       <span class="c1">#new x position </span>
    <span class="n">E2</span> <span class="o">=</span> <span class="n">V</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span>                                    <span class="c1"># new PE</span>
    <span class="n">DeltaE</span> <span class="o">=</span> <span class="n">E2</span> <span class="o">-</span> <span class="n">E1</span>                              <span class="c1"># energy difference</span>
    <span class="c1"># next line is Metropolis parts(2) in algorithm</span>
    <span class="k">if</span> <span class="n">DeltaE</span> <span class="o">&lt;=</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">DeltaE</span><span class="o">/</span><span class="n">kBT</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">ranf</span><span class="p">()</span> <span class="p">:</span>
        <span class="n">x1</span><span class="o">=</span> <span class="n">x2</span>                    <span class="c1"># save new configuration </span>
        <span class="n">E1</span><span class="o">=</span> <span class="n">E2</span>                    <span class="c1"># save new energy</span>
        <span class="k">pass</span>
    <span class="n">Etot</span> <span class="o">=</span> <span class="n">Etot</span> <span class="o">+</span> <span class="n">E1</span>              <span class="c1"># always add to total </span>
    <span class="n">E2tot</span><span class="o">=</span> <span class="n">E2tot</span> <span class="o">+</span> <span class="n">E1</span><span class="o">**</span><span class="mi">2</span>          <span class="c1"># add to total &lt;E^2&gt;</span>
    <span class="k">pass</span>
<span class="n">Eav</span> <span class="o">=</span> <span class="n">nm</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">Etot</span><span class="o">/</span><span class="n">n</span><span class="p">;</span>               <span class="c1"># average step (5) &amp; put back into real units</span>
<span class="n">E2av</span><span class="o">=</span> <span class="n">nm</span><span class="o">**</span><span class="mi">4</span><span class="o">*</span><span class="n">E2tot</span><span class="o">/</span><span class="n">n</span><span class="p">;</span>
<span class="n">CV</span><span class="o">=</span> <span class="p">(</span><span class="n">E2av</span><span class="o">-</span><span class="n">Eav</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">kB</span><span class="o">*</span><span class="n">T</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">nm</span><span class="o">**</span><span class="mi">2</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1"> </span><span class="si">{:8.4g}</span><span class="s1"> </span><span class="si">{:s}</span><span class="s1"> </span><span class="si">{:8.4g}</span><span class="s1"> </span><span class="si">{:s}</span><span class="s1"> </span><span class="si">{:8.4g}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;av E=&#39;</span><span class="p">,</span><span class="n">Eav</span><span class="p">,</span> <span class="s1">&#39;av e^2=&#39;</span><span class="p">,</span><span class="n">E2av</span><span class="p">,</span><span class="s1">&#39;Cv=&#39;</span><span class="p">,</span><span class="n">CV</span><span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>av E= 2.121e-21 av e^2= 1.344e-41 Cv= 7.196e-24
</pre></div>
</div>
</div>
</div>
<div class="math notranslate nohighlight">
\[\begin{split}\displaystyle \begin{array}{lc|cc}
\hline
\text{Quantity}&amp; \text{units}&amp;\text{ Theory }  &amp; \text{Metropolis } \\
\hline
\langle E \rangle=k_BT/2 &amp;\text{J}&amp; 2.07\cdot 10^{-21}&amp;  2.095 \cdot 10^{-21}\\
\langle E^2 \rangle =3\left(k_BT/2 \right)^2 &amp;\text{J}&amp; 1.28\cdot 10^{-41} &amp; 1.27\cdot 10^{-41}\\
C_V =k_BT/2 &amp;\text{J/K}&amp;0.69\cdot 10^{-23}  &amp; 0.67\cdot 10^{-23}\\
\langle x\rangle =0&amp;\text{nm} &amp; 0 &amp; -3\cdot 10^{-5} \\
\langle x^2\rangle=k_BT/k &amp;\text{nm}^2 &amp;  0.000413 &amp; 0.000414\\
\hline
\end{array}\end{split}\]</div>
<p>Although we have calculated the average energy, the average displacement and its square are just as easily calculated. This is done by adding the lines <span class="math notranslate nohighlight">\(\mathtt{ xtot=xtot+x1}\)</span> and <span class="math notranslate nohighlight">\(\mathtt{x2tot=x2tot+x1^{**}2}\)</span> after the lines calculating the energy, and by defining these values to be zero initially. The calculated values are shown in the table and are  are close to the theoretical values. In the algorithm, and only for clarity, adding <span class="math notranslate nohighlight">\(\mathtt{E1}\)</span> or <span class="math notranslate nohighlight">\(\mathtt{x1}\)</span> etc to their respective totals starts immediately, without allowing the random walk to come close to its equilibrium value, which takes several hundred steps. This introduces an error but as the number of Monte-Carlo steps is large, <span class="math notranslate nohighlight">\(20000\)</span>, this error is small.</p>
<p>Estimations of the range of the average potential energy of a harmonic oscillator using the Metropolis method are shown in figure 18. The number of samples is the same in each case. For example, one run of <span class="math notranslate nohighlight">\(10^5\)</span> samples or 1000 runs of 100 samples. It is clear that sampling with a longer random walk reduces the standard deviation.</p>
<p><img alt="Drawing" src="../_images/monte-carlo-fig18.png" /></p>
<p>Figure 18. Metropolis estimation of potential energy vs. number of samples. The estimated energy is plotted as red circles. The horizontal line is the theoretical energy <span class="math notranslate nohighlight">\(k_BT/2\)</span> at 300 K. The solid lines are given by <span class="math notranslate nohighlight">\(\langle E\rangle \pm a /\sqrt{ N}\)</span> where <span class="math notranslate nohighlight">\(a=2.5\)</span> is a constant.</p>
<hr class="docutils" />
<p>The harmonic oscillator clearly also has kinetic energy. The calculation to estimate this is essentially the same as just described; however, the constants are interpreted in a different way. The constant <span class="math notranslate nohighlight">\(k\)</span> now represents the reduced mass, which is will become <span class="math notranslate nohighlight">\(10\)</span> amu, and displacement <span class="math notranslate nohighlight">\(x\)</span> now represents the velocity <span class="math notranslate nohighlight">\(v\)</span> in m s<sup>-1</sup> about the origin of coordinates taken as the center of gravity of the molecule. The velocity must range from at least <span class="math notranslate nohighlight">\(\pm 4000\, \mathrm{ m\, s^{-1}}\)</span> if the exponential <span class="math notranslate nohighlight">\(e^{-\Delta E/(k_BT)}\)</span> is to be <span class="math notranslate nohighlight">\(\approx 10^{-8}\)</span> or less at the largest speed. A typical value of the average kinetic energy (per molecule) is found to be <span class="math notranslate nohighlight">\(2.03 \pm 0.01 \cdot 10^{-21}\)</span> J, which is effectively the same result as for the previous Monte Carlo calculation of <span class="math notranslate nohighlight">\(\langle E \rangle\)</span>  and demonstrates the equipartition theorem.</p>
<div class="section" id="maxwell-distribution">
<h3><strong>Maxwell distribution</strong><a class="headerlink" href="#maxwell-distribution" title="Permalink to this headline">¶</a></h3>
<p>Normally kinetic energy <span class="math notranslate nohighlight">\(mv^2/2\)</span> is interpreted as that due to molecules of a gas colliding with one another rather than that of the atoms of a harmonic oscillator. If this is the case then the Maxwell speed distribution can be constructed. To do this, the velocities that are accepted in the Metropolis step are stored as the calculation proceeds. Velocity is a vector but speed is not; consequently, the angles that a molecule has with respect to any axes are integrated away on calculating the speed distribution and no longer enter into the calculation. The result is that the speed distribution depends only on <span class="math notranslate nohighlight">\(v^2\)</span>, which is interpreted as a scalar equal to the speed squared. For example, the probability per unit speed of molecules with speed <span class="math notranslate nohighlight">\(s = |v|\)</span> is,</p>
<div class="math notranslate nohighlight">
\[\displaystyle f(s) = \frac{4}{\sqrt{\pi}}\left(\frac{m}{2k_BT} \right)^{3/2}s^2e^{-ms^2/(2k_BT)}  \tag{13c}\]</div>
<p>It can be verified that <span class="math notranslate nohighlight">\(\displaystyle \int_0^\infty f(s) ds = 1\)</span>. If the values of <span class="math notranslate nohighlight">\(v\)</span> calculated from the Monte Carlo method are put into equation 13b, they are distributed toward smaller values of <span class="math notranslate nohighlight">\(v\)</span>, which shows the weighting that the method produces. However, if the Metropolis probability test is changed to <span class="math notranslate nohighlight">\(\displaystyle (s_2^2/s_1^2)e^{-\Delta E/(k_BT)}\)</span> from <span class="math notranslate nohighlight">\(e^{-\Delta E/(k_BT)}\)</span>, then the results are distributed more evenly according to the Maxwell distribution. The changes to the code are shown below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Algorithm: Metropolis. Calculate Maxwell speed distribution.</span>

<span class="c1"># mass in amu, kB in J/K, x = speed in m/s</span>
 
<span class="n">N</span>   <span class="o">=</span>   <span class="mi">1000</span>                                  <span class="c1"># number of samples</span>
<span class="n">deltax</span><span class="o">=</span> <span class="mf">5000.0</span>                                <span class="c1"># max speed m /s</span>
<span class="n">kB</span>  <span class="o">=</span>   <span class="mf">1.381e-23</span>                             <span class="c1"># Boltzmann?s const J/K</span>
<span class="n">T</span>   <span class="o">=</span>   <span class="mf">300.0</span>                                 <span class="c1"># temperature K</span>
<span class="n">kBT</span> <span class="o">=</span> <span class="n">kB</span><span class="o">*</span><span class="n">T</span>               
<span class="n">amu</span> <span class="o">=</span>  <span class="mf">1.6604e-27</span>                             <span class="c1"># atomic mass unit kg</span>
<span class="n">m</span>   <span class="o">=</span>  <span class="mf">14.0</span><span class="o">*</span><span class="n">amu</span>                               <span class="c1"># N2 mass in kg</span>
<span class="n">Etot</span> <span class="o">=</span> <span class="mf">0.0</span>                                    <span class="c1"># initial energy &lt;E&gt; J</span>
<span class="n">E2tot</span><span class="o">=</span> <span class="mf">0.0</span>                                    <span class="c1"># initial &lt;E2&gt;</span>
<span class="n">Xtot</span> <span class="o">=</span> <span class="mf">0.0</span>                                    <span class="c1"># initial value of total x</span>
<span class="n">X2tot</span><span class="o">=</span> <span class="mf">0.0</span>                                    <span class="c1"># initial value of total x2</span>

<span class="n">V</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">m</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span>                   <span class="c1"># kinetic energy function of x</span>
               
<span class="n">x1</span> <span class="o">=</span> <span class="mf">1e-3</span>                                     <span class="c1"># first guess of x  </span>
<span class="n">E1</span> <span class="o">=</span> <span class="n">V</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span>                                    <span class="c1"># first guess of PE</span>
<span class="n">jj</span> <span class="o">=</span> <span class="mi">0</span>                                        <span class="c1"># initial index Ps &amp; Px</span>
<span class="n">Pi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> 
<span class="n">g</span>  <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">Pi</span><span class="o">*</span><span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">Pi</span><span class="o">*</span><span class="n">kBT</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mf">3.0</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>         <span class="c1"># weighting for fs.</span>
 
<span class="n">fs</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>                 <span class="c1"># Maxwell probability f(s) </span>
<span class="n">fx</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>                 <span class="c1"># x value</span>
 
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>                            <span class="c1"># start loop step (2)</span>
    <span class="n">x2</span> <span class="o">=</span>  <span class="n">x1</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">ranf</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="n">deltax</span>     <span class="c1"># new x position</span>
    <span class="n">E2</span> <span class="o">=</span> <span class="n">V</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span>                                <span class="c1"># new PE</span>
    <span class="n">DeltaE</span> <span class="o">=</span> <span class="n">E2</span> <span class="o">-</span> <span class="n">E1</span>                          <span class="c1"># energy difference</span>
                                              <span class="c1"># next line is Metropolis sampling</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">DeltaE</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">((</span><span class="n">x2</span><span class="o">/</span><span class="n">x1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">DeltaE</span><span class="o">/</span><span class="n">kBT</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">ranf</span><span class="p">())</span> <span class="p">:</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">x2</span>                               <span class="c1"># save new config&#39;n</span>
        <span class="n">E1</span> <span class="o">=</span> <span class="n">E2</span>                               <span class="c1"># save new energy</span>
        <span class="n">fs</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">E1</span><span class="o">/</span><span class="n">kBT</span><span class="p">)</span><span class="o">*</span><span class="n">x1</span><span class="o">**</span><span class="mi">2</span>      <span class="c1"># Maxwell probability</span>
        <span class="n">fx</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span>                   <span class="c1"># make abs as only positive has any meaning physically</span>
        <span class="n">jj</span> <span class="o">=</span> <span class="n">jj</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">pass</span>
    <span class="n">Etot</span>  <span class="o">=</span> <span class="n">Etot</span>  <span class="o">+</span> <span class="n">E1</span>                         <span class="c1"># always add to total</span>
    <span class="n">E2tot</span> <span class="o">=</span> <span class="n">E2tot</span> <span class="o">+</span> <span class="n">E1</span><span class="o">**</span><span class="mi">2</span>                      <span class="c1"># add to total &lt;E2&gt;</span>
    <span class="n">Xtot</span>  <span class="o">=</span> <span class="n">Xtot</span>  <span class="o">+</span> <span class="n">x1</span>                         <span class="c1"># add to total &lt;X&gt;</span>
    <span class="n">X2tot</span> <span class="o">=</span> <span class="n">X2tot</span> <span class="o">+</span> <span class="n">x1</span><span class="o">**</span><span class="mi">2</span>                      <span class="c1"># add to total &lt;X2&gt;</span>
    <span class="k">pass</span>                                       <span class="c1"># end loop</span>
            
<span class="n">Eav</span>    <span class="o">=</span> <span class="n">Etot</span><span class="o">/</span><span class="n">N</span>                               <span class="c1"># average step (5)</span>
<span class="n">E2av</span>   <span class="o">=</span> <span class="n">E2tot</span><span class="o">/</span><span class="n">N</span>
<span class="n">Estdev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">E2av</span> <span class="o">-</span> <span class="n">Eav</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> 
<span class="n">CV</span>     <span class="o">=</span> <span class="p">(</span><span class="n">E2av</span> <span class="o">-</span> <span class="n">Eav</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">kB</span><span class="o">*</span><span class="n">T</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># plot data </span>
<span class="c1">#plt.scatter(fx[0:jj],fs[0:jj],color=&#39;red&#39;,s=3)</span>
<span class="c1">#plt.show()</span>
</pre></div>
</div>
</div>
</div>
<p>The results are shown in figure 19, where the Metropolis data from <span class="math notranslate nohighlight">\(1000\)</span> samples is shown as red dots on top of the known distribution eqn 13c (wide grey line) using a mass of <span class="math notranslate nohighlight">\(14\)</span> amu at <span class="math notranslate nohighlight">\(300\)</span> K.  It is clear that the simulation matches the data remarkably well.</p>
<p><img alt="Drawing" src="../_images/monte-carlo-fig19.png" /></p>
<p>Figure 19. Maxwell speed distribution showing the distribution of sampled points. The thick grey curve is the theoretical line.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="ising-spin-model">
<h2>6.2 Ising spin model<a class="headerlink" href="#ising-spin-model" title="Permalink to this headline">¶</a></h2>
<p>The next example is taken from statistical mechanics and is the Ising model of a ferromagnet. In a ferromagnet, the atomic spins are coupled to one another by the quantum mechanical exchange interaction <span class="math notranslate nohighlight">\(J\)</span> and can only have two energies corresponding to being ‘up’ or ‘down’. The coupling ensures that ‘up’ spins want to be next to other up spins and ‘down’ spins want to be next to other down spins. At zero temperature, the minimum energy configuration occurs when all the spins align in the same direction, and its energy is <span class="math notranslate nohighlight">\(-2JN\)</span> for <span class="math notranslate nohighlight">\(N\)</span> spins. The entropy of the spin system is zero, because all spins are aligned in perfect order, and so is the heat capacity <span class="math notranslate nohighlight">\(C_p\)</span>. The magnetization, which is the sum of the individual spin magnetic moments, is maximal.</p>
<p>As the temperature rises, the energy absorbed induces thermal motion in the atoms. This disrupts the alignment of the spins and they start to flip over. The heat capacity, which is defined as the rate of change of the internal energy with temperature, increases as more spins gain energy and are flipped. However, destroying the spins’ alignment causes the magnetization to fall. At high temperatures, the spins are randomly aligned and because of this the total magnetization approaches zero. The heat capacity also falls, reaching zero at infinite temperature. This happens because the spins only have two energies corresponding to being up or down relative to a neighbour, and cannot absorb any more energy than when they are randomly aligned, which corresponds to infinite temperature. Between these two extremes, in a two dimensional arrangement of spins a surprising phase transition occurs where the heat capacity becomes infinite as the magnetization drops towards zero. The phase transition is observed if a two-dimensional plot is made of the spin state. Just past the transition, large areas of similar spin alignment dissolve and the spins on the lattice become considerably more disordered; Fig. 20.</p>
<p>The phase transition can be understood in thermodynamic terms, by considering the free energy change <span class="math notranslate nohighlight">\(\Delta G = \Delta H - T\Delta S\)</span>. As only spins are considered there is no <span class="math notranslate nohighlight">\(pV\)</span> work; we are not considering a gas, therefore <span class="math notranslate nohighlight">\(\Delta H = \Delta U\)</span>, where <span class="math notranslate nohighlight">\(U\)</span> is the internal energy. This is determined by the exchange interaction energy <span class="math notranslate nohighlight">\(J\)</span>. At the temperature of the phase transition, the phases are at equilibrium and <span class="math notranslate nohighlight">\(\Delta U = T\Delta S\)</span>. At lower temperatures, the entropic term must be relatively small because T is small, and <span class="math notranslate nohighlight">\(\Delta S\)</span> is also small because the spins are more ordered. The free energy <span class="math notranslate nohighlight">\(\Delta G\)</span> is therefore overwhelmingly determined by the internal energy. As the temperature increases, the increasing entropic term will make <span class="math notranslate nohighlight">\(\Delta G\)</span> more negative. Additionally, as the entropy also increases with temperature, the change from internal energy to entropy determining the free energy is sudden in the sense that it occurs over a small temperature range. The heat capacity becomes infinite at the phase transition because the heat supplied does not go into raising the temperature, but in reorganizing the spin states, and that causes an increase in entropy.</p>
<p><img alt="Drawing" src="../_images/monte-carlo-fig20.png" /></p>
<p>Figure 20. Two examples of <span class="math notranslate nohighlight">\(2^{256}\)</span> or <span class="math notranslate nohighlight">\(\approx 10^{77}\)</span> possible configurations of spins in a <span class="math notranslate nohighlight">\(16 \times 16\)</span> Ising model with temperature <span class="math notranslate nohighlight">\(T = 2\)</span> (left) and <span class="math notranslate nohighlight">\(3\)</span> (right) showing how significantly the disorder increases after the phase transition at <span class="math notranslate nohighlight">\(T = 2.269\)</span>. The light squares represent spin = <span class="math notranslate nohighlight">\(1\)</span>, and the dark squares, spin = <span class="math notranslate nohighlight">\(-1\)</span>. The exchange coupling <span class="math notranslate nohighlight">\(J = 1\)</span>, and <span class="math notranslate nohighlight">\(k_B = 1\)</span>.</p>
</div>
<hr class="docutils" />
<div class="section" id="d-spin-model">
<h2>1D spin model<a class="headerlink" href="#d-spin-model" title="Permalink to this headline">¶</a></h2>
<p>In the examples such as the Maxwell distribution  there is no interaction between particles. One of the simplest examples in which interaction is allowed is the one-dimensional (1-D) Ising spin model. This is realized in practice with some Fe(II)Cl<span class="math notranslate nohighlight">\(^-_3\)</span> compounds which, in the crystalline state, have chains of Fe<span class="math notranslate nohighlight">\(^{2+}\)</span> atoms held apart with dichloride bridges. Part of the crystal structure of trimethylammonium iron(II) trichloride hydrate, (FeTAC), <span class="math notranslate nohighlight">\(\mathrm{[(CH_3)_3NH]FeCl^-_3 \cdot 2H_2O}\)</span>, is shown in Figure 20. The coupling between different chains of molecules in the crystal is relatively weak, but the interaction along a chain is so strong that this compound behaves as a 1-D chain of interacting electron spins.</p>
<p>A spin may flip because of its interaction with surrounding atoms and consequently neighboring spins are affected. These spins in turn affect their neighbors, and thus, one flip may propagate along the chain until all spins come to equilibrium with their surroundings. The electrons interact with one another by the exchange interaction of magnitude <span class="math notranslate nohighlight">\(J\)</span>. The number of electrons in each spin state, either ‘up’ or ‘down’, depends on the ratio of this interaction to the temperature. A small section of the spin state is shown in Figure 20. Parallel spin pairs have energy <span class="math notranslate nohighlight">\(-J\)</span> but <span class="math notranslate nohighlight">\(+J\)</span> if they are anti-parallel. If <span class="math notranslate nohighlight">\(J\)</span> is positive, the spin system is ferromagnetic and if negative, anti-ferromagnetic.</p>
<p>The energy of a chain in the absence of an external magnetic field is given by</p>
<div class="math notranslate nohighlight">
\[\displaystyle  E_\alpha = -J\sum_k s_ks_{k+1}  \tag{13d}\]</div>
<p>where <span class="math notranslate nohighlight">\(s_k =\pm 1\)</span> represents the spin on the <span class="math notranslate nohighlight">\(k^{th}\)</span> site, and the sum is taken over all pairs <span class="math notranslate nohighlight">\(s_ks_{k+1}\)</span>. The various combinations the spins take produce the different energies <span class="math notranslate nohighlight">\(E_\alpha\)</span>. Because the exchange interaction depends on the overlap of wavefunctions, as does the related Coulomb interaction, it is of very short-range; therefore, only the nearest neighbors are important, and the summation of eqn. 13d is pairwise.</p>
<p><img alt="Drawing" src="../_images/monte-carlo-fig21.png" /></p>
<p>Figure 21. (A) Schematic of part of the FeTAC crystal structure, based on Greeney et al. (Phys.Rev. B 1989, 39, p 12200). The Fe atoms (center) are linked by two chlorines (gray), and the oxygen atoms (black) complete the coordination. In this compound, <span class="math notranslate nohighlight">\(J/k_B = 8.85\)</span>  K.  (B) Representation of electron spins as either ‘up’ or ‘down’.</p>
<hr class="docutils" />
<p>Because the spins interact with one another, at very low temperature they will all align in one direction with a total energy of <span class="math notranslate nohighlight">\(-NJ\)</span> (assuming <span class="math notranslate nohighlight">\(J \gt 0\)</span>) as there is not enough thermal energy to disrupt spin alignment. As the temperature increases, spins will flip over. Eventually, at infinite temperature, which in practice may be well below room temperature, the energy approaches zero because there are as many parallel as anti-parallel spin pairs.
The spin heat capacity at low temperatures is also close to zero, because there is not enough energy to flip a spin, and therefore, the rate of change of energy with temperature is zero; <span class="math notranslate nohighlight">\(\lim_{T\to 0} C_V(T) = \lim_{T\to 0} \left( \partial U/\partial T\right)_V = 0\)</span>. At infinite temperature, the heat capacity again approaches zero. Because there are now equal populations of parallel and anti-parallel spin pairs, no more energy can be absorbed, and thus, the rate of change of energy with temperature is zero. As <span class="math notranslate nohighlight">\(C_V\)</span> is zero at both extremes of temperature and is, by definition, a positive quantity, it must pass through a maximum at some finite temperature whose value will depend on <span class="math notranslate nohighlight">\(J\)</span>.</p>
<p>The entropy of the chain of <span class="math notranslate nohighlight">\(N\)</span> spins is <span class="math notranslate nohighlight">\(k_B\ln(2)\)</span> at zero temperature, because two degenerate and ordered spin states exist. At high temperatures, where the thermal energy is far greater than the spin interaction energy, the entropy is <span class="math notranslate nohighlight">\(Nk_B\ln(2)\)</span>. This is <span class="math notranslate nohighlight">\(N\)</span> times greater than at 0 K and a dependence on <span class="math notranslate nohighlight">\(N\)</span> is to be expected because entropy is an extensive quantity. The entropy therefore initially increases with an increase in temperature and then becomes constant. The magnetization and susceptibility can also be simulated. Details of these calculations are given below.</p>
<p>Without having to evaluate the partition function directly, the energy, heat capacity, and entropy can be calculated using the Metropolis algorithm. In the calculation shown in Figure 2, a chain of <span class="math notranslate nohighlight">\(500\)</span> spins is simulated and the number of spin states is therefore <span class="math notranslate nohighlight">\(2^{500} \approx 3 \cdot 10^{150}\)</span>, all of which would have to be evaluated in a direct calculation. The results of the Monte Carlo calculation, Figure 23, have been obtained by randomly sampling each site <span class="math notranslate nohighlight">\(4000\)</span> times. Although this represents a large number of calculations, it is only a minuscule fraction of the total number of possible spin states and demonstrates the power of this algorithm.</p>
<p>It is clear that the Metropolis algorithm accurately simulates the change in energy and heat capacity with temperature. In implementing this particular Monte Carlo calculation, there are three considerations. The first is to calculate the energy change caused by flipping one spin, the second is to decide what happens at the ends of the chain, and the third is to determine what values the spins should have at the start of the calculation. First, to determine the energy change, a site is chosen at random and its spin flipped. The change in energy this causes is found by looking at the site and its two neighbors and calculating what happens; Figure 23 shows two examples. The change in energy <span class="math notranslate nohighlight">\(\Delta E = E_2-E_1\)</span> is either zero or <span class="math notranslate nohighlight">\(\pm 4J\)</span>, and because a negative or zero change in energy is always accepted, the exponential expression in the Metropolis sampling step is always <span class="math notranslate nohighlight">\(\displaystyle e^{-4J/(k_BT)}\)</span>. This can be calculated outside the Monte Carlo loop, which saves considerable time.</p>
<p>The second consideration concerns the finite length of the chain. Theoretically, infinite length is assumed, but obviously this must be finite and thus a boundary condition is necessary to simulate infinity. The boundary condition used effectively makes the chain circular, so that if a spin’s nearest neighbor is one step off the end of the chain, the state of the spin at the other end is used. Therefore, if the <span class="math notranslate nohighlight">\(N\)</span> indices run from <span class="math notranslate nohighlight">\(0 \to N-1\)</span>, then index <span class="math notranslate nohighlight">\(\gt N-1 \to 0\)</span>  and index <span class="math notranslate nohighlight">\(\lt 0 \to N-1\)</span>. The last consideration concerns the initial arrangement of the spins. Are these to be aligned, to be random, or somewhere in between? Although it does not matter how the initial spins are arranged provided enough Monte Carlo runs are taken, at low temperatures fewer runs are needed if the spins are initially parallel.</p>
<p><img alt="Drawing" src="../_images/monte-carlo-fig22.png" /></p>
<p>Figure 22. A schematic of two configurations of spins related by a single spin flip. Only values of <span class="math notranslate nohighlight">\(\Delta E = 0, \pm 4J\)</span> occur. The interaction energy is <span class="math notranslate nohighlight">\(-J\)</span> <em>between a pair of parallel spins</em> whether up or down, and <span class="math notranslate nohighlight">\(+J\)</span> if anti-parallel. The energy change is calculated as final - initial state.</p>
<hr class="docutils" />
<p>The code to calculate 1D Ising spin energy and heat capacity as in figure 23 is shown below. The parameters to be used are defined outside the routine Ising1D but can be used inside as in Python they are global variables.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Algorithm: 1D Ising model</span>
<span class="c1">#--------------------------------------------</span>
<span class="k">def</span> <span class="nf">Ising1D</span><span class="p">(</span><span class="n">beta</span><span class="p">):</span>

    <span class="c1">#L               # L sites</span>
    <span class="c1">#N               # calcs / site</span>
    <span class="c1">#J               # positive J is ferromagnet</span>
    <span class="c1">#kB              # Boltzmann const, in a.u.</span>
    <span class="c1">#T               # temperature</span>
    <span class="c1"># beta = J/kBT</span>
    <span class="n">rndi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">size</span> <span class="o">=</span> <span class="n">N</span><span class="p">)</span>      <span class="c1"># make list of random numbers 0 to n used as indices</span>
    <span class="n">spin</span><span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
                              <span class="c1"># deltaE can take values ( -4, 0, 4), however, only the</span>
                              <span class="c1"># positive value is used in the metropolis test, hence we define </span>
                              <span class="c1"># probability P for the Metropolis test outside the loop.</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">4.0</span><span class="o">*</span><span class="n">beta</span><span class="p">)</span>     <span class="c1"># probability in Metropolis test.</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">L</span><span class="p">):</span>
        <span class="n">spin</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>               <span class="c1"># initial spin distribution</span>
    
    <span class="n">Enrg</span> <span class="o">=</span> <span class="o">-</span><span class="n">J</span><span class="o">*</span><span class="n">L</span>                    <span class="c1"># all spins aligned initially</span>
    <span class="n">tot_Enrg</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">tot_Enrg2</span><span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">rndi</span><span class="p">[</span><span class="n">num</span><span class="p">]</span>
        <span class="n">indx1</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> 
        <span class="k">if</span> <span class="n">indx1</span> <span class="o">&gt;</span> <span class="n">L</span><span class="o">-</span><span class="mi">1</span> <span class="p">:</span> <span class="n">indx1</span> <span class="o">=</span> <span class="mi">0</span>       <span class="c1"># wrap around ends</span>
        <span class="n">indx2</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span> 
        <span class="k">if</span> <span class="n">indx2</span> <span class="o">&lt;</span> <span class="mi">0</span>   <span class="p">:</span> <span class="n">indx2</span> <span class="o">=</span> <span class="n">L</span> <span class="o">-</span> <span class="mi">1</span>
    
        <span class="n">DeltaE</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">J</span><span class="o">*</span><span class="n">spin</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">spin</span><span class="p">[</span><span class="n">indx1</span><span class="p">]</span> <span class="o">+</span> <span class="n">spin</span><span class="p">[</span><span class="n">indx2</span><span class="p">])</span>     <span class="c1"># energy of  spin i + energy of adjacent spins</span>
                                       
        <span class="k">if</span> <span class="n">DeltaE</span> <span class="o">&lt;=</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">ranf</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">P</span> <span class="p">:</span>             <span class="c1"># Metropolis test </span>
            <span class="n">spin</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">spin</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>                                 <span class="c1"># flip spin</span>
            <span class="n">Enrg</span> <span class="o">=</span> <span class="n">Enrg</span> <span class="o">+</span> <span class="n">DeltaE</span>                               <span class="c1"># add  energy </span>
            <span class="k">pass</span>
        <span class="n">tot_Enrg</span> <span class="o">=</span> <span class="n">tot_Enrg</span>  <span class="o">+</span> <span class="n">Enrg</span>                            <span class="c1"># total energies</span>
        <span class="n">tot_Enrg2</span><span class="o">=</span> <span class="n">tot_Enrg2</span> <span class="o">+</span> <span class="n">Enrg</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">pass</span>
    
    <span class="k">return</span> <span class="n">tot_Enrg</span><span class="p">,</span> <span class="n">tot_Enrg2</span>
<span class="c1">#---------------------------------------------</span>

<span class="n">L</span>    <span class="o">=</span> <span class="mi">500</span>                                        <span class="c1"># L sites</span>
<span class="n">reps</span> <span class="o">=</span> <span class="mi">400</span>                                        <span class="c1"># repeats</span>
<span class="n">N</span>    <span class="o">=</span> <span class="n">L</span><span class="o">*</span><span class="n">reps</span>                                     <span class="c1"># reps calcs / site</span>
<span class="n">J</span>    <span class="o">=</span> <span class="mf">1.0</span>                                        <span class="c1"># positive J is ferromagnet</span>
<span class="n">kB</span>   <span class="o">=</span> <span class="mf">1.0</span>                                        <span class="c1"># Boltzmann const, in a.u.</span>
<span class="n">T</span>    <span class="o">=</span> <span class="mf">2.0</span>                                        <span class="c1"># temperature</span>
<span class="n">beta</span> <span class="o">=</span> <span class="n">J</span><span class="o">/</span><span class="p">(</span><span class="n">kB</span><span class="o">*</span><span class="n">T</span><span class="p">)</span>

<span class="n">tot_E</span><span class="p">,</span> <span class="n">tot_E2</span>  <span class="o">=</span> <span class="n">Ising1D</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>                               <span class="c1"># calculate</span>

<span class="n">avE</span>  <span class="o">=</span> <span class="p">(</span><span class="n">tot_E</span><span class="o">/</span><span class="n">N</span><span class="p">)</span>                                             <span class="c1"># total N events</span>
<span class="n">avE2</span> <span class="o">=</span> <span class="p">(</span><span class="n">tot_E2</span><span class="o">/</span><span class="n">N</span><span class="p">)</span>
<span class="n">Cv</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">L</span><span class="o">*</span><span class="n">kB</span><span class="o">*</span><span class="n">T</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="p">(</span> <span class="n">avE2</span> <span class="o">-</span> <span class="n">avE</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>                     <span class="c1"># &lt;E^2&gt; - &lt;E&gt;^2</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1"> </span><span class="si">{:f}</span><span class="s1"> </span><span class="si">{:s}</span><span class="s1"> </span><span class="si">{:f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;av energy/site =&#39;</span><span class="p">,</span><span class="n">avE</span><span class="o">/</span><span class="n">L</span><span class="p">,</span> <span class="s1">&#39;Cv =&#39;</span><span class="p">,</span><span class="n">Cv</span><span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>av energy/site = -0.468526 Cv = 0.270514
</pre></div>
</div>
</div>
</div>
<p><img alt="Drawing" src="../_images/monte-carlo-fig23.png" /></p>
<p>Figure 23. Left: The red circles are the Monte Carlo calculated energy, <span class="math notranslate nohighlight">\(\langle E\rangle\)</span>, per spin; <span class="math notranslate nohighlight">\(\langle E\rangle/JN\)</span>. Right  The heat capacity per spin <span class="math notranslate nohighlight">\(\langle C_V\rangle /k_B\)</span> vs temperature (K), with <span class="math notranslate nohighlight">\(J/k_B = 1\)</span> K. One run of <span class="math notranslate nohighlight">\(4000\)</span> samples is shown for each point. The lines are from the analytical functions, see text.</p>
<hr class="docutils" />
<div class="section" id="calculating-the-entropy">
<h3><strong>Calculating the Entropy</strong><a class="headerlink" href="#calculating-the-entropy" title="Permalink to this headline">¶</a></h3>
<p>Although the entropy at a given temperature <span class="math notranslate nohighlight">\(T\)</span> can be calculated by integrating <span class="math notranslate nohighlight">\(C_V/T\)</span>, it can also be calculated more fundamentally from the arrangement of the spins. Maps of the spin state at the end of a calculation indicate how the entropy changes with temperature, and three examples are shown in Figure 24.</p>
<p>Informally, we may label a black group as ‘parallel spin up’ and a white one ‘parallel spin down’, although ‘up’ and ‘down’ should not be taken literally. Within any blocks of either color, the spins are parallel to one another; hence, the coupling is <span class="math notranslate nohighlight">\(-J\)</span> between adjacent spins. A color boundary thus indicates spin pairing and a coupling of <span class="math notranslate nohighlight">\(+ J\)</span> between these two spins; see Figure 22. At <span class="math notranslate nohighlight">\(T = 0\)</span> K, all spins are in the same state, which would mean that the whole strip would be of the same color. However, there are two ground states at <span class="math notranslate nohighlight">\(T = 0\)</span> and these could be colored either black or white. At low temperatures, for example, <span class="math notranslate nohighlight">\(T\)</span> = 1/2 or 1 K, (Figure 24) spins are grouped into a few large blocks of similar spin state. Although only one example is given in the figure, it is clear that if many calculations are performed here only a limited number of arrangements of these large blocks of spins will be possible. These configurations or arrangements determine the entropy. As the temperature is increased, the coupling between spins becomes relatively less important compared to the energy supplied by the surrounding heat bath. This reduces the size of the groups of similar spin state but increases their number, which leads to more of ways of arranging them, and hence, a larger entropy.</p>
<p>The entropy of the equilibrium state is given by <span class="math notranslate nohighlight">\(S = k_B \ln(\Omega)\)</span> where <span class="math notranslate nohighlight">\(\Omega\)</span> is the number of arrangements that the spins can take. To calculate <span class="math notranslate nohighlight">\(\Omega\)</span>, the number of groups of spins p present at the end of the calculation and at a given temperature is counted; see Figure 24. This is done by searching the pattern of spins for the number of spin changes and adding one to the total. From the theory of statistics, the number of ways of choosing <span class="math notranslate nohighlight">\(N_p\)</span> distinguishable objects from a group of <span class="math notranslate nohighlight">\(N\)</span> distinguishable objects, where the order of choosing does not matter, is given by</p>
<div class="math notranslate nohighlight">
\[\displaystyle \Omega ' = \frac{N!}{N_p!(N-N_p)!}  \tag{13e} \]</div>
<p>This is the number of arrangements, or combinations and also the binomial coefficients. Equation 13e is a good approximation to the number of arrangements of groups of spins, when <span class="math notranslate nohighlight">\(N\)</span> is large and the temperature is not zero, thus <span class="math notranslate nohighlight">\(\Omega \approx \Omega '\)</span>. The good agreement, Figure 23, between the equation describing the entropy per spin and that obtained from the spin state on using the Metropolis algorithm shows that this is a good approximation.</p>
<p>When <span class="math notranslate nohighlight">\(T\to \infty\)</span> , the number of spin arrangements must be greatest because the interaction between spins is unimportant compared to thermal energy. From eqn 13e, this occurs when <span class="math notranslate nohighlight">\(N_p = N/2\)</span>, and provided <span class="math notranslate nohighlight">\(N\)</span> is large <span class="math notranslate nohighlight">\(\Omega_{max}\to 2^N\)</span>. The maximum entropy is therefore <span class="math notranslate nohighlight">\(S_{max} = Nk_B\ln(2)\)</span> and the entropy per spin when <span class="math notranslate nohighlight">\(T \to \infty\)</span> is  <span class="math notranslate nohighlight">\( k_B \ln(2)\)</span>. This is the same result as obtained from theory. Because the entropy depends on <span class="math notranslate nohighlight">\(N\)</span>, this result demonstrates that entropy is an extensive quantity. At <span class="math notranslate nohighlight">\(T = 0\)</span>, all the couplings between spins will be the same (at <span class="math notranslate nohighlight">\(-J\)</span>) and one group of spins exists, and thus, a value of <span class="math notranslate nohighlight">\(\Omega = 1\)</span> might seem appropriate and this would make the entropy zero. However, because of the quantum properties of electron spin, two ground states exit and because both of these are populated at <span class="math notranslate nohighlight">\(T = 0, \; \Omega = 2\)</span> and the total entropy is <span class="math notranslate nohighlight">\(k_B\ln(2)\)</span>. When <span class="math notranslate nohighlight">\(N \to \infty\)</span>, the entropy per spin tends to zero, <span class="math notranslate nohighlight">\(S_0 = k_B\ln(2)/ N \to 0\)</span>, in accordance with the third law of thermodynamics.</p>
<p>Within statistical variation, the entropy per spin obtained by counting groups of spins and using eq 13e and that calculated from theory are the same, see Figure 24.</p>
<p><img alt="Drawing" src="../_images/monte-carlo-fig24.png" /></p>
<p>Figure 24.  Examples of spin states for <span class="math notranslate nohighlight">\(500\)</span> spins and <span class="math notranslate nohighlight">\(2000\)</span> samples/ spin and with <span class="math notranslate nohighlight">\(J/k_B =1\)</span> K at <span class="math notranslate nohighlight">\(T=1/2\)</span>, top ,<span class="math notranslate nohighlight">\(1\)</span> K middle, and <span class="math notranslate nohighlight">\(10\)</span> K bottom. The pattern at <span class="math notranslate nohighlight">\(T=1/2\)</span> K contains <span class="math notranslate nohighlight">\(15\)</span> groups since the blue areas correspond to one spin state and white the other.</p>
<hr class="docutils" />
<p>Finally, we note that <span class="math notranslate nohighlight">\(S = k_B\ln(\Omega)\)</span> is derived using a micro-canonical ensemble, (<span class="math notranslate nohighlight">\(N,\; V,\; E\)</span> constant), whereas the entropy calculated using the partition function is derived from a canonical ensemble (<span class="math notranslate nohighlight">\(N, \;V, \;T\)</span> constant). Energy fluctuations are permitted in the canonical ensemble but energy is fixed in the micro-canonical ensemble. This inherent difference does not contradict their equivalency, provided that the size of the fluctuations becomes vanishingly small in the canonical ensemble, which it does in the limit of large <span class="math notranslate nohighlight">\(N\)</span>. The argument to demonstrate this follows along the lines of that above where the energy dispersion <span class="math notranslate nohighlight">\(\sigma\)</span>  is now interpreted as the energy fluctuation of the canonical ensemble. The ratio of energy fluctuation to average energy <span class="math notranslate nohighlight">\(\sigma/\langle E\rangle \approx  1/\sqrt{N}\)</span>, becomes vanishingly small as N increases.</p>
<p><img alt="Drawing" src="../_images/monte-carlo-fig25.png" /></p>
<p>Figure 25. The open circles show the Monte Carlo calculated spin entropy as <span class="math notranslate nohighlight">\(\langle S\rangle/k_BN\)</span> vs temperature with <span class="math notranslate nohighlight">\(J/k_B = 1\)</span> K using eqn. 13e. At each temperature and <span class="math notranslate nohighlight">\(J\)</span> value, <span class="math notranslate nohighlight">\(N = 500\)</span> and <span class="math notranslate nohighlight">\(4000\)</span> samples/spin were taken. The solid lines are calculated with the theoretical function,see text. The high temperature limit for both <span class="math notranslate nohighlight">\(J\)</span> values was calculated at <span class="math notranslate nohighlight">\(T = 100\)</span> and was effectively <span class="math notranslate nohighlight">\(k_BN\ln(2)\)</span>. This limit is indicated by the horizontal grey  line which has a value of <span class="math notranslate nohighlight">\(\ln(2)\)</span>.</p>
<hr class="docutils" />
<p>At the end of the calculation, the array <span class="math notranslate nohighlight">\(\mathtt{spin}\)</span> contains the final pattern of spins. The number of changes in adjacent spins can be calculated as shown here, and then equation 13e used to calculate the entropy / spin. However, this equation can involve some very big numbers that can easily exceed the maximum allowable. In which case the after some algebra the binomial coefficients should be calculated which avoids these large numbers. The <span class="math notranslate nohighlight">\(\mathtt{BinCoeff()}\)</span> procedure does this. It works because <span class="math notranslate nohighlight">\(p!\)</span> can always be divided into <span class="math notranslate nohighlight">\(N!\)</span>. Figure 25 shows the results of the calculation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#-------------</span>
<span class="k">def</span> <span class="nf">BinCoeff</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>  
    <span class="n">r</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">i</span>
    <span class="k">return</span> <span class="n">r</span>
<span class="c1">#-------------</span>
<span class="k">def</span> <span class="nf">get_entropy</span><span class="p">(</span><span class="n">spin</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="mi">1</span>                              <span class="c1"># start at 1 to get groups</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">L</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">spin</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">spin</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">pass</span>
        <span class="k">pass</span>
    <span class="c1">#print(&quot; entropy/(kB*N) &quot;, np.log( binomialCoeff(N,p) ) /L )</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span> <span class="n">BinCoeff</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">p</span><span class="p">)</span> <span class="p">)</span> <span class="o">/</span><span class="n">L</span> 
<span class="c1">#-------------</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="phase-change">
<h3><strong>Phase Change</strong><a class="headerlink" href="#phase-change" title="Permalink to this headline">¶</a></h3>
<p>The gradual and continuous change in the heat capacity and entropy indicates that the phase transition between ordered and disordered spins is unlike the familiar first-order or ‘all-or-none’ phase transitions or even that in the two-dimensional Ising spin model, see below. Whereas the general change in <span class="math notranslate nohighlight">\(C_V\)</span> and <span class="math notranslate nohighlight">\(S\)</span> with temperature is similar to that of a normal substance (<span class="math notranslate nohighlight">\(\mathrm{O_2,\; H_2O}\)</span>, etc.), the detail is quite different. This is because in the 1-D spin case the heat capacity increases and decreases in a continuous manner with increasing temperature. Similarly, the entropy smoothly increases with temperature to reach its final value. In a normal substance, however, there is a step change both in CV and S at a phase boundary. The cause of the different behavior is because, energetically, it is more favorable for two regions of opposite spins to co-exist than it is for either one or the other to exist on its own. Interestingly, a similar behavior occurs with the co-existence of helix and coil regions in proteins.</p>
</div>
<div class="section" id="magnetisation">
<h3><strong>Magnetisation</strong><a class="headerlink" href="#magnetisation" title="Permalink to this headline">¶</a></h3>
<p>The magnetisation <span class="math notranslate nohighlight">\(M\)</span> can also be calculated via <span class="math notranslate nohighlight">\(M=\sum_ks_k\)</span> and from this the susceptibility</p>
<div class="math notranslate nohighlight">
\[\displaystyle \chi = \frac{1}{k_BT}\left( \langle M^2\rangle - \langle M\rangle^2   \right)\]</div>
<p>which can be measured experimentally. The susceptibility is formally the magnetisation divided by the magnetic field intensity, <span class="math notranslate nohighlight">\(\partial \langle M\rangle /\partial B\)</span>.</p>
<p>There is no spontaneous magnetisation in a 1-D spin system except at <span class="math notranslate nohighlight">\(0\)</span> K. To illustrate why the average magnetisation <span class="math notranslate nohighlight">\(M\)</span> is small even at low temperatures, consider a chain of <span class="math notranslate nohighlight">\(N+1\)</span> spins at absolute zero so that they are all aligned parallel to one another. Recall that the energy is determined by the interaction between spins and, as they are aligned parallel to one another, the total interaction energy is <span class="math notranslate nohighlight">\(-JN\)</span>. If each spin has a magnetic moment <span class="math notranslate nohighlight">\(\mu\)</span>  (J T<span class="math notranslate nohighlight">\(^{-1}\)</span>), the magnetisation is <span class="math notranslate nohighlight">\(\mu( N + 1) \approx \mu N\)</span> when <span class="math notranslate nohighlight">\(N\)</span> is large. Suppose that just sufficient energy is added so that the entire first half of the spins is inverted making the total magnetisation exactly zero. At the interface, two spins are paired (anti-parallel) with coupling energy <span class="math notranslate nohighlight">\(J\)</span> (see fig. 12e ) and all the rest have energy <span class="math notranslate nohighlight">\(-J\)</span>, making the total energy <span class="math notranslate nohighlight">\(-J(N-1)+J =-J(N-2)\)</span>.</p>
<p>Because <span class="math notranslate nohighlight">\(N\)</span> is vast, the total is effectively the same as when all spins are aligned. Consequently, at temperatures higher than <span class="math notranslate nohighlight">\(\approx J / Nk_B\)</span> , which is vanishingly small for large <span class="math notranslate nohighlight">\(N\)</span>, there is insufficient energy to stabilise the aligned spin state compared to disordered ones, and the overall magnetisation is close to zero.</p>
<p><img alt="Drawing" src="../_images/monte-carlo-fig26.png" /></p>
<p>figure 26. left: Magnetisation /spin vs temperature. Notice how rapidly this decreases with temperature to become approximately zero. This may also be seen in figure 24 where patterns of spins are shown. Right. The magnetic susceptibility vs temperature, <span class="math notranslate nohighlight">\(\displaystyle \chi = \frac{1}{k_BT}\left( \langle M^2\rangle - \langle M\rangle^2   \right)\)</span>.</p>
</div>
<hr class="docutils" />
<div class="section" id="algebraic-calculation-of-1d-ising-spin-energy">
<h3><strong>Algebraic calculation of 1D Ising spin energy</strong><a class="headerlink" href="#algebraic-calculation-of-1d-ising-spin-energy" title="Permalink to this headline">¶</a></h3>
<p>The partition function is defined as <span class="math notranslate nohighlight">\(\displaystyle Z = \sum_\alpha e^{-E_\alpha /k_BT}\)</span></p>
<p>for energy levels <span class="math notranslate nohighlight">\(E_\alpha\)</span>. In 1-D, the energy of the Ising spin state <span class="math notranslate nohighlight">\(\alpha\)</span> in the absence of a magnetic field, is</p>
<div class="math notranslate nohighlight">
\[\displaystyle E_\alpha = -J\sum_{k=1}^Ns_ks_{k+1}\]</div>
<p>where the index <span class="math notranslate nohighlight">\(k\)</span> covers all <span class="math notranslate nohighlight">\(N\)</span> spins. Because the interaction couples adjacent spins, when <span class="math notranslate nohighlight">\(Z\)</span> is evaluated, the sums become mixed producing a product of summations:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\displaystyle \begin{align}
Z&amp;=\sum_{s_1=-1}^1\sum_{s_2=-1}^1\cdots \sum_{s_N=-1}^1 \exp(+\frac{J}{k_BT}\sum_{k}^Ns_ks_{k+1}) \\
&amp;= \sum_{s_1=-1}^1\sum_{s_2=-1}^1\cdots \sum_{s_N=-1}^1 e^{Js_1s_2/k_BT}e^{Js_2s_3/k_BT}\cdots e^{Js_Ns_{N+1}/k_BT}  \end{align} \end{split}\]</div>
<p>This expression has <span class="math notranslate nohighlight">\(N\)</span> terms but the last spin has index <span class="math notranslate nohighlight">\(k +1 = N +1\)</span>. To deal with this a boundary condition is necessary and we use <span class="math notranslate nohighlight">\(N +1\to 1\)</span>, thus the summation becomes,</p>
<div class="math notranslate nohighlight">
\[\displaystyle Z = \sum_{s_1=-1}^1\sum_{s_2=-1}^1\cdots \sum_{s_N=-1}^1 e^{Js_1s_2/k_BT}e^{Js_2s_3/k_BT}\cdots e^{Js_Ns_1/k_BT}\]</div>
<p>where only the last term is changed. The result becomes apparent if the sums are expanded out first with just a few terms, and then converted to hyperbolic form ( <span class="math notranslate nohighlight">\(2\cosh(x) = e^x+e^{-x}\)</span>). The general pattern can be seen most easily with an even number of summation terms. The result by induction to <span class="math notranslate nohighlight">\(N\)</span> terms is</p>
<div class="math notranslate nohighlight">
\[\displaystyle Z=\left(2\cosh\left( \frac{J}{k_BT} \right)  \right)^N+  \left(2\sinh\left( \frac{J}{k_BT} \right)  \right)^N  \]</div>
<p>In the limit of large <span class="math notranslate nohighlight">\(N\)</span> and except when <span class="math notranslate nohighlight">\(T \to 0\)</span> , the sinh term is small compared to the cosh, hence, to a very good approximation,</p>
<div class="math notranslate nohighlight">
\[\displaystyle Z=\left(2\cosh\left( \frac{J}{k_BT} \right)  \right)^N  \]</div>
<p>The energy, heat capacity and entropy per spin (i.e. energy/<span class="math notranslate nohighlight">\(N\)</span>) calculated from <span class="math notranslate nohighlight">\(Z\)</span>, in the absence of a magnetic field, are respectively,</p>
<div class="math notranslate nohighlight">
\[\begin{split}\displaystyle \begin{align}
E&amp;=-J\tanh\left(\frac{J}{k_BT}  \right) \\[5pt] 
C_V&amp;=k_B\left(\frac{2J}{k_BT(e^{J/k_BT}+e^{-J/k_BT} )}  \right)^2 = k_B\left(\frac{2J}{k_BT}\mathrm{sech}\left( \frac{J}{k_BT} \right)  \right)^2\\[10pt]
S&amp;=k_B\ln\left(e^{2J/k_BT}+1  \right) -\frac{2J}{T} \frac{e^{2J/k_BT}}{e^{2J/k_BT} +1}\\[10pt]
\end{align} \end{split}\]</div>
<p>The thermodynamic functions can be obtained from the partition function (at constant volume) using</p>
<div class="math notranslate nohighlight">
\[\displaystyle E=k_BT^2d\ln(Z)/dT,\quad  S=k_BT\ln(Z)+E/T, \quad  C_V= dE/dT\]</div>
</div>
</div>
<div class="section" id="id1">
<h2>2D Spin model<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>The energy of the 2D Ising spin system is given by</p>
<div class="math notranslate nohighlight">
\[\displaystyle E=-J\sum^n_{\alpha,\beta}s_\alpha s_\beta -B\sum_\alpha^n s_\alpha\]</div>
<p>where, as before, <span class="math notranslate nohighlight">\(J\)</span> is the exchange coupling and <span class="math notranslate nohighlight">\(B\)</span> is the external magnetic field which we will now take to be zero to simplify the calculation. The indices on the summations need some explanation. The exchange interaction operates between two spins and is of short range, decreasing exponentially with the distance apart of the two spins. The decrease is so sharp with separation that only near neighbours have any interaction worth considering. On a square lattice, this means that only spins north, south, east, and west of any one spin interact, as shown in the diagram Fig. 27, where the spins are represented as filled and open diamonds. The double summation term</p>
<div class="math notranslate nohighlight">
\[\displaystyle \sum^n_{\alpha,\beta}s_\alpha s_\beta=\sum_{\alpha =0}s_\alpha \sum_{\beta=0} s_\beta\]</div>
<p>indicates that each spin in turn (index <span class="math notranslate nohighlight">\(\alpha = 0\cdots n-1\)</span>) adds a contribution from each of its four neighbours (north, south, east, and west) to the sum, <span class="math notranslate nohighlight">\(\sum^3_{\beta=0}=s_N+s_S+s_E+s_W\)</span> but the index <span class="math notranslate nohighlight">\(\alpha\)</span> runs over all spins. If the spins are represented as a two-dimensional array, then <span class="math notranslate nohighlight">\(\alpha\)</span> represents the pair of indices covering each row and column.</p>
<p>In the Ising model, the change of energy between configurations takes a particularly simple form. It can be obtained directly without having to add up the total energy for each of the two types of states and then subtracting them. The difference in energy, Fig. 12.13, left to right is due to flipping one spin. If the spin has a value, either filled diamond = <span class="math notranslate nohighlight">\(+1\)</span> or empty diamond  = <span class="math notranslate nohighlight">\(-1\)</span>, then the energy on the left is <span class="math notranslate nohighlight">\(E_1 =-J(1+1+1-1)=-2J\)</span> as three of the <em>spin pairs</em> have the same value. The other configuration shown with the central spin flipped is <span class="math notranslate nohighlight">\(E_2 = -J(-1 - 1 - 1 + 1) = 2J\)</span>; the difference is therefore <span class="math notranslate nohighlight">\(_E2 - E_1 = 4J\)</span>. Considering all other possible arrangements of the four neighbouring spins, produces only five energy differences. However, because the spin that is flipped is also a neighbour to other spins, the total value of the summations for <span class="math notranslate nohighlight">\(E\)</span> always produces an extra factor of <span class="math notranslate nohighlight">\(2\)</span> compared to the energy differences of only the near neighbours. The values are <span class="math notranslate nohighlight">\(\Delta E = -8 J, -4J, 0, +4J, +8 J\)</span>. The energy difference occurring at a spin <span class="math notranslate nohighlight">\(k\)</span> can be written in a general way as <span class="math notranslate nohighlight">\(\Delta E_k = 2Js_k^0 \sum^3_{\beta=0}s_\beta\)</span> where <span class="math notranslate nohighlight">\(\beta\)</span> indexes only the four nearest neighbours and <span class="math notranslate nohighlight">\(s^0_k=\pm 1\)</span> is the value of the spin before flipping.</p>
<p><img alt="Drawing" src="../_images/monte-carlo-fig27.png" /></p>
<p>Figure 27. Two patterns of spins in the Ising model. The dotted line shows the near neighbours to the central spin, which is flipped between the two configurations.</p>
<hr class="docutils" />
<p>The Metropolis algorithm compares the energy differences between configurations: if <span class="math notranslate nohighlight">\(\Delta E\)</span> is negative or zero, the difference is accepted directly; if not, <span class="math notranslate nohighlight">\(\displaystyle e^{-\Delta E/k_BT}\)</span> is calculated and compared to a random number. This means that only the two positive values of <span class="math notranslate nohighlight">\(\Delta E\)</span> are ever used to calculate the exponential, and this is very fortunate because calculating exponentials is a relatively slow process on a computer. These values can be calculated once at the start of the calculation and then used repeatedly. The quantities needed at the end of the calculation are usually the energy <span class="math notranslate nohighlight">\(E\)</span>, heat capacity <span class="math notranslate nohighlight">\(C_V\)</span>, magnetization <span class="math notranslate nohighlight">\(M\)</span>, and magnetic susceptibility <span class="math notranslate nohighlight">\(\chi\)</span>. The total energy can be calculated ‘on the fly’ by repeatedly adding <span class="math notranslate nohighlight">\(\Delta E\)</span> to the initial energy which is <span class="math notranslate nohighlight">\(-2JN\)</span>, if the spins are initially all set at <span class="math notranslate nohighlight">\(+1\)</span>. The magnetization is just the sum of the spins <span class="math notranslate nohighlight">\(M = \sum_\alpha s_\alpha\)</span> , and if this is required at each step, a considerable
amount of computer time will be spent just doing this. However, if,say,  <span class="math notranslate nohighlight">\(10^6\)</span> total steps are needed, then only one in every few thousand <span class="math notranslate nohighlight">\(M\)</span>’s need be calculated to represent how this varies as the calculation proceeds. Alternatively, the last <span class="math notranslate nohighlight">\(1000\)</span> or so values could be averaged.</p>
<p>To simplify the calculation, we can make <span class="math notranslate nohighlight">\(J = 1\)</span> and <span class="math notranslate nohighlight">\(k_B = 1\)</span>, and use the temperature to change <span class="math notranslate nohighlight">\(J/K_BT\)</span> as was done for the 1D case. This simple change does not affect any calculation, because <span class="math notranslate nohighlight">\(E\)</span> can always be scaled with a different value of <span class="math notranslate nohighlight">\(J\)</span> at the end of the calculation, but it has the important practical effect of making the calculation wholly that of adding or subtracting integers, which is fast. Finally, any calculation can only use a finite lattice of points and this raises the important question of what to do at the edges. One always uses <em>periodic boundary conditions</em> and this jargon means that the lattice is wrapped around on itself, like a snake biting its tail, or like folding a piece of paper onto a cylinder. This is achieved by checking the indices and changing them when they run off an edge and then bringing them back in the same place but on the opposite side.</p>
<p>One run of the algorithm with <span class="math notranslate nohighlight">\(25000\)</span> samples per spin, or <span class="math notranslate nohighlight">\(900000\)</span> samples in total on a six by six lattice, produces the result <span class="math notranslate nohighlight">\(E = -1.75 \pm 0.3\)</span> and <span class="math notranslate nohighlight">\(C_V = 0.686\)</span> with <span class="math notranslate nohighlight">\(T = 2\)</span>. Figure 28 shows <span class="math notranslate nohighlight">\(C_V\)</span> and the magnetization per spin on a two-dimensional lattice of sixteen by sixteen elements at <span class="math notranslate nohighlight">\(25000\)</span> samples / spin at several values of <span class="math notranslate nohighlight">\(k_BT/J\)</span> together with the theoretical result</p>
<div class="math notranslate nohighlight">
\[\displaystyle M_{Th} = (1 - \sinh^{-4}(2J/k_BT))^{1/8}\]</div>
<p><img alt="Drawing" src="../_images/monte-carlo-fig28.png" /></p>
<p>Figure 28. Ising model calculations using the Metropolis method on a <span class="math notranslate nohighlight">\(16 \times 16\)</span> lattice. Left: Heat capacity vs. temperature as <span class="math notranslate nohighlight">\(k_BT\)</span>. Right: Theoretical magnetization (solid line) for an infinite lattice and calculated points for the sixteen by sixteen lattice.</p>
<hr class="docutils" />
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Algorithm  2D Ising model.  This is a very slow calculation</span>
<span class="c1"># this is only a stub with the main loop</span>
<span class="c1"># see the 1D algorithm for other details. </span>
<span class="c1"># Note that 2 random number lists are needed</span>
<span class="c1">#---------------------------</span>
<span class="k">def</span> <span class="nf">ising2d</span><span class="p">(</span><span class="n">beta</span><span class="p">):</span>
    
    <span class="n">rndi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">size</span> <span class="o">=</span> <span class="n">N</span><span class="p">)</span>      <span class="c1"># make list of random numbers 0 to L-1 used as indices</span>
    <span class="n">rndk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">size</span> <span class="o">=</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">spin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">L</span><span class="p">,</span><span class="n">L</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>          <span class="c1"># spinlattice</span>
    <span class="n">prob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>            <span class="c1"># array for exp(-deltaE/kBT)</span>
    <span class="c1"># 2*( -4,-2, 0, 2, 4) only positive used, 0 is checked for</span>
    <span class="n">prob</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">4.0</span><span class="o">*</span><span class="n">beta</span><span class="p">)</span>               <span class="c1"># all rest not used so are zero</span>
    <span class="n">prob</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">8.0</span><span class="o">*</span><span class="n">beta</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">L</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">L</span><span class="p">):</span>
            <span class="n">spin</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">=</span> <span class="mi">1</span>                      <span class="c1"># initial distribution T = 0</span>
        <span class="k">pass</span>
    
    <span class="n">Enrg</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">n</span>                              <span class="c1"># energy when all spins are +1      </span>
    <span class="n">tot_Enrg</span>  <span class="o">=</span> <span class="mf">0.0</span> 
    <span class="n">tot_Enrg2</span> <span class="o">=</span> <span class="mf">0.0</span> 
    <span class="n">M</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">mag</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>                  <span class="c1"># start calc</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">rndi</span><span class="p">[</span><span class="n">num</span><span class="p">]</span>  
        <span class="n">k</span> <span class="o">=</span> <span class="n">rndk</span><span class="p">[</span><span class="n">num</span><span class="p">]</span>                     <span class="c1"># choose random indices from list</span>
        
        <span class="n">indx1</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>                     <span class="c1"># get adjacent site on right   </span>
        <span class="k">if</span> <span class="n">indx1</span> <span class="o">&gt;</span> <span class="n">L</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span> <span class="n">indx1</span> <span class="o">=</span> <span class="mi">0</span>       <span class="c1"># if right boundary  go to left-most</span>
        
        <span class="n">indx2</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>                     <span class="c1"># adjacent left </span>
        <span class="k">if</span> <span class="n">indx2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>     <span class="n">indx2</span> <span class="o">=</span> <span class="n">L</span> <span class="o">-</span> <span class="mi">1</span>   <span class="c1"># if left boundary  go to right-most</span>
  
        <span class="n">indx3</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span>                     <span class="c1"># adjacent above</span>
        <span class="k">if</span> <span class="n">indx3</span> <span class="o">&gt;</span> <span class="n">L</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span> <span class="n">indx3</span> <span class="o">=</span> <span class="mi">0</span>       <span class="c1"># if top  go to bottom</span>
            
        <span class="n">indx4</span> <span class="o">=</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span>                     <span class="c1"># adjacent below</span>
        <span class="k">if</span> <span class="n">indx4</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>     <span class="n">indx4</span> <span class="o">=</span> <span class="n">L</span> <span class="o">-</span> <span class="mi">1</span>   <span class="c1"># if bottom  go to top</span>
 
        <span class="n">sum_nn</span> <span class="o">=</span> <span class="n">spin</span><span class="p">[</span><span class="n">indx1</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">spin</span><span class="p">[</span><span class="n">indx2</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">spin</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">indx3</span><span class="p">]</span> <span class="o">+</span> <span class="n">spin</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">indx4</span><span class="p">]</span> 
        <span class="n">DeltaE</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">spin</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">*</span><span class="n">sum_nn</span>          <span class="c1"># # -2*old value*( -J )*neigbours </span>
        
        <span class="k">if</span> <span class="n">DeltaE</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">ranf</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">prob</span><span class="p">[</span><span class="n">DeltaE</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">:</span>  <span class="c1"># Metropolis test</span>
            <span class="n">spin</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">=</span> <span class="o">-</span><span class="n">spin</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span>            <span class="c1"># flip spin</span>
            <span class="n">Enrg</span> <span class="o">=</span> <span class="n">Enrg</span> <span class="o">+</span> <span class="n">DeltaE</span>             <span class="c1"># increment</span>
            <span class="c1">#mag = mag +2*spin[i,k]</span>
            <span class="k">pass</span> 
        <span class="n">tot_Enrg</span> <span class="o">=</span> <span class="n">tot_Enrg</span> <span class="o">+</span> <span class="n">Enrg</span>           <span class="c1"># energy</span>
        <span class="n">tot_Enrg2</span><span class="o">=</span> <span class="n">tot_Enrg2</span> <span class="o">+</span> <span class="n">Enrg</span><span class="o">**</span><span class="mi">2</span>       <span class="c1"># energy2</span>
        <span class="k">if</span> <span class="n">num</span> <span class="o">&gt;</span> <span class="n">N</span><span class="o">-</span><span class="mi">10000</span><span class="p">:</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">M</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">spin</span><span class="p">))</span>
        <span class="k">pass</span>
    <span class="k">return</span>  <span class="n">tot_Enrg</span><span class="p">,</span> <span class="n">tot_Enrg2</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span><span class="n">spin</span>                              <span class="c1"># end of for num loop</span>
<span class="c1">#------------------------------</span>
<span class="n">L</span>  <span class="o">=</span> <span class="mi">16</span>           <span class="c1"># side </span>
<span class="n">n</span>  <span class="o">=</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span>
<span class="n">N</span>  <span class="o">=</span> <span class="n">n</span><span class="o">*</span><span class="mi">25</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span>   <span class="c1"># integer  use 10**3 for pics</span>
<span class="n">J</span>  <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">kB</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">T</span>  <span class="o">=</span> <span class="mf">2.0</span>    
<span class="n">beta</span> <span class="o">=</span> <span class="n">J</span><span class="o">/</span><span class="p">(</span> <span class="n">kB</span><span class="o">*</span><span class="n">T</span> <span class="p">)</span>

<span class="c1">#tot_E,tot_E2,tot_M,spin = ising2d(beta)  # remove # to do calculation which is v slow.</span>

<span class="c1">#print(tot_E,tot_E2,tot_M,&#39;\n&#39;,spin)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./chapter-12"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="monte-carlo-Q11-17.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Questions 11 - 17</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="monte-carlo-answers1-6.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Solutions Q1 - 6</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Godfrey Beddard<br/>
        
            &copy; Copyright 2022.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>