
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>4 Numerical solution of differential equations &#8212; Applying Maths in the Chemical &amp; Biomolecular Sciences</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Questions 8 - 12" href="num-methods-Q8-12.html" />
    <link rel="prev" title="Questions 1 - 7" href="num-methods-Q1-7.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/book-cover.jpg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Applying Maths in the Chemical & Biomolecular Sciences</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Applying Maths in the Chemical and Biomolecular Sciences.
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../chapter-1/chapter1-intro.html">
   1 Numbers, Equations, Operators, and Algorithms.
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-1/chapter1-A.html">
     1 Numbers to Algorithms.
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-1/chapter1-Q1-7.html">
     Questions 1 - 7
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-1/chapter1-B.html">
     5 Trig, hyperbolic and inverse functions, waves, polar coordinates &amp; factorials
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-1/chapter1-Q8-16.html">
     Questions 8 - 16
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-1/chapter1-C.html">
     9 Sophisticated Counting.
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-1/chapter1-Q17-34.html">
     Questions 17 - 34
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-1/chapter1-D.html">
     10 Modulo arithmetic,
     <span class="math notranslate nohighlight">
      \(\delta\)
     </span>
     functions, types of  series &amp;  estimating quantities
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-1/chapter1-Q35-39.html">
     Questions 35 - 39
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-1/chapter1-answers-1-7.html">
     Solutions Q1 - 7
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-1/chapter1-answers-8-16.html">
     Solutions Q8 - 16
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-1/chapter1-answers-17-34.html">
     Solutions Q17 - 34
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-1/chapter1-answers-35-39.html">
     Solutions Q35 - 39
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../chapter-2/chapter2-intro.html">
   2. Complex numbers.
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-2/chapter2-A.html">
     1 Real, imaginary, conjugate and modulus
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-2/chapter2-Q-1-9.html">
     Questions 1 - 9
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-2/chapter2-B.html">
     3 De Moivreâ€™s theorem and integer powers of complex numbers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-2/chapter2-Q-10-13.html">
     Questions 10 -13
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-2/chapter2-Q-14-29.html">
     Questions 14 - 29
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-2/chapter2-answers.html">
     Solutions Q1 - 27
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../chapter-3/differen-intro.html">
   3. Differentiation.
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-A.html">
     1 - 3.8 Differentiation, gradients &amp; basic functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-B.html">
     3.9 Trig functions, logs, power, reciprocals and integrals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-C-Q-4-11.html">
     Questions 1-11
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-D.html">
     4 Product rule and function of function or chain rule.
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-E-Q-12-42.html">
     Questions 12-42
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-F.html">
     6 Limits, lâ€™Hopitalâ€™s rule, Maximum, Minimum and Calculus of Variations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-G-Q-43-73.html">
     Questions 43 - 73
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-H.html">
     9 Numerically finding the roots of an equation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-I-Q-74-85.html">
     Questions 74 - 85
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-J.html">
     10 Minimizing or maximizing with constraints: Lagrange Undetermined Multipliers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-K-Q-86-92.html">
     Questions 86 - 92
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-L.html">
     11 Partial differentiation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-M-Q-93-114.html">
     Questions 93-114
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-M1.html">
     12 Differentiation of vectors
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-N-answers-1-11.html">
     Solutions Q 1-11
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-O-answers-12-42.html">
     Solutions Q 12-42
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-P-answers-43-73.html">
     Solutions Q 43 - 73
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-Q-answers-74-85.html">
     Solutions Q 74 - 85
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-R-answers-86-92.html">
     Solutions Q 86 - 94
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-3/differen-S-answers-93-114.html">
     Solutions Q 93-114
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../chapter-4/integration-intro.html">
   4 Integration.
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-A.html">
     1 Integration basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-Q1-14.html">
     Questions 1-14
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-B.html">
     3 Integration by substitution and â€˜by partsâ€™. Differentiation and the Leibniz formula. Feynmanâ€™s â€˜Trickâ€™
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-Q15-30.html">
     Questions 15-30
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-C.html">
     6 Integration and parametric equations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-Q31-48.html">
     Questions 31 - 48
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-D.html">
     8 Calculating an Average.
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-Q49-72.html">
     Questions 49 - 72
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-E.html">
     9 The Variational Method in Quantum Mechanics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-Q73-77.html">
     Questions 73 - 77
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-F.html">
     10 Multiple integrals, Change of variables: Jacobians
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-Q78-86.html">
     Questions 78 - 86
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-G.html">
     12 Calculating the energy of a Chemical Bond using Molecular Orbitals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-H.html">
     13 Line integrals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-Q87-96.html">
     Questions 87 - 96
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-answers-1-14.html">
     Solutions Q1 - 14
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-answers-15-30.html">
     Solutions Q15 - 30
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-answers-31-48.html">
     Solutions Q31 - 48
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-answers-49-72.html">
     Solutions Q49 - 72
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-4/integration-answers-73-96.html">
     Solutions Q73 - 96
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../chapter-5/chapter-5-intro.html">
   5. Summations, Series and expansion of Functions.
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-5/chapter-5-A.html">
     1 Series, averages, partition functions, DNA melting, atom entropy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-5/chapter-5-B-Q1-13.html">
     Questions 1 - 13
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-5/chapter-5-E.html">
     6 Maclaurin and Taylor series expansions. Paramagnetic spins. Euler-Maclaurin formula.
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-5/chapter-5-F-Q14-34.html">
     Questions 14 - 34
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-5/chapter-5-G-Q35-44.html">
     Questions 35 - 44
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-5/chapter-5-perturbation-A.html">
     8 Perturbation Theory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-5/chapter-5-perturbation-B-Q45-48.html">
     Questions 45 - 48
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-5/chapter-5-perturbation-C.html">
     9 Quantum superposition and wavepackets.
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-5/chapter-5-perturbation-D-Q49-52.html">
     Questions 49 - 52
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-5/chapter-5-answers-1-7.html">
     Solutions Q 1 - 7
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-5/chapter-5-answers-8-13.html">
     Solutions Q8 - 13
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-5/chapter-5-answers-14-26.html">
     Solutions Q 14 - 26
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-5/chapter-5-answers-27-32.html">
     Solutions Q27 - 34
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-5/chapter-5-answers-33-44.html">
     Solutions Q33 - 44
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-5/chapter-5-answers-45-52.html">
     Solutions Q45 - 52
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../chapter-6/vectors-intro.html">
   6. Vectors.
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-A.html">
     1 Vector basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-Q1-24.html">
     Questions 1 - 24
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-B.html">
     6 Projections and components
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-Q25-32.html">
     Questions 25 - 32
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-C.html">
     8 Axes need not be right-angled or of equal length
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-Q33-38.html">
     Questions 33 - 38
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-D.html">
     12 Basis sets with more than three dimensions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-Q39-46.html">
     Questions 39 - 46
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-E.html">
     15 Cross product or vector product
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-Q47-52.html">
     Questions 47 - 52
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-F.html">
     18 Torsion or dihedral angles
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-Q53-48.html">
     Questions 53 - 48
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-G.html">
     21 Torque and angular momentum
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-Q59-61.html">
     Questions 59 - 61
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-answers-Q1-24.html">
     Solutions Q1 - 24
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-answers-Q25-32.html">
     Solutions Q25 - 32
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-answers-Q33-38.html">
     Solutions Q33 - 38
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-answers-Q39-46.html">
     Solutions Q39 - 46
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-answers-Q47-52.html">
     Solutions Q47 - 52
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-6/vectors-answers-Q53-61.html">
     Solutions Q53 - 61
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../chapter-7/matrices-intro.html">
   7. Matrices
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-A.html">
     1 Determinants
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-Q1-10.html">
     Questions  1 - 10
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-B.html">
     4 Matrices
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-Q11-16.html">
     Questions  11 - 16
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-C.html">
     6 Molecular Group Theory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-Q17-30.html">
     Questions  17 - 30
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-D.html">
     7 Rotation matrices: moving molecules. Coordinate transform as rotation.
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-Q31-34.html">
     Questions 31 - 34
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-E.html">
     9 Matrices in optics and designing laser cavities
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-Q35-39.html">
     Questions 35 - 39
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-F.html">
     11 Polarizing optics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-Q40-44.html">
     Questions 40 - 44
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-G.html">
     12 Solving equations using matrices. Eigenvectors and Eigenvalues.
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-Q45-50.html">
     Questions 45 - 50
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-H.html">
     13 Rate equations and Chemical Kinetics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-Q51-54.html">
     Questions 51 - 54
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-I.html">
     14 Molecular vibrations and pendulums
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-Q55-58.html">
     Questions 55 - 58
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-J.html">
     15 Moments of Inertia
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-Q59-60.html">
     Questions 59 - 62
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-L.html">
     16 Principal axes and Moments of Inertia
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-Q61-62.html">
     Question 61 - 62
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-answersQ1-10.html">
     Solutions Q1 - 10
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-answersQ11-16.html">
     Solutions Q11 - 16
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-answersQ17-30.html">
     Solutions Q17 - 30
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-answersQ31-34.html">
     Solutions Q31 - 34
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-answersQ35-39.html">
     Solutions Q35 - 39
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-answersQ40-44.html">
     Solutions Q40 - 44
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-answersQ45-50.html">
     Solutions Q45 - 50
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-answersQ51-54.html">
     Solutions Q51 - 54
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-answersQ55-58.html">
     Solutions Q55 - 58
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-7/matrices-answersQ59-61.html">
     Solutions Q59 - 61
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../chapter-8/matricesQM-intro.html">
   8. Matrices in Quantum Mechanics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-8/matricesQM-A.html">
     1 Matrices in Quantum Mechanics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-8/matricesQM-Q1-7.html">
     Questions 1 - 7
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-8/matricesQM-B.html">
     4 Basis sets and bra-ket algebra
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-8/matricesQM-Q8-12.html">
     Questions 8 - 12
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-8/matricesQM-C.html">
     5 Continuous basis sets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-8/matricesQM-answers1-7.html">
     Solutions Q1 - 7
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-8/matricesQM-answers8-12.html">
     Solutions Q8 - 12
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../chapter-9/Fourier-intro.html">
   9. Fourier Series and Transforms.
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-9/Fourier-A-B.html">
     1 Fourier series, Gibbs phenomenon, generalised series.
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-9/Fourier-questions-1-6.html">
     Questions 1 - 6
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-9/Fourier-C.html">
     5 Fourier Transforms
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-9/Fourier-questions-7-15.html">
     Questions 7 - 15
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-9/Fourier-D.html">
     7 Convolution and Autocorrelation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-9/Fourier-questions-16-21.html">
     Questions 16 - 21
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-9/Fourier-E.html">
     9 Discrete Fourier  (DFT)  and Fast Fourier transforms (FFT)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-9/Fourier-F.html">
     11 The Hadamard Transform: Encoding and Decoding
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-9/Fourier-answers-1-6.html">
     Solutions Q 1 - 6
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-9/Fourier-answers-7-15.html">
     Solutions Q 7 - 15
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-9/Fourier-answers-16-21.html">
     Solutions Q 16 - 21
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-9/Fourier-2D-Diffraction.html">
     12 The Fourier transform in two dimensions: images and x-ray Diffraction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-9/Fourier-tomography.html">
     14 Computed Tomography
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../chapter-10/Diff-eqns-intro.html">
   10. Differential Equations.
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-10/Diff-eqns-A.html">
     1 Basics, Initial and Boundary Value problems, Steady state, Phase portrait, Chemical kinetics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-10/Diff-eqns-Q1-23.html">
     Questions 1 - 23
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-10/Diff-eqns-B.html">
     9 First order equations &amp; Integrating factors. Second order equations, Newtonâ€™s laws and equations of motion.
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-10/Diff-eqns-C.html">
     12 The â€˜Dâ€™ operator.  Solving linear differential equations with constant coefficients
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-10/Diff-eqns-D.html">
     13 Simultaneous equations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-10/Diff-eqns-Q24-37.html">
     Questions 24 - 37
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-10/Diff-eqns-E.html">
     14 Linear equations with variable coefficients
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-10/Diff-eqns-F.html">
     15 Partial Differential Equations, PDE. 1D &amp; 2D diffusion, Particle in a box, Lateral flow tests, Diffusion and Reaction, Cable equation, Algal Blooms
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-10/Diff-eqns-G.html">
     16 PDE continued. Diffusion, Wave and Schroedinger eqns. Solution by the Fourier method. Transient grating.
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-10/Diff-eqns-answers-1-21.html">
     Solutions Q1 - 21
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-10/Diff-eqns-answers-22-37.html">
     Solutions Q22 - 37
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="num-methods-intro.html">
   11. Numerical Methods
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="num-methods-A.html">
     1 Numerical Methods
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="num-methods-Q1-7.html">
     Questions 1 - 7
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     4 Numerical solution of differential equations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="num-methods-Q8-12.html">
     Questions 8 - 12
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="num-methods-C.html">
     5 Coupled equations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="num-methods-Q13-16.html">
     Questions 13 - 16
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="num-methods-D.html">
     6 The phase plane, nullclines, and stable points
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="num-methods-Q17-20.html">
     Questions 17 - 20
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="num-methods-E.html">
     8 Reaction schemes with feedback
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="num-methods-Q21-34.html">
     Questions 21 - 34
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="num-methods-F.html">
     9 Boundary value problems.
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="num-methods-Q35-40.html">
     Questions 35 - 40
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="num-methods-answers1-7.html">
     Solutions Q1 - 7
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="num-methods-answers8-12.html">
     Solutions Q 8 - 12
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="num-methods-answers13-16.html">
     Solutions Q13 - 16
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="num-methods-answers17-20.html">
     Solutions Q17 - 20
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="num-methods-answers21-34.html">
     Solutions Q21 - 34
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="num-methods-answers35-40.html">
     Solutions Q35 - 40
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../chapter-12/monte-carlo-intro.html">
   12. Monte Carlo Methods
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-12/monte-carlo-A.html">
     1 Monte - Carlo integration &amp; importance sampling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-12/monte-carlo-Q1-6.html">
     Questions 1 - 6
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-12/monte-carlo-B.html">
     2 Solving rate equations. The Gillespie method
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-12/monte-carlo-Q7-10.html">
     Questions 7 - 10
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-12/monte-carlo-CC.html">
     3 Monte Carlo Simulations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-12/monte-carlo-C.html">
     4 Energy transfer. Autocatalytic reaction and spreading of fires
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-12/monte-carlo-Q11-17.html">
     Questions 11 - 17
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-12/monte-carlo-D.html">
     6 The Metropolis algorithm
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-12/monte-carlo-answers1-6.html">
     Solutions Q1 - 6
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-12/monte-carlo-answers7-10.html">
     Solutions Q7 - 10
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-12/monte-carlo-answers11-17.html">
     Solutions Q11 - 17
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../chapter-13/analysis-intro.html">
   13. Data Analysis
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
  <label for="toctree-checkbox-13">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-13/analysis-A.html">
     1 Characterizing experimental data. Accuracy, precision, mean and standard deviation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-13/analysis-Q1-3.html">
     Questions 1 - 3
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-13/analysis-B.html">
     6 Modelling data. Least squares, chi squared, residuals, ANNOVA
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-13/analysis-Q4-9.html">
     Questions 4 - 9
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-13/analysis-C.html">
     7 Modelling data is simpler using matrices
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-13/analysis-Q10-11.html">
     Questions 10 - 13
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-13/analysis-D.html">
     10 Non-linear least squares. Least absolute deviation. Principal component analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-13/analysis-answers1-11.html">
     Solutions Q1 -11
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../chapter-14/chapter14-intro.html">
   14 SI Units, Scientific Constants, unit conversion, Glossary, Python
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
  <label for="toctree-checkbox-14">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-14/chapter14-E.html">
     1 SI Units, Unit conversions, Scientific Constants
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chapter-14/Python%20crib.html">
     5 Appendix:  Some basic Python instructions with a few examples.
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../references/references-intro.html">
   15 References and index
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
  <label for="toctree-checkbox-15">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../references/References.html">
     1 References
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../references/index.html">
     2 Index
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/subblue/applying-maths-book/main?urlpath=lab/tree/applying_maths_book/chapter-11/num-methods-B.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/subblue/applying-maths-book/blob/main/applying_maths_book/chapter-11/num-methods-B.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/subblue/applying-maths-book"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/subblue/applying-maths-book/issues/new?title=Issue%20on%20page%20%2Fchapter-11/num-methods-B.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/chapter-11/num-methods-B.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#euler-s-and-other-methods-of-numerical-approximation">
   4.1 Eulerâ€™s and other methods of numerical approximation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#errors">
   4. 2 Errors
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-euler-s-method">
   4.3 Using Eulerâ€™ s method
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#improving-on-the-euler-method">
   Improving on the Euler method
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#modified-euler-or-heun-s-method">
   4.4 Modified Euler or Heunâ€™s method
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#runge-kutta-method">
   4.5 Runge - Kutta method
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#verlet-algorithm-calculating-dynamics-and-performing-md-simulations">
   4.6 Verlet algorithm: calculating dynamics and performing MD simulations
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#molecular-dynamics-simulations">
   4.7 Molecular dynamics simulations
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#other-verlet-algorithms">
   4.8 Other Verlet algorithms
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#basic-verlet-algorithm">
   4.9 Basic Verlet Algorithm
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-verlet-algorithm-used-to-calculate-atom-scattering-trajectories">
   4.10 The Verlet algorithm used to calculate atom scattering trajectories
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#numerical-solution-of-the-diffusion-equation-illustrated-with-transient-grating-decay">
   4.11  Numerical solution of the Diffusion equation illustrated with Transient Grating decay.
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#adding-a-reaction">
     <strong>
      Adding a reaction
     </strong>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#stability">
     <strong>
      Stability
     </strong>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#initial-conditions">
     <strong>
      Initial Conditions
     </strong>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-calculation-decay-of-transient-grating-see-also-chapter-10-18-5">
     <strong>
      Example Calculation: Decay of Transient Grating. ( See also chapter 10-18.5 )
     </strong>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#d-diffusion-in-a-plate">
   4.12 2D diffusion in a plate.
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#crank-nicholson-method-the-time-dependent-schroedinger-equation">
   4.13 Crank-Nicholson Method. The time-dependent Schroedinger equation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#wavepacket-motion">
     <strong>
      Wavepacket motion
     </strong>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#wavepacket-animation">
     <strong>
      Wavepacket Animation
     </strong>
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>4 Numerical solution of differential equations</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#euler-s-and-other-methods-of-numerical-approximation">
   4.1 Eulerâ€™s and other methods of numerical approximation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#errors">
   4. 2 Errors
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-euler-s-method">
   4.3 Using Eulerâ€™ s method
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#improving-on-the-euler-method">
   Improving on the Euler method
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#modified-euler-or-heun-s-method">
   4.4 Modified Euler or Heunâ€™s method
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#runge-kutta-method">
   4.5 Runge - Kutta method
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#verlet-algorithm-calculating-dynamics-and-performing-md-simulations">
   4.6 Verlet algorithm: calculating dynamics and performing MD simulations
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#molecular-dynamics-simulations">
   4.7 Molecular dynamics simulations
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#other-verlet-algorithms">
   4.8 Other Verlet algorithms
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#basic-verlet-algorithm">
   4.9 Basic Verlet Algorithm
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-verlet-algorithm-used-to-calculate-atom-scattering-trajectories">
   4.10 The Verlet algorithm used to calculate atom scattering trajectories
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#numerical-solution-of-the-diffusion-equation-illustrated-with-transient-grating-decay">
   4.11  Numerical solution of the Diffusion equation illustrated with Transient Grating decay.
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#adding-a-reaction">
     <strong>
      Adding a reaction
     </strong>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#stability">
     <strong>
      Stability
     </strong>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#initial-conditions">
     <strong>
      Initial Conditions
     </strong>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-calculation-decay-of-transient-grating-see-also-chapter-10-18-5">
     <strong>
      Example Calculation: Decay of Transient Grating. ( See also chapter 10-18.5 )
     </strong>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#d-diffusion-in-a-plate">
   4.12 2D diffusion in a plate.
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#crank-nicholson-method-the-time-dependent-schroedinger-equation">
   4.13 Crank-Nicholson Method. The time-dependent Schroedinger equation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#wavepacket-motion">
     <strong>
      Wavepacket motion
     </strong>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#wavepacket-animation">
     <strong>
      Wavepacket Animation
     </strong>
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="numerical-solution-of-differential-equations">
<h1>4 Numerical solution of differential equations<a class="headerlink" href="#numerical-solution-of-differential-equations" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import all python add-ons etc that will be needed later on</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">linalg</span>                <span class="c1"># import library to invert matrices</span>
<span class="n">init_printing</span><span class="p">()</span>                         <span class="c1"># print SymPy results in typeset maths format</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">})</span>  <span class="c1"># set font size for plots</span>
</pre></div>
</div>
</div>
</div>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">#</a></h2>
<p>Although many differential equations can be explicitly integrated, as illustrated in Chapter 10, there are many others of interest, particularly in quantum mechanics, that have no such solution other than by a series expansion and even this may only be approximate. In these cases a numerical solution must be sought; however, this is always preceded by as much algebraic analysis of the problem as is possible.</p>
<p>As with any integration, a constant is produced for each integration step; two constants are necessary for an equation with derivative <span class="math notranslate nohighlight">\(d^2y/dx^2\)</span> because two integrations are necessary to produce <span class="math notranslate nohighlight">\(y\)</span>. In differential equations, integration constants are found by using the initial values and/or the boundary values to <span class="math notranslate nohighlight">\(y\)</span> and its derivatives, and these are determined by the particular problem being solved. These are described in Chapter 10.</p>
</section>
<section id="euler-s-and-other-methods-of-numerical-approximation">
<h2>4.1 Eulerâ€™s and other methods of numerical approximation<a class="headerlink" href="#euler-s-and-other-methods-of-numerical-approximation" title="Permalink to this headline">#</a></h2>
<p>The analytic or algebraic solution to an equation produces a function whose values are continuous in <span class="math notranslate nohighlight">\(x,\, y\)</span>, or <span class="math notranslate nohighlight">\(t\)</span>, and that allows us to calculate its value at any point we might choose, there being, effectively, an infinite number to choose from. A general feature of the numerical solution of a differential equation is that it is converted into recursive finite - difference equation and this is because a numerical solution can be obtained only at relatively few discrete values. The general first-order differential equation is</p>
<div class="math notranslate nohighlight">
\[\displaystyle \frac{dy}{dt}=f(t,y)  \qquad\tag{16}\]</div>
<p>which means that <span class="math notranslate nohighlight">\(f(t, y)\)</span> is a function of <span class="math notranslate nohighlight">\(y\)</span> and <span class="math notranslate nohighlight">\(t\)</span> such as <span class="math notranslate nohighlight">\(te^{-t} + y + 3\)</span>. The initial condition is <span class="math notranslate nohighlight">\(y(t_0) = y_0\)</span>. The differential has to be approximated in some way, because we can only evaluate at discrete points, and the simplest way to do this is to write</p>
<div class="math notranslate nohighlight">
\[\displaystyle  \frac{\Delta y}{\Delta t}\approx \frac{dy}{dt}=f(t,y)  \qquad\tag{17}\]</div>
<p>If <span class="math notranslate nohighlight">\(\Delta t=t_{n+1}-t_n \equiv h\)</span> is small enough, then this first-order approximation is a good one. The change in <span class="math notranslate nohighlight">\(y\)</span> is calculated similarly,</p>
<div class="math notranslate nohighlight">
\[\displaystyle  \frac{\Delta y}{\Delta t}= \frac{y_{n+1}-y_n}{h}\approx f(t_n,y_n)  \qquad\tag{18}\]</div>
<p>Rearranging gives the Euler method equations</p>
<div class="math notranslate nohighlight">
\[\displaystyle  y_{n+1}=y_n+hf(t_n,y_n)  \qquad\tag{19a}\]</div>
<div class="math notranslate nohighlight">
\[\displaystyle  y_0=y(t_0), \qquad t_n=t_0+nh, \qquad n=0,\,1,\,2\cdots N-1 \qquad\tag{19b}\]</div>
<p>The <span class="math notranslate nohighlight">\(n^{th}\)</span> value of <span class="math notranslate nohighlight">\(t\)</span> is <span class="math notranslate nohighlight">\(t_n = t_0 + nh,\,t_0\)</span> being the initial time when <span class="math notranslate nohighlight">\(n = 0\)</span>, and the initial condition is <span class="math notranslate nohighlight">\(y(t_0)=y_0\)</span> .The times are <span class="math notranslate nohighlight">\(t_0,\,t_1 =t_0 +h,\,t_2 =t_0 +2h\)</span>, and so forth. The grey area in Fig 7 (left) is <span class="math notranslate nohighlight">\(hf(t_n, y_n)\)</span> which approximates the whole area under the curved line in the Euler method.</p>
<p>The calculation is easy to implement, but several terms have to be defined before starting. These are the initial condition, which means <span class="math notranslate nohighlight">\(t_0\)</span> and <span class="math notranslate nohighlight">\(y(t_0) = y_0\)</span>, the final time to stop the calculation <span class="math notranslate nohighlight">\(t_{max}\)</span>, and the number of points <span class="math notranslate nohighlight">\(N\)</span>. These will define <span class="math notranslate nohighlight">\(h\)</span> as <span class="math notranslate nohighlight">\(\displaystyle h= \frac{T_{max}-t_0}{N-1}\)</span>. Choosing <span class="math notranslate nohighlight">\(N\)</span> is not difficult; as a rule-of-thumb start with 100 points and see what happens, then repeatedly double or treble this value. Increasing <span class="math notranslate nohighlight">\(N\)</span> reduces <span class="math notranslate nohighlight">\(h\)</span> and this will often have to be <span class="math notranslate nohighlight">\(\ll\)</span> 0.01, but if it is too small, the calculation will take a considerable time to complete and therefore some compromise is always necessary.</p>
<p>Sometimes, the solution of the equation is sought to smaller values than <span class="math notranslate nohighlight">\(t_0\)</span>, effectively running the calculation backwards, which means making <span class="math notranslate nohighlight">\(h\)</span> negative. In this case, the time has to be reduced as <span class="math notranslate nohighlight">\(t_n=t_0-nh\)</span> and the consecutive values of y calculated as</p>
<div class="math notranslate nohighlight">
\[\displaystyle y_{n+1} = y_n - hf(t_n, y_n) \qquad\tag{20}\]</div>
<p><img alt="Drawing" src="../_images/num-methods-fig7.png" /></p>
<p>Fig. 7. The grey area is calculated in the Euler method (left) only very approximately measures the true area under the curve. On the right the improved Euler method is shown and is clearly better. The notation is <span class="math notranslate nohighlight">\(f_n \equiv f(t_n,y_n)\)</span>. The smaller <span class="math notranslate nohighlight">\(h\)</span> becomes the better the curve is approximated.</p>
</section>
<hr class="docutils" />
<section id="errors">
<h2>4. 2 Errors<a class="headerlink" href="#errors" title="Permalink to this headline">#</a></h2>
<p>Before carrying out the calculation, the error implicit in this method should be considered. There will always be an error associated with a numerical method because an approximation to the derivative has always to be made. The error takes two forms; the approximation to <span class="math notranslate nohighlight">\(dy/dx\)</span> produces a truncation error; a better approximation could be made by expanding this as a series. The truncation errors can be <em>local</em> or <em>global</em>, the local error is that produced in a single step, the global is that accumulated after many steps. Generally, a smaller value of <span class="math notranslate nohighlight">\(h\)</span> reduces these errors; conversely, too large a value, which may not be realised beforehand, can lead to instability with the solution becoming erratic. Some small amount of experimenting is often required to fix <span class="math notranslate nohighlight">\(h\)</span> to an appropriate value. There are complex ways of estimating the errors but, pragmatically, it is simpler to double the number of points repeatedly until no change in the calculated data is observed.</p>
<p>The second form of error is due to rounding. A small value of <span class="math notranslate nohighlight">\(h\)</span> leads to many terms being summed, and depending on the particular form of <span class="math notranslate nohighlight">\(f(y, t)\)</span> this may or may not be important; only a calculation will reveal this. However, it can mostly be prevented by increasing the precision of the calculation. Most programmes nowadays use double precision floating point arithmetic, but if problems persist this may need to be increased.  How this is done is clearly specific to the language used.</p>
</section>
<section id="using-euler-s-method">
<h2>4.3 Using Eulerâ€™ s method<a class="headerlink" href="#using-euler-s-method" title="Permalink to this headline">#</a></h2>
<p>To illustrate the method, the equation</p>
<div class="math notranslate nohighlight">
\[\displaystyle dy/dt = -2e^{3-t} - 3y\]</div>
<p>will be integrated from <span class="math notranslate nohighlight">\(t\)</span> = 2 to 7 with initial condition <span class="math notranslate nohighlight">\(y(t_0)\)</span> = 1, hence <span class="math notranslate nohighlight">\(t_0\)</span> = 2. This equation can be integrated analytically and this allows a check on the algorithm. The solution looks something like a Lennard - Jones  potential between two molecules or Morse potential between two atoms, with a single minimum and tending to infinity at <span class="math notranslate nohighlight">\(t\)</span> = 0 and to zero at large <span class="math notranslate nohighlight">\(t\)</span>.</p>
<p>The calculation starts by defining the initial values and other constants such as the number of points for the grid over which to do the calculation. Two arrays, Eulery and dtime, are used to store the results and the initial values are placed into the first element of each array. Notice that the values of <span class="math notranslate nohighlight">\(y\)</span> and <span class="math notranslate nohighlight">\(t\)</span> are both incremented in the for loop which changes <span class="math notranslate nohighlight">\(y\)</span> and <span class="math notranslate nohighlight">\(t\)</span> for each new step. The function to be integrated is always the right-hand side of the differential equation when written as <span class="math notranslate nohighlight">\(dy/dt = \cdots\)</span>. In the code the function, dydt, is passed into the subroutine Eulerf, which does the calculation, with the statement <span class="math notranslate nohighlight">\(\mathtt{soln0,time0 = Eulerf(dydt,t0,y0,maxt,N)}\)</span> which also returns the answers.</p>
<p>The outline algorithm 9 is</p>
<p><strong>(1)</strong><span class="math notranslate nohighlight">\(\quad\)</span> Define equation to integrate call this dydt .</p>
<p><strong>(2)</strong><span class="math notranslate nohighlight">\(\quad\)</span> Set initial parameters,<span class="math notranslate nohighlight">\(y_0,\,t_0\)</span>,number of integration points, <span class="math notranslate nohighlight">\(N\)</span></p>
<p><span class="math notranslate nohighlight">\(\quad\)</span> <strong>(i)</strong>  Calculate <span class="math notranslate nohighlight">\(h\)</span></p>
<p><span class="math notranslate nohighlight">\(\quad\)</span> <strong>(ii)</strong>  Save initial values</p>
<p><strong>(3)</strong><span class="math notranslate nohighlight">\(\quad\)</span> Start loop on <span class="math notranslate nohighlight">\(N\)</span></p>
<p><span class="math notranslate nohighlight">\(\quad\)</span> <strong>(i)</strong>  Increment <span class="math notranslate nohighlight">\(y\)</span> equation (11.19)</p>
<p><span class="math notranslate nohighlight">\(\quad\)</span> <strong>(ii)</strong> Increment <span class="math notranslate nohighlight">\(t\)</span></p>
<p><span class="math notranslate nohighlight">\(\quad\)</span> <strong>(iii)</strong> Save <span class="math notranslate nohighlight">\(y\)</span> and <span class="math notranslate nohighlight">\(t\)</span></p>
<p><span class="math notranslate nohighlight">\(\quad\)</span> <strong>(iv)</strong> end loop</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Algorithm 9: Euler&#39;s method</span>
<span class="c1">#--------------------------------</span>
<span class="k">def</span> <span class="nf">Eulerf</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">maxt</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>            <span class="c1"># Euler method, function f </span>
    
    <span class="n">Eulery</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>    <span class="c1"># define arrays to hold results</span>
    <span class="n">dtime</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="p">(</span><span class="n">maxt</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span><span class="o">/</span><span class="n">N</span>
    <span class="c1">#print(&#39;step size&#39;,h)</span>
    
    <span class="n">y</span> <span class="o">=</span> <span class="n">y0</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">t0</span>
    <span class="n">Eulery</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span> <span class="n">y0</span>
    <span class="n">dtime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">t0</span>
    <span class="k">for</span>  <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>              <span class="c1"># loop starts</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>               <span class="c1"># increment y</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="n">h</span>                      <span class="c1"># time </span>
        <span class="n">Eulery</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>                  <span class="c1"># save values</span>
        <span class="n">dtime</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="o">=</span> <span class="n">t</span>
        <span class="k">pass</span>                           <span class="c1"># end of loop</span>
    <span class="k">return</span> <span class="n">Eulery</span><span class="p">,</span><span class="n">dtime</span>
<span class="c1">#---------------------------------</span>

<span class="n">dydt</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">3</span><span class="o">-</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">y</span>   <span class="c1"># equation to integrate </span>

<span class="n">t0</span>  <span class="o">=</span> <span class="mf">2.0</span>    <span class="c1"># initial values</span>
<span class="n">y0</span>  <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">maxt</span><span class="o">=</span> <span class="mf">7.0</span>
<span class="n">N</span>   <span class="o">=</span> <span class="mi">50</span>     <span class="c1"># number of points</span>

<span class="n">soln0</span><span class="p">,</span><span class="n">time0</span> <span class="o">=</span> <span class="n">Eulerf</span><span class="p">(</span><span class="n">dydt</span><span class="p">,</span><span class="n">t0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="n">maxt</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>  <span class="c1"># return results as arrays</span>

<span class="c1">#plt.plot(time0,soln0) # add plotting here</span>
<span class="c1">#plt.show()</span>
</pre></div>
</div>
</div>
</div>
<p>The numerical data stored as Eulery and dtime. Two results with the number of iterations as <span class="math notranslate nohighlight">\(N\)</span> = 50 and 500, and the analytic solution is plotted as shown in fig 8. With <span class="math notranslate nohighlight">\(N\)</span> = 500, only a slight difference between the analytic solution and numerical is observed and this becomes better if more points are used. The improved (modified) Euler method and the Runge - Kutta methods, see Section 7, produce curves essentially identical to the algebraic solution.</p>
<p><img alt="Drawing" src="../_images/num-methods-fig8.png" /></p>
<p>Figure 8 The algebraic solution to <span class="math notranslate nohighlight">\(dy/dt = -2e^{3-t} - 3y\)</span> (dotted line) and two Euler method numerical solutions with <span class="math notranslate nohighlight">\(N = 50\)</span> and <span class="math notranslate nohighlight">\(500\)</span>. The initial condition is <span class="math notranslate nohighlight">\(y(t_0) = 1\)</span> and <span class="math notranslate nohighlight">\(t_0 = 2\)</span>. The improved (modified) Euler method and the Runge - Kutta methods, Section 7, produce curves essentially identical to the algebraic solution.</p>
</section>
<hr class="docutils" />
<section id="improving-on-the-euler-method">
<h2>Improving on the Euler method<a class="headerlink" href="#improving-on-the-euler-method" title="Permalink to this headline">#</a></h2>
<p>Many of the examples used are not particularly sensitive to the integration method; however, some equations are generally exquisitely sensitive, while others are only so for some sets of initial conditions and not for others. It is not obvious beforehand whether this is going to be the case or not and because of this more sophisticated integration schemes are necessary. The two described here are an improvement on the Euler algorithm and the Runge -Kutta method.</p>
</section>
<section id="modified-euler-or-heun-s-method">
<h2>4.4 Modified Euler or Heunâ€™s method<a class="headerlink" href="#modified-euler-or-heun-s-method" title="Permalink to this headline">#</a></h2>
<p>The Euler method is rather crude but is easy to implement and is easily improved. Consider again equation 19. The updated <span class="math notranslate nohighlight">\(y\)</span> value was calculated using</p>
<div class="math notranslate nohighlight">
\[\displaystyle y_{n+1} = y_n + hf(t_n,y_n)\]</div>
<p>but a better approximation to the area under the curve between <span class="math notranslate nohighlight">\(y_{n+1}\)</span> and <span class="math notranslate nohighlight">\(y_n\)</span> can be made than <span class="math notranslate nohighlight">\(hf(t_n, y_n)\)</span> which is a rectangle, Fig.7. This better approximation makes the area into a trapezoid and this is shown as shaded in the right-hand panel of Fig. 7. Its value is</p>
<div class="math notranslate nohighlight">
\[\displaystyle \frac{h}{2}\Big(f(t_n,y_n)+f(t_{n+1},y_{n+1})\Big)\]</div>
<p>The better method thus has an update term</p>
<div class="math notranslate nohighlight">
\[\displaystyle y_{n+1}=y_n+\frac{h}{2}\left[f(t_n,y_n)+f(t_{n+1},y_{n+1})\right]  \qquad\tag{21}\]</div>
<p>Some simplifications can now be made by replacing <span class="math notranslate nohighlight">\(t_{n+1} = t_n + h\)</span> and <span class="math notranslate nohighlight">\(y_{n+1} = y_n + hf(t_n, y_n)\)</span>, which is equation 19, into the second occurrence of the function to become the Modified Euler formula, which is sometimes also called Heunâ€™s method. The result is</p>
<div class="math notranslate nohighlight">
\[\displaystyle y_{n+1}=y_n+\frac{h}{2}\left[f(t_n,y_n)+f(t_n+h,y_n+hf(t_n,y_n))\right]  \qquad\tag{22}\]</div>
<p>which contains a function within a function. This is more clearly written in three steps by defining new terms <span class="math notranslate nohighlight">\(k_1,k_2\)</span>;</p>
<div class="math notranslate nohighlight">
\[\displaystyle k_1 =f(t_n,y_n), \quad k_2 =f(t_n +h,y_n +hk_1),\quad  y_{n+1} =y_n +h(k_1 +k_2)/2 \qquad\tag{23}\]</div>
<p>This modification replaces the simpler expression in the  loop of the basic Euler code (Algorithm 9).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Algorithm 10: Modified Euler or Heun&#39;s method</span>
<span class="c1">#--------------------------</span>
<span class="k">def</span> <span class="nf">Mod_Eulerf</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">maxt</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>            <span class="c1"># Euler method, function f </span>
    
    <span class="n">Eulery</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>    <span class="c1"># define arrays to hold results</span>
    <span class="n">dtime</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="p">(</span><span class="n">maxt</span><span class="o">-</span><span class="n">t0</span><span class="p">)</span><span class="o">/</span><span class="n">N</span>
    <span class="c1">#print(&#39;step size&#39;,h) </span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y0</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">t0</span>
    <span class="n">Eulery</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span> <span class="n">y0</span>
    <span class="n">dtime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">t0</span>
    <span class="k">for</span>  <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>              <span class="c1"># loop starts</span>
        <span class="n">k1</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>                    <span class="c1"># Changes start here</span>
        <span class="n">k2</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">h</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="o">*</span><span class="n">k1</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="o">*</span><span class="p">(</span><span class="n">k1</span> <span class="o">+</span> <span class="n">k2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>          <span class="c1"># increment y</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="n">h</span>
        <span class="n">Eulery</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
        <span class="n">dtime</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span>
        <span class="k">pass</span>                           <span class="c1"># end of loop</span>
    <span class="k">return</span> <span class="n">Eulery</span><span class="p">,</span><span class="n">dtime</span>
<span class="c1">#--------------------------    </span>

<span class="n">dydt</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">3</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">y</span>              <span class="c1"># equation to integrate </span>
<span class="n">t0</span>  <span class="o">=</span> <span class="mf">2.0</span>                              <span class="c1"># initial values</span>
<span class="n">y0</span>  <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">maxt</span><span class="o">=</span> <span class="mf">7.0</span>
<span class="n">N</span>   <span class="o">=</span> <span class="mi">50</span>                               <span class="c1"># number of points</span>
<span class="n">soln0</span><span class="p">,</span><span class="n">time0</span> <span class="o">=</span> <span class="n">Mod_Eulerf</span><span class="p">(</span><span class="n">dydt</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">maxt</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>         <span class="c1"># return results</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="runge-kutta-method">
<h2>4.5 Runge - Kutta method<a class="headerlink" href="#runge-kutta-method" title="Permalink to this headline">#</a></h2>
<p>There are other more sophisticated methods than the modified Euler of which the Runge-Kutta method is often the method of choice. The Runge-Kutta method uses the average of the gradient at the mid- and end-points of an interval to calculate the next <span class="math notranslate nohighlight">\(y\)</span> value. This is an example of a <em>predictor - corrector</em> method, which as the name suggests, predicts the next value then makes a weighted correction to this (Prest et al. 1986). In this method, <em>four</em> quantities are required for each equation being solved. The equation being solved is as before <span class="math notranslate nohighlight">\(dy/dt = f(t, y)\)</span> and <span class="math notranslate nohighlight">\(h\)</span> is the increment in <span class="math notranslate nohighlight">\(t\)</span>.</p>
<div class="math notranslate nohighlight">
\[\begin{split}\displaystyle \begin{align}
k_1 =&amp;\; f(t_n,\; y_n)\\[0.15cm]
k_2 = &amp;\;f(t_n + h/2,\; y_n + k_1/2) \\[0.15cm]
k_3 =&amp;\;f(t_n +h/2,\;y_n +k_2/2)\\[0.15cm]
k_4 =&amp;\;f(t_n +h,\;y_n +k_3)\\[0.15cm]
y_{n+1} =&amp;\;y_n +h(k_1 +2k_2 +2k_3 +k_4)/6\\[0.15cm]
\end{align}\end{split}\]</div>
<p>Note that this method would be Simpsonâ€™s rule if <span class="math notranslate nohighlight">\(f (t, y)\)</span> did not depend on <span class="math notranslate nohighlight">\(y\)</span>. The modification to the Euler method inside the subroutine is shown below,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Algorithm 11: Runge - Kutta </span>
<span class="c1">#---------------------------------</span>
<span class="k">def</span> <span class="nf">Runge_Kutta</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">maxt</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>            <span class="c1"># Euler method, function f </span>
    
    <span class="n">Eulery</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>    <span class="c1"># define arrays to hold results</span>
    <span class="n">dtime</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="p">(</span><span class="n">maxt</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span><span class="o">/</span><span class="n">N</span>
    <span class="c1">#print(&#39;step size&#39;,h)</span>
    
    <span class="n">y</span> <span class="o">=</span> <span class="n">y0</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">t0</span>
    <span class="n">Eulery</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span> <span class="n">y0</span>
    <span class="n">dtime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">t0</span>
    <span class="k">for</span>  <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>              <span class="c1"># loop starts</span>
        <span class="n">k1</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
        <span class="n">k2</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">h</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="o">*</span><span class="n">k1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">k3</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">h</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="o">*</span><span class="n">k2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">k4</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">h</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="o">*</span><span class="n">k3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="o">*</span><span class="p">(</span><span class="n">k1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k3</span> <span class="o">+</span> <span class="n">k4</span><span class="p">)</span><span class="o">/</span><span class="mi">6</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="n">h</span>
        <span class="n">Eulery</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
        <span class="n">dtime</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span>
        <span class="k">pass</span>                           <span class="c1"># end of loop</span>
    <span class="k">return</span> <span class="n">Eulery</span><span class="p">,</span><span class="n">dtime</span>
<span class="c1">#-----------------------------------    </span>

<span class="n">dydt</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">3</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">y</span>  <span class="c1"># equation to integrate </span>
<span class="n">t0</span>  <span class="o">=</span> <span class="mf">2.0</span>                               <span class="c1"># initial values</span>
<span class="n">y0</span>  <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">maxt</span><span class="o">=</span> <span class="mf">7.0</span>
<span class="n">N</span>   <span class="o">=</span> <span class="mi">50</span>                                <span class="c1"># number of points</span>
<span class="n">soln0</span><span class="p">,</span><span class="n">time0</span> <span class="o">=</span> <span class="n">Runge_Kutta</span><span class="p">(</span><span class="n">dydt</span><span class="p">,</span><span class="n">t0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="n">maxt</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>  <span class="c1"># return results</span>
</pre></div>
</div>
</div>
</div>
<p>You can use this method for any calculation for which the Euler or modified Euler method is appropriate; it will take slightly longer to calculate each step but should produce results that are more accurate with fewer data points. The method for coupled equations is described in Section 5. The relative errors in the Euler, modified Euler, and Runge - Kutta vary as <span class="math notranslate nohighlight">\(O(h^2),\; O(h^3)\)</span>  and <span class="math notranslate nohighlight">\( O(h^5)\)</span> respectively, where the local error is estimated as <span class="math notranslate nohighlight">\(| f(x) - f _{numeric}(x)|\)</span> with <span class="math notranslate nohighlight">\(f\)</span> as the true algebraic solution at some point <span class="math notranslate nohighlight">\(x\)</span>. Of course this error cannot generally be estimated.</p>
</section>
<section id="verlet-algorithm-calculating-dynamics-and-performing-md-simulations">
<h2>4.6 Verlet algorithm: calculating dynamics and performing MD simulations<a class="headerlink" href="#verlet-algorithm-calculating-dynamics-and-performing-md-simulations" title="Permalink to this headline">#</a></h2>
<p>An MD simulation is a technique to calculate equilibrium and transport properties of many body systems, such as proteins, DNAs, polymers, or simple liquids. The calculation is normally classical, and integrates Newtonâ€™s equation of motion. As classical mechanics is used, quantum effects such as tunnelling are ignored. The speed and capacity of modern computers make MD a common tool for the study of bio-molecules in particular, and a vast literature exists.
The MD simulation proceeds by calculating the forces between pairs of particles and integrating them at some time t; this time is now incremented by a small amount <span class="math notranslate nohighlight">\(\Delta t\)</span> and the process repeated. In a protein or DNA, the forces between the atoms will comprise those of individual chemical bonds, with their own particular force constants for bond stretching, bending, and rotating. Between non-bonded atoms, Lennard-Jones type potentials could be used and the Coulomb potential between charged groups. These interactions can be- come rather complicated and are usually parameterized and standard sets of values used.</p>
<p>In the Verlet algorithm, the equations of motion are not solved as such, which means that the starting point is not to simplify the differential equation and then approximate them as done in the Euler and Runge - Kutta methods. Instead, a Taylor expansion in time about the initial position is made. To use the Verlet algorithm, the force or acceleration of each particle must be known; this is always the case once the potential is known because force is the negative derivative of the potential with distance; <span class="math notranslate nohighlight">\(f_x = -dU(x)/dx\)</span>. As the equations of motion are second order, two initial conditions are necessary for each atom or molecule and these are the starting point and the initial velocity. From these, the next position, a very small distance away, is calculated, perhaps by using Newtonâ€™s laws, and from these two positions all the other positions, and the corresponding velocities, can be found from the algorithm.</p>
<p>The Verlet calculation starts by making a Taylor expansion (see Chapter 5) about the position at time <span class="math notranslate nohighlight">\(t + \Delta t\)</span> and <span class="math notranslate nohighlight">\(t - \Delta t\)</span> and the sum and difference between these two positions calculated. The formula for a Taylor series of any function <span class="math notranslate nohighlight">\(f(x)\)</span> expanded about a point <span class="math notranslate nohighlight">\(x_0\)</span>, is</p>
<div class="math notranslate nohighlight">
\[\displaystyle f(x)=f(x_0)+(x-x_0)\left( \frac{df}{dx} \right)_{x_0}+\frac{(x-x_0)^2}{2!}\left( \frac{d^2f}{dx^2} \right)_{x_0} +\cdots \]</div>
<p>Changing notation, from the general to the specific, the function <span class="math notranslate nohighlight">\(f\)</span> represents position <span class="math notranslate nohighlight">\(r\)</span> which is a function of time; the notational change is <span class="math notranslate nohighlight">\(f (x) \to r(t)\)</span>. Expanding <span class="math notranslate nohighlight">\(r\)</span> about time <span class="math notranslate nohighlight">\(t_0\)</span> to <span class="math notranslate nohighlight">\(t = t_0 + \Delta t\)</span>, where <span class="math notranslate nohighlight">\(\Delta t\)</span> is a small time step,  gives</p>
<div class="math notranslate nohighlight">
\[\displaystyle r(t_0+\Delta t)=r(t_0)+v(t_0)\Delta t+\frac{(\Delta t)^2}{2!}\left( \frac{d^2r}{dt^2} \right)_{t_0} +\frac{(\Delta t)^3}{3!}\left( \frac{d^3r}{dt^3} \right)_{t_0} +\cdots \]</div>
<p>Similarly for a small decrease in time</p>
<div class="math notranslate nohighlight">
\[\displaystyle r(t_0-\Delta t)=r(t_0)-v(t_0)\Delta t+\frac{(\Delta t)^2}{2!}\left( \frac{d^2r}{dt^2} \right)_{t_0} -\frac{(\Delta t)^3}{3!}\left( \frac{d^3r}{dt^3} \right)_{t_0} +\cdots \]</div>
<p>where the velocity <span class="math notranslate nohighlight">\(v(t_0)=(dx/dt)_{t_0}\)</span>. The acceleration is <span class="math notranslate nohighlight">\((d^2r/dt^2)_{t_0}=f(t_{t_0})/m\)</span> where <span class="math notranslate nohighlight">\(m\)</span> is the mass and <span class="math notranslate nohighlight">\(f\)</span> is the force, which is calculated from the potential at the position corresponding to time <span class="math notranslate nohighlight">\(t_0\)</span>. The sum and the difference of increments in <span class="math notranslate nohighlight">\(r\)</span> are</p>
<div class="math notranslate nohighlight">
\[\displaystyle  r(t_0+\Delta t)+r(t_0-\Delta t)=2r(t_0)+(\Delta t)^2\left( \frac{d^2r}{dt^2} \right)_{t_0}+\cdots \qquad\tag{24}\]</div>
<div class="math notranslate nohighlight">
\[\displaystyle  r(t_0+\Delta t)-r(t_0-\Delta t)=2\Delta t r(t_0)+2\frac{(\Delta t)^3}{3!}\left( \frac{d^3r}{dt^3} \right)_{t_0} +\cdots \qquad\tag{25}\]</div>
<p>If the time increment <span class="math notranslate nohighlight">\(\Delta t\)</span> is small, the third and higher derivatives can be ignored giving from equation 24</p>
<div class="math notranslate nohighlight">
\[\displaystyle  r(t_0+\Delta t)\approx 2r(t_0)-r(t_0-\Delta t)+\frac{f(t_0)}{m}(\Delta t)^2  \qquad\tag{26}\]</div>
<p>which will be the new position of the particle after time step <span class="math notranslate nohighlight">\(\Delta t\)</span>. The velocity is obtained from equation 25 as the difference</p>
<div class="math notranslate nohighlight">
\[\displaystyle v(t_0)\approx \frac{r(t_0+\Delta t)-r(t_0-\Delta t)}{2\Delta t}  \qquad\tag{27}\]</div>
<p>and not directly. These two equations give the new position and velocity and form the basis of the Verlet algorithm.</p>
<p>To begin the calculation, two positions have to be known; equation 26 indicates that <span class="math notranslate nohighlight">\(r\)</span> is needed at times <span class="math notranslate nohighlight">\(t_0\)</span> and <span class="math notranslate nohighlight">\(t_0 - \Delta t\)</span>. If <span class="math notranslate nohighlight">\(\Delta t\)</span> is small, the latter can be approximated as <span class="math notranslate nohighlight">\(r(t_0) - v_0\Delta t\)</span> with initial velocity <span class="math notranslate nohighlight">\(v_0\)</span>. It seems strange to have to calculate values before the initial time, which could be negative, but this is what is required.</p>
<p>The next step of the algorithm updates positions and forces and increments the time. The positions at the old time <span class="math notranslate nohighlight">\(t_0 - \Delta t\)</span> can be discarded; the current positions become the old ones and the new positions become the current ones. The force is also re-evaluated at the new position. This process is repeated in a loop with as many steps as are required. The forces are initially calculated outside the loop, and are calculated again at the end of the loop and are therefore ready to use when the loop restarts.</p>
<p>The elementary Verlet algorithm has the form:</p>
<p><strong>(1)</strong><span class="math notranslate nohighlight">\(\quad\)</span> Define potential energy or force &amp; number of time steps.</p>
<p><strong>(2)</strong><span class="math notranslate nohighlight">\(\quad\)</span> Define initial position <span class="math notranslate nohighlight">\(r(t_0)\)</span>, velocity <span class="math notranslate nohighlight">\(v\)</span>, and force.</p>
<p><span class="math notranslate nohighlight">\(\qquad\)</span> Calculate second position at <span class="math notranslate nohighlight">\(t_0 - \Delta t\)</span>.</p>
<p><strong>(3)</strong><span class="math notranslate nohighlight">\(\quad\)</span> Loop over time steps</p>
<p><span class="math notranslate nohighlight">\(\quad\)</span><strong>(i)</strong> Calculate new positions and velocities if needed.</p>
<p><span class="math notranslate nohighlight">\(\quad\)</span><strong>(ii)</strong>  Calculate and save quantities to be measured; energy, distance,etc.</p>
<p><span class="math notranslate nohighlight">\(\quad\)</span><strong>(ii)</strong>  Increment time.</p>
<p><span class="math notranslate nohighlight">\(\quad\)</span><strong>(iv)</strong>  Recalculate forces.</p>
<p><span class="math notranslate nohighlight">\(\quad\)</span><strong>(v)</strong> end loop.</p>
<p>Continue until total time is reached.</p>
<p>Before an example is worked through, a couple of topics need a brief mention.</p>
</section>
<section id="molecular-dynamics-simulations">
<h2>4.7 Molecular dynamics simulations<a class="headerlink" href="#molecular-dynamics-simulations" title="Permalink to this headline">#</a></h2>
<p>The Verlet is widely used in MD simulations because it is time symmetric and so conserves energy well. As it is less complicated, it works faster than other integration schemes. In an MD simulation, time steps are typically <span class="math notranslate nohighlight">\(10^{-15}\)</span> s, when put into real units, because chemical bond vibrational periods are <span class="math notranslate nohighlight">\(\approx 10^{-14}\)</span> s and several samples will be needed in each period. As with any numerical integration, the time step has to be short enough to allow an accurate calculation, but not so short that the calculation becomes unnecessarily long. The implementation of MD schemes is too long to discuss here; obviously many hundreds of atoms are present, the velocity and position of each has to be calculated in turn, subject to the interaction potential a molecules has with each of its neighbours. The way that coupled equations are dealt with is described in Section 5, the MD calculation takes this to extreme with thousands of equations but the basic idea is the same. Frenkel &amp; Smit (1996) give basic algorithms, and detailed ones can be found in Allen &amp; Tilldesley (1987).</p>
</section>
<section id="other-verlet-algorithms">
<h2>4.8 Other Verlet algorithms<a class="headerlink" href="#other-verlet-algorithms" title="Permalink to this headline">#</a></h2>
<p>There are other widely used versions of this algorithm, examples are the velocity Verlet and the Beeman algorithm, both of which give a better estimation of the velocities (see Frenkel &amp; Smit 1996). This is because there is no subtraction of two large numbers as in equation 27, which is the main disadvantage of the basic Verlet algorithm.</p>
<p>The equations for the velocity Verlet method can be shown to be the same as for the normal Verlet. The position and velocity equations are</p>
<div class="math notranslate nohighlight">
\[\displaystyle  r(t_0+\Delta t)= r(t_0)+v(t_0)\Delta t+\frac{f(t_0)}{m}(\Delta t)^2  \qquad\tag{28}\]</div>
<div class="math notranslate nohighlight">
\[\displaystyle v(t_0+\Delta t)= v(t_0)+\frac{f(t_0)+f(t_0+\Delta t)}{2m}  \]</div>
<p>and because the force is needed in the velocity equation at <span class="math notranslate nohighlight">\(t_0+\Delta t\)</span>, the calculation has to be done in two steps. The position is calculated using 28, then the velocity at half a step calculated using</p>
<div class="math notranslate nohighlight">
\[\displaystyle v(t_0 + \Delta t/2) = v(t_0) + f (t_0)/2m \qquad\tag{29}\]</div>
<p>and the force is calculated at <span class="math notranslate nohighlight">\(t_0 + \Delta t\)</span>, using the position <span class="math notranslate nohighlight">\(r(t_0 + \Delta t)\)</span>, and the velocity finally obtained is</p>
<div class="math notranslate nohighlight">
\[\displaystyle v(t_0 + \Delta t) = v(t_0 + \Delta t/2) + f (t_0 + \Delta t)/2m \qquad\tag{30}\]</div>
</section>
<section id="basic-verlet-algorithm">
<h2>4.9 Basic Verlet Algorithm<a class="headerlink" href="#basic-verlet-algorithm" title="Permalink to this headline">#</a></h2>
<p>Consider calculating the position and velocity of a ball dropped from a height of <span class="math notranslate nohighlight">\(h = 30\)</span> metres until it reaches the ground. The equation of motion is obtained by balancing forces and is <span class="math notranslate nohighlight">\(md^2y/dt^2 + mg = 0\)</span> where <span class="math notranslate nohighlight">\(m\)</span> is the mass of the ball, which cancels out, and <span class="math notranslate nohighlight">\(g\)</span> the acceleration due to gravity <span class="math notranslate nohighlight">\(9.81\,\mathrm{ ms^{-2}}\)</span>. The time steps have to be determined by trial and error but the calculation is quite accurate with time steps of <span class="math notranslate nohighlight">\(0.005\)</span> s.</p>
<p>To start the calculation, two positions are needed. If the initial position is <span class="math notranslate nohighlight">\(y_0\)</span> and velocity <span class="math notranslate nohighlight">\(v_0\)</span>, the other can be calculated from Newtonâ€™s laws using <span class="math notranslate nohighlight">\(v_{old} = v_0 + (-g)(-\Delta t)\)</span> and <span class="math notranslate nohighlight">\(y_{old} = y_0 - v_{old}\Delta t\)</span>. The acceleration is constant at all times and is <span class="math notranslate nohighlight">\(-g\)</span>. The Verlet algorithm is as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Algorithm 12; Verlet method. Falling under gravity</span>

<span class="n">y0</span> <span class="o">=</span> <span class="mf">30.0</span>     <span class="c1"># initial height  metres</span>
<span class="n">v0</span> <span class="o">=</span> <span class="mf">0.0</span>      <span class="c1"># initial velocity  m/s</span>
<span class="n">t</span>  <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.005</span>    <span class="c1"># timer increment  seconds</span>
<span class="n">g</span>  <span class="o">=</span> <span class="mf">9.8</span>      <span class="c1"># acceleration m/s/s</span>
<span class="n">n</span>  <span class="o">=</span> <span class="mi">2000</span>     <span class="c1"># number of data points</span>

<span class="n">height</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>     <span class="c1"># define arrays to hold data</span>
<span class="n">atime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">velo</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

<span class="n">height</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span> <span class="n">y0</span>    <span class="c1"># set initial point </span>
<span class="n">atime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span>
<span class="n">velo</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="o">=</span> <span class="n">v0</span>
<span class="n">accln</span>    <span class="o">=</span> <span class="o">-</span><span class="n">g</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">y0</span>
<span class="n">yold</span> <span class="o">=</span> <span class="n">y0</span> <span class="o">-</span> <span class="n">v0</span><span class="o">*</span><span class="n">dt</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>                 <span class="c1"># Verlet loop  </span>
    <span class="n">ynew</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">y</span> <span class="o">-</span> <span class="n">yold</span> <span class="o">+</span> <span class="n">accln</span><span class="o">*</span><span class="n">dt</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># eqn 26 with f(t0) included</span>
    <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">ynew</span> <span class="o">-</span> <span class="n">yold</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span>         <span class="c1"># eqn 27</span>
    <span class="n">yold</span> <span class="o">=</span> <span class="n">y</span>
    <span class="n">y</span>    <span class="o">=</span> <span class="n">ynew</span>
    <span class="k">if</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="mf">0.0</span> <span class="p">:</span>                    <span class="c1"># ball stots on ground</span>
        <span class="n">y</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">v</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">pass</span>
    <span class="n">height</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span> <span class="n">ynew</span>                  <span class="c1"># store new values</span>
    <span class="n">velo</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="o">=</span> <span class="n">v</span>
    <span class="n">atime</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="n">dt</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
<p>The calculation fixes the velocity and position (<span class="math notranslate nohighlight">\(y\)</span>) at zero when the ball hits the ground and for all the remaining time i.e. bouncing is not considered but is in question 11. The calculation is quite accurate with the small time step used, but more accurate if this is made smaller. Note that a check is made to prevent <span class="math notranslate nohighlight">\(y\)</span> becoming negative because the ball cannot go into the ground. The rate of change of velocity with time, the acceleration, is constant as expected, because the force of gravity is constant.</p>
<p><img alt="Drawing" src="../_images/num-methods-fig9.png" /></p>
<p>Fig. 9 Verlet calculation showing height and velocity vs time for a ball dropped under gravity. The velocity instantaneously becomes zero and remains so as the ball hits the ground.</p>
</section>
<hr class="docutils" />
<section id="the-verlet-algorithm-used-to-calculate-atom-scattering-trajectories">
<h2>4.10 The Verlet algorithm used to calculate atom scattering trajectories<a class="headerlink" href="#the-verlet-algorithm-used-to-calculate-atom-scattering-trajectories" title="Permalink to this headline">#</a></h2>
<p>The trajectory, followed by the scattering by one particle off another, described in Section 3.6, will be calculated with a Lennard-Jones 6-12 (LJ6-12) potential. Fig. 4 shows the geometry, and the accompanying text describes the background to this problem. The LJ potential has a wide but shallow attractive well and a narrow and very steep repulsive wall at short range; its equation is</p>
<div class="math notranslate nohighlight">
\[U(r) = 4\epsilon[(\sigma/r)^{12}- (\sigma/r)^6]\]</div>
<p>and for simplicity <span class="math notranslate nohighlight">\(\epsilon = \sigma = 1\)</span> is used. The initial energy of the incoming particle is <span class="math notranslate nohighlight">\(E = 1/5\)</span>. The reduced mass of the particles is assumed to be <span class="math notranslate nohighlight">\(1\)</span>. The impact parameter <span class="math notranslate nohighlight">\(b\)</span>, is in the y-direction; the starting <span class="math notranslate nohighlight">\(x\)</span> value is <span class="math notranslate nohighlight">\(x_0 = -10\)</span>, which is sufficiently far away to only weakly feel the potential. The particle initially approaches parallel to the x-axis; the initial velocity in the x-direction is <span class="math notranslate nohighlight">\(v_x\)</span> (see Algorithm 13) and the velocity in the y direction is zero. This initial distance <span class="math notranslate nohighlight">\(y_0\)</span>, is the impact parameter <span class="math notranslate nohighlight">\(b\)</span>. The potential <span class="math notranslate nohighlight">\(U\)</span> and force <span class="math notranslate nohighlight">\(-dU(r)/dr\)</span>, is calculated from the radial distance <span class="math notranslate nohighlight">\(r\)</span> between the two particles. However, our calculation uses <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> coordinates not <span class="math notranslate nohighlight">\(r\)</span>. The radial distance is related to x and y via <span class="math notranslate nohighlight">\(r = x^2 + y^2\)</span>. The algorithm also requires the forces along x and y and these components are calculated as</p>
<div class="math notranslate nohighlight">
\[\displaystyle -\frac{dU(r)}{dx} =-\left( \frac{dU(r)}{dr} \right)\left(\frac{dr}{dx} \right) \]</div>
<p>and similarly, for <span class="math notranslate nohighlight">\(y\)</span>. Unsurprisingly, these forces are called <span class="math notranslate nohighlight">\(fx\)</span> and <span class="math notranslate nohighlight">\(fy\)</span> in the calculation. The time step is <span class="math notranslate nohighlight">\(0.02\)</span> and <span class="math notranslate nohighlight">\(2000\)</span> steps are taken in total. The initial radial velocity is calculated from the energy as <span class="math notranslate nohighlight">\(v_r = \sqrt{2E_0}\)</span>, as we are assuming the reduced mass is unity.</p>
<p>To start the calculation, the position at two times <span class="math notranslate nohighlight">\(t_0\)</span> and <span class="math notranslate nohighlight">\(t_0 - \Delta t\)</span> has to be known, see (Equation 26). The coordinate at <span class="math notranslate nohighlight">\(t_0\)</span> is at <span class="math notranslate nohighlight">\((x_0, y_0)\)</span> and that at <span class="math notranslate nohighlight">\(t_0 - \Delta t\)</span> has to be found. This is crucial because the velocity of the particle is not used elsewhere in this calculation. If this is not approximated accurately, the consequence is that a different initial energy rather than <span class="math notranslate nohighlight">\(E_0\)</span> will have been used. The calculation is started at a large negative <span class="math notranslate nohighlight">\(x\)</span> value, where the particle is approaching almost parallel to the x-axis at a height <span class="math notranslate nohighlight">\(y_0\)</span>. The positions at <span class="math notranslate nohighlight">\(t_0 - \Delta t\)</span> can be approximated by taking fractions of the velocity in the <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> directions to give <span class="math notranslate nohighlight">\((x_0 + v_r\Delta tx_0/r, y_0 - v_r \Delta ty_0/r)\)</span>.</p>
<p>Although these work reasonably well, they are not quite accurate enough as they give the approaching particle too much energy. This can be observed by calculating the minimum approach distance <span class="math notranslate nohighlight">\(r_0\)</span> and comparing that with a trajectory. It is found that, given its initial energy, the particle passes closer to the target particle than it should; it crosses the boundary defined by a circle of radius <span class="math notranslate nohighlight">\(r_0\)</span>, which is given by equation 15. A better approximation is to use equation 7 to calculate <span class="math notranslate nohighlight">\(v\)</span>. This gives the particle at
<span class="math notranslate nohighlight">\(t_0 - \Delta t\)</span> the coordinates</p>
<div class="math notranslate nohighlight">
\[\displaystyle x_0-\frac{x_0\Delta t}{r}\sqrt{2}\sqrt{E_0-E_0\left(\frac{y_0}{2}\right)^2-U(r)},\quad  y_0  \qquad\tag{31}\]</div>
<p>where only the <span class="math notranslate nohighlight">\(x\)</span> value is changed because equation 7 assumes that the particle is parallel to the x-axis. This gives the trajectory a good approximation to <span class="math notranslate nohighlight">\(r_0\)</span>, the distance of closest approach.</p>
<p>The initial velocity only is used in the initial step; the velocity of the particle is not needed elsewhere in this particular calculation but if needed then equation 27 can be used to find <span class="math notranslate nohighlight">\(v_x\)</span> and <span class="math notranslate nohighlight">\(v_y\)</span>. The radial velocity <span class="math notranslate nohighlight">\(v_r\)</span> at any given time, at point <span class="math notranslate nohighlight">\((x, y)\)</span>, is the sum of the <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> components calculated as</p>
<div class="math notranslate nohighlight">
\[\displaystyle  v_r=\frac{dr}{dx}\frac{dx}{dt}+\frac{dr}{dy}\frac{dy}{dt}=\frac{x}{r}v_x+\frac{y}{r}v_y   \]</div>
<p>The radial velocity <span class="math notranslate nohighlight">\(v_r\)</span> is zero when the two particles are at their closest point although the individual components may not be zero.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Algorithm 13; Atom atom scattering using the Verlet method</span>
<span class="c1"># the plotting is commented out</span>
<span class="c1">#-------------------------------</span>
<span class="k">def</span> <span class="nf">scattering</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">ff</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>        <span class="c1"># uses Verlet  algorithm</span>

    <span class="n">atime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">posx</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">posy</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    
    <span class="n">posx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x0</span>
    <span class="n">posy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">y0</span>
    <span class="n">atime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span> <span class="mf">0.0</span>
    
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x0</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">y0</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x0</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y0</span>
    
    <span class="n">fx</span> <span class="o">=</span> <span class="n">ff</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="n">r</span>    <span class="c1"># components</span>
    <span class="n">fy</span> <span class="o">=</span> <span class="n">ff</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">*</span><span class="n">y</span><span class="o">/</span><span class="n">r</span>
    
    <span class="n">xold</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="mi">2</span><span class="o">*</span><span class="n">E0</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">E0</span><span class="o">*</span><span class="p">(</span><span class="n">y0</span><span class="o">/</span><span class="n">r</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">U</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="n">r</span>  <span class="c1"># eq 31 get starting coords</span>
    <span class="n">yold</span> <span class="o">=</span> <span class="n">y0</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>                <span class="c1"># Verlet </span>
        <span class="n">xnew</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span> <span class="o">-</span> <span class="n">xold</span> <span class="o">+</span> <span class="n">fx</span><span class="o">*</span><span class="n">dt</span><span class="o">**</span><span class="mi">2</span>    <span class="c1"># eqn 26 for x and y</span>
        <span class="n">ynew</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">y</span> <span class="o">-</span> <span class="n">yold</span> <span class="o">+</span> <span class="n">fy</span><span class="o">*</span><span class="n">dt</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">xold</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">yold</span> <span class="o">=</span> <span class="n">y</span>
        <span class="n">x</span>    <span class="o">=</span> <span class="n">xnew</span>
        <span class="n">y</span>    <span class="o">=</span> <span class="n">ynew</span>
        <span class="n">posx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span> <span class="n">x</span>                 <span class="c1"># save values</span>
        <span class="n">posy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span> <span class="n">y</span>
        <span class="n">atime</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">t</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="n">dt</span>                 <span class="c1"># increment time </span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">fx</span><span class="o">=</span> <span class="n">ff</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="n">r</span>
        <span class="n">fy</span><span class="o">=</span> <span class="n">ff</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">*</span><span class="n">y</span><span class="o">/</span><span class="n">r</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="n">posx</span><span class="p">,</span><span class="n">posy</span>
<span class="c1">#---------------------------------</span>

<span class="n">U</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">eps</span><span class="o">/</span><span class="mf">4.0</span><span class="o">*</span><span class="p">(</span> <span class="p">(</span><span class="n">sig</span><span class="o">/</span><span class="n">r</span><span class="p">)</span><span class="o">**</span><span class="mi">12</span> <span class="o">-</span> <span class="p">(</span><span class="n">sig</span><span class="o">/</span><span class="n">r</span><span class="p">)</span><span class="o">**</span><span class="mi">6</span> <span class="p">)</span>         <span class="c1"># define LJ potential</span>
<span class="n">ff</span><span class="o">=</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="mi">24</span><span class="o">*</span><span class="n">eps</span><span class="o">/</span><span class="n">sig</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">sig</span><span class="o">/</span><span class="n">r</span><span class="p">)</span><span class="o">**</span><span class="mi">13</span> <span class="o">-</span> <span class="p">(</span><span class="n">sig</span><span class="o">/</span><span class="n">r</span><span class="p">)</span><span class="o">**</span><span class="mi">7</span><span class="p">)</span>      <span class="c1"># LJ force</span>

<span class="n">eps</span> <span class="o">=</span> <span class="mf">1.0</span>      <span class="c1"># set initial values</span>
<span class="n">sig</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">E0</span>  <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">n</span>   <span class="o">=</span> <span class="mi">2000</span>
<span class="n">x0</span>  <span class="o">=</span> <span class="o">-</span><span class="mf">10.0</span>
<span class="n">y0</span>  <span class="o">=</span> <span class="mf">2.28</span>      <span class="c1"># impact parameter b</span>
<span class="n">t</span>   <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">dt</span>  <span class="o">=</span> <span class="mf">0.02</span>      <span class="c1"># time step</span>

<span class="c1">#fig1 = plt.figure(figsize=(9,8))</span>
<span class="c1">#plt.axes().set_aspect(1)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">y0</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">j</span><span class="o">*</span><span class="mf">0.15</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">21</span><span class="p">)]):</span>   <span class="c1"># calculate range of values</span>
    <span class="n">posx</span><span class="p">,</span> <span class="n">posy</span> <span class="o">=</span> <span class="n">scattering</span><span class="p">(</span><span class="n">U</span><span class="p">,</span><span class="n">ff</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">dt</span><span class="p">)</span>            <span class="c1"># pass potential, force and other params into calc.</span>
    
    <span class="c1">#plt.plot(posx,posy,linewidth=2,color = plt.cm.brg_r(15*i))</span>
</pre></div>
</div>
</div>
</div>
<p><img alt="Drawing" src="../_images/num-methods-fig10.png" /></p>
<p>Figure 10. Trajectories calculated with a Lennard-Jones potential (<span class="math notranslate nohighlight">\(\epsilon = \sigma = 1\)</span>) with an initial energy of <span class="math notranslate nohighlight">\(E = 1/5\)</span>. The impact parameter <span class="math notranslate nohighlight">\(b\)</span> starts at zero and is incremented by <span class="math notranslate nohighlight">\(0.15\)</span> in the y-direction. The inner grey circle is the potential at energy <span class="math notranslate nohighlight">\(E\)</span>, the outer and wide grey circle is the potential minimum and the middle circle has a radius <span class="math notranslate nohighlight">\(0.99\)</span>, which is a typical value for <span class="math notranslate nohighlight">\(r_0\)</span>. The centre of the circle is at coordinate (<span class="math notranslate nohighlight">\(0, 0\)</span>). The value at <span class="math notranslate nohighlight">\(b = 1.65\)</span> is a Glory scattering as the overall beam is undeflected.</p>
<hr class="docutils" />
<p>Several trajectories, <span class="math notranslate nohighlight">\(x\)</span> vs <span class="math notranslate nohighlight">\(y\)</span>, are plotted in Fig. 10 with increasing impact parameter <span class="math notranslate nohighlight">\(b\)</span> starting at zero. Plotting the final angles <span class="math notranslate nohighlight">\(\chi\)</span> relative to the horizontal, except that at <span class="math notranslate nohighlight">\(b \approx 2.29\)</span>, produces a curve similar to that shown in Fig. 6 for the same initial energy. The inner grey circle is the potential at <span class="math notranslate nohighlight">\(E = 1/5\)</span>, and the wide grey line follows the bottom of the potential well. The middle circle is the average value of <span class="math notranslate nohighlight">\(r_0\)</span>, which <span class="math notranslate nohighlight">\(\approx 0.99\)</span> because the repulsive potential is so steep.</p>
<p>The effect that the attractive and repulsive parts of the potential have is clear. At small impact parameter, the repulsive part of the potential acts not unlike a hard sphere and the approaching particle bounces almost straight off. As the impact parameter is increased, more of the attractive and less of the repulsive part of the potential is felt. Eventually the attractive potential only gradually draws the particle in only to force it to be violently repelled at a smaller separation. Then at an impact of about <span class="math notranslate nohighlight">\(2.27 \to 2.295\)</span> the attraction almost exactly balances the kinetic energy and the incoming particle is trapped for a short period and performs a complete orbit or two before leaving. At still greater impact para- meter, all that the potential can now do is to bend the incoming particle from its initial course. The trajectory at <span class="math notranslate nohighlight">\(b = 1.65\)</span> has almost zero displacement and is called a â€˜Gloryâ€™, see also Fig. 6 which shows the scattering angle <span class="math notranslate nohighlight">\(\chi\)</span> vs impact parameter.</p>
</section>
<section id="numerical-solution-of-the-diffusion-equation-illustrated-with-transient-grating-decay">
<h2>4.11  Numerical solution of the Diffusion equation illustrated with Transient Grating decay.<a class="headerlink" href="#numerical-solution-of-the-diffusion-equation-illustrated-with-transient-grating-decay" title="Permalink to this headline">#</a></h2>
<p>Although the diffusion equation can be solved in many simple cases, often the geometry needed for a particular experiment is not simple and then a numerical solution is the only course of action. This is particularly the case for two and three dimensional problems.</p>
<p>Often reaction and diffusion may be taking place and then the diffusion equation is extended with a rate expression and becomes</p>
<div class="math notranslate nohighlight">
\[\displaystyle \frac{dC}{dt}=D\frac{d^2C}{dx^2}+ \text{rate expression} \qquad\tag{31a}\]</div>
<p>where <span class="math notranslate nohighlight">\(C\)</span> is the concentration of some species and <span class="math notranslate nohighlight">\(D\)</span> the diffusion constant. The rate expression has the form <span class="math notranslate nohighlight">\(k[C][\cdots]\)</span> where <span class="math notranslate nohighlight">\(k\)</span> is a rate constant multiplied, as appropriate for the chemistry, by concentrations. In heat flow problems the concentration is replaced by temperature and the diffusion coefficient by thermal diffusivity, both have dimensions of length<span class="math notranslate nohighlight">\(^2\)</span>/time. Initially we shall ignore the rate expression term and deal with a single diffusing species in one dimension but suppose that the initial concentration has an interesting spatial profile.</p>
<p>To tackle the calculation suppose that there is a grid of points in <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(t\)</span> over which the calculation is being performed, see figure 10a. The derivatives are calculated as differences by assuming small increments in <span class="math notranslate nohighlight">\(t\)</span> and <span class="math notranslate nohighlight">\(x\)</span>. The values are <span class="math notranslate nohighlight">\(\Delta x = 1/(m-1)\)</span> for a grid of <span class="math notranslate nohighlight">\(k=0\cdots m \)</span> points and similarly for time <span class="math notranslate nohighlight">\(\Delta t = 1/(n-1)\)</span> with <span class="math notranslate nohighlight">\(j= 0\cdots  n\)</span> points. The total length is <span class="math notranslate nohighlight">\(L = m\Delta x\)</span>, and total time <span class="math notranslate nohighlight">\(T_{max} = n\Delta t\)</span>. The approximation to the first derivatives are simple differences which approximate the true derivative when these differences are exceedingly small</p>
<div class="math notranslate nohighlight">
\[\displaystyle \frac{dC}{dt}\approx \frac{C_k^{j+1}-C_k^j }{\Delta t} \]</div>
<div class="math notranslate nohighlight">
\[\displaystyle \frac{dC}{dx}\approx \frac{C_{k+1}^{j}-C_k^j}{\Delta x} \]</div>
<p>where subscript <span class="math notranslate nohighlight">\(i\)</span> is a spatial index with step <span class="math notranslate nohighlight">\(\Delta x\)</span> and superscript <span class="math notranslate nohighlight">\(j\)</span> a time position index with step <span class="math notranslate nohighlight">\(\Delta t\)</span>. This arrangement is equivalent to the Euler approximation which is the simplest of various such schemes. Other more sophisticated schemes are Heunâ€™s method (a modification of Euler) and  Runge-Kutta, see section 4.</p>
<p>The stencil below shows the points used in the calculation, fig 10a.</p>
<p><img alt="Drawing" src="../_images/num-methods-fig10a.png" /></p>
<p>Figure 10a. The Stencil used to calculate the updating points.</p>
<hr class="docutils" />
<p>The second derivative  is calculated as two further terms and the approximation to the diffusion equation becomes</p>
<div class="math notranslate nohighlight">
\[\displaystyle \frac{C_k^{j+1}-C_k^j}{\Delta t}=\frac{D}{\Delta x}\left(\frac{C_{k+1}^j-C_k^j}{\Delta x}-\frac{C_k^j-C_k^{j-1}}{\Delta x} \right)\]</div>
<p>This can be rearranged into a new form</p>
<div class="math notranslate nohighlight">
\[\displaystyle C_k^{new} = C_k^{old} + \frac{D\Delta t}{(\Delta x)^2}\left(  C_{k+1}^{old}-2C_k^{old} +C_{k-1}^{old}  \right) \qquad\tag{31b} \]</div>
<p>where <span class="math notranslate nohighlight">\(new=j+1\)</span> and <span class="math notranslate nohighlight">\(old=j\)</span> so that each new concentration term requires 3 older terms at different spatial positions. This type of approach is called a Fully Implicit Method.</p>
<p>The equation can also be put into  a matrix form as</p>
<div class="math notranslate nohighlight">
\[\begin{split} 
\begin{bmatrix}
C_0^{j+1}\\
C_1^{j+1}\\
\vdots\\
C_{m-1}^{j+1}
\end{bmatrix} = 
\begin{bmatrix}
1-2\sigma &amp; +\sigma &amp; 0 &amp; 0 &amp; \dots\\
+\sigma &amp; 1-2\sigma &amp; +\sigma &amp;0 &amp;   \\
&amp;  \vdots&amp; &amp; &amp;\\
 &amp; \cdots &amp;+\sigma &amp; 1-2\sigma &amp;+\sigma \\
&amp;  &amp;\cdots &amp;+\sigma &amp; 1-2\sigma 
\end{bmatrix} 
\begin{bmatrix}
C_0^{j}\\
C_1^{j}\\
\vdots\\
C_{m-1}^{}
\end{bmatrix}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\sigma =D\Delta t/\Delta x^2\)</span>. The tri-diagonal matrix contains the values at each old concentration at spatial position <span class="math notranslate nohighlight">\(k+1,k\)</span> and <span class="math notranslate nohighlight">\(k-1\)</span>. Computationally the matrix multiply may be slower than using the direct calculation particularly so if array slicing is used, i.e. <span class="math notranslate nohighlight">\(c[1:-1]\)</span> etc. as in algorithm 13a below.</p>
<section id="adding-a-reaction">
<h3><strong>Adding a reaction</strong><a class="headerlink" href="#adding-a-reaction" title="Permalink to this headline">#</a></h3>
<p>A reaction is added by including a term such as <span class="math notranslate nohighlight">\(kC^i_j\)</span> to the right hand side of the equation. In the calculation of a transient decay, illustrated below this could be the decay of the excited state produced thus <span class="math notranslate nohighlight">\(k\)</span> would be the excited state decay rate constant.</p>
<div class="math notranslate nohighlight">
\[\displaystyle C_k^{new} = C_k^{old} + \frac{D\Delta t}{(\Delta x)^2}\left(  C_{k+1}^{old}-2C_k^{old} +C_{k-1}^{old}  \right)  - k\Delta tC_k^{old}\]</div>
<p>and this could be added into the matrix form as an extra term but only in the diagonal as <span class="math notranslate nohighlight">\(k\Delta t/\sigma\)</span>.</p>
</section>
<section id="stability">
<h3><strong>Stability</strong><a class="headerlink" href="#stability" title="Permalink to this headline">#</a></h3>
<p>The condition for absolute stability depends on both the spatial and temporal steps and is <span class="math notranslate nohighlight">\(\displaystyle \frac{D\Delta t}{(\Delta x)^2} \le 1/2\)</span> and making more spatial grid points is the only way to ensure absolute stability since the spatial extent is defined in the initial conditions pertaining to the problem at hand.</p>
</section>
<section id="initial-conditions">
<h3><strong>Initial Conditions</strong><a class="headerlink" href="#initial-conditions" title="Permalink to this headline">#</a></h3>
<p>As with the solution of any differential equation  the calculation cannot be completed until the initial conditions have been specified. There are two types of these. The simplest to apply is to fix the value of <span class="math notranslate nohighlight">\(C\)</span> at the edge of the grid to a constant value, the Dirichlet condition, the other is to make the gradient at the edge a constant value, Neumann condition. The former is more suitable for thermal calculations where the edges can be kept at a constant temperature. It would be hard to make a membrane that held the same chemical species at a higher concentration on one side than the other.</p>
<p>The  Neumann initial condition is</p>
<div class="math notranslate nohighlight">
\[\displaystyle \frac{dC}{dx}=\alpha\quad \text{at}\quad x = 0\]</div>
<div class="math notranslate nohighlight">
\[\displaystyle \frac{dC}{dx}=\beta\quad\text{at}\quad x= L\]</div>
<p>where <span class="math notranslate nohighlight">\(\alpha,\;\beta\)</span> are constants. This condition ensures conservation of mass as no material can enter or leave and is enabled by making <span class="math notranslate nohighlight">\(C_0 = C_1, C_m = C_{m-1}\)</span> at each updating step.  The same condition when dealing with thermal diffusion corresponds to having an insulated block of material unable to exchange energy with its surroundings.</p>
</section>
<section id="example-calculation-decay-of-transient-grating-see-also-chapter-10-18-5">
<h3><strong>Example Calculation: Decay of Transient Grating. ( See also chapter 10-18.5 )</strong><a class="headerlink" href="#example-calculation-decay-of-transient-grating-see-also-chapter-10-18-5" title="Permalink to this headline">#</a></h3>
<p>In the transient grating experiment a laser pulse is split into two parts and recombined in a sample and so produces a grating from which a probe laser can be diffracted. The grating dies away depending on excited state lifetime and linear and rotational diffusion. In solution rotational diffusion of a dye molecule is on the same time scale as the excited state decay of the dye and can thus be measured. See Chapter 10.10 for a diagram and details and H. Eichler, P. Gunter &amp; D. Pohl, â€˜Laser induced Dynamic Gratingsâ€™, publ Springer-Verlag 1986.</p>
<p>an initial concentration of <span class="math notranslate nohighlight">\(C\)</span> has to be present at zero time which means defining <span class="math notranslate nohighlight">\(C \gt 0\)</span> and the form the concentration profile will take vs. position <span class="math notranslate nohighlight">\(x\)</span>.  For illustration we assume this profile is the function  <span class="math notranslate nohighlight">\(a+b\cos(kx)\)</span>. This has the form expected in a transient grating experiment, which can be used to measure the rotational diffusion coefficient of electronically excited states.  In these type of experiments a polarised laser pulse is split into two parts and recombined in a solution containing molecules that will absorb this light. As the beams are from the same source they are â€˜in phaseâ€™ and will interfere at the sample producing strips of excited molecules separated by strips of unexcited ones. This grating is â€˜transientâ€™ because molecules diffuse and also because the excited states decay away. A third probe laser is used to scatter light off the transient grating and measures how quickly this decays away. In fluid solution rotational diffusion of the molecules primarily washes out the grating, whereas if this is not possible linear diffusion will do this but on a much longer time scale. A thermal grating may also be present if absorption is into a solid substrate.  Figure 30f in chapter 10 ( differential equations section 10) shows a possible experimental set-up. In solution the diffracted beam decays due to the normal decay lifetime of the molecule and by rotational diffusion of a dye molecule washing out the grating. If the probe laser has its polarisation perpendicular to that forming the grating the decay has the form <span class="math notranslate nohighlight">\(\displaystyle \sim e^{-t/\tau}(1+4e^{-t/\tau_{r}}/5)\)</span> whee <span class="math notranslate nohighlight">\(\tau\)</span> is the excited state decay lifetime and <span class="math notranslate nohighlight">\(\tau_{r}\)</span> that due to rotational diffusion. If the probe is parallel to the polarisation of the laser forming the grating the decay is <span class="math notranslate nohighlight">\(\displaystyle \sim e^{-t/\tau}e^{-t/\tau_{r}}\)</span>.</p>
<p>Before the calculation can start the dimensions in space and time have to be worked out. As a laser wavelength is measure in nanometres it seems sensible to use this as a unit of distance. The grating wavelength formed by the intersection of the two laser beams has wavelength <span class="math notranslate nohighlight">\(\Lambda=\lambda/2\cos(\theta/2)\)</span>. Using a <span class="math notranslate nohighlight">\(532\)</span> nm laser and an angle of <span class="math notranslate nohighlight">\(20\)</span> degrees between beams produces a value of <span class="math notranslate nohighlight">\(\Lambda \approx 46\)</span> nm. The initial grating will have the form <span class="math notranslate nohighlight">\(c_{00}+\cos(2kx)\)</span> where <span class="math notranslate nohighlight">\(x\)</span> is in nm and <span class="math notranslate nohighlight">\(k=\pi/\Lambda\)</span>. The population <span class="math notranslate nohighlight">\(c_{00}\)</span> is that in the sample where no grating is present but molecules are excited and we chose this to be (<span class="math notranslate nohighlight">\(c_{00}=2\)</span>). Outside the region where the grating is formed the concentration of excited molecules zero and as a result an area larger than the grating is used in the calculation. The reason for doing this is that as time progresses the excited molecules can diffuse into this unexcited area.</p>
<p>The diffusion constant is normally quoted in units of <span class="math notranslate nohighlight">\(\mathrm{m^2\,s^{-1}}\)</span> which is changed into <span class="math notranslate nohighlight">\(\mathrm{nm^2\,ns^{-1}}\)</span> in the calculation meaning that the unit of time is nanoseconds. Because of the limit on the increments, which is that <span class="math notranslate nohighlight">\(\displaystyle \frac{D\Delta t}{(\Delta x)^2} \le 1/2\)</span>, the time step is calculated using this formula. A smaller value could be used if preferred. This means that only <span class="math notranslate nohighlight">\(\Delta x\)</span> need to be chosen and so the concentration plots below always have the same shape but correspond to different times if a different <span class="math notranslate nohighlight">\(\Delta x\)</span> is chosen. It is clear that if too large a value is chosen that the calculation fails, this is observed as oscillations and unrealistic behaviour in the concentration, and illustrates that great care has always to be exercised in choosing parameter values in numerical calculations.</p>
<p>As a thought experiment we imagine that as time progresses the grating should become washed out which is what the calculation shows. If the calculation continues for a very long time then a constant population across the whole region is produced, but only if the Neumann limiting condition is applied because this limiting condition ensures that the total concentration is held constant. Naturally, if we allow the excited state to decay the population will fall in this way independently of diffusion.</p>
<p>If a reaction such as <span class="math notranslate nohighlight">\(d[C]/dt =-k[C]\)</span> were to be included then the updating equation has the additional rate term,</p>
<div class="math notranslate nohighlight">
\[\displaystyle C_k^{new} = C_k^{old} + \frac{D\Delta t}{(\Delta x)^2}\left(  C_{k+1}^{old}-2C_k^{old} +C_{k-1}^{old}  \right) -kC_k^{old}\Delta t \]</div>
<p>where <span class="math notranslate nohighlight">\(k\)</span> is the rate constant and <span class="math notranslate nohighlight">\(\Delta t\)</span> the time increment.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Algorithm 13a.</span>
<span class="c1"># 1D diffusion of a sinusoidal population as in a transient grating experiment</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">})</span>        <span class="c1"># set font size for plots</span>

<span class="n">ax</span> <span class="o">=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">230</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">)]</span>  <span class="c1"># make axes to plot</span>

<span class="n">Lambda</span> <span class="o">=</span> <span class="p">(</span><span class="mf">530e-9</span> <span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">360</span><span class="p">)</span><span class="o">*</span><span class="mf">1e9</span> <span class="c1">#Â 530 nm light grating wavelength in nm</span>
<span class="n">w</span>  <span class="o">=</span>   <span class="mi">20</span><span class="o">*</span><span class="n">Lambda</span>                              <span class="c1"># total calculation width as multiple of grating wavelength</span>
<span class="n">nsteps</span> <span class="o">=</span> <span class="mi">5000</span>

<span class="n">D</span>  <span class="o">=</span> <span class="mf">1e-8</span><span class="o">*</span><span class="mf">1e18</span><span class="o">/</span><span class="mf">1e9</span>                            <span class="c1"># diffusion coeff   m^2/s-&gt;1e18/1e9 nm^2/ns </span>
<span class="n">dx</span> <span class="o">=</span> <span class="mf">0.7</span>                                      <span class="c1"># step length nm</span>
<span class="n">nx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="n">w</span><span class="o">/</span><span class="n">dx</span> <span class="p">)</span>                              <span class="c1"># total number of steps</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">D</span><span class="o">/</span><span class="mi">4</span>                                <span class="c1"># time step in nanosec </span>
<span class="n">sigma</span> <span class="o">=</span> <span class="n">D</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span>                            <span class="c1"># constants </span>

<span class="n">c0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">float</span><span class="p">)</span>              <span class="c1"># make arrays </span>
<span class="n">c</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">dtype</span> <span class="o">=</span> <span class="nb">float</span><span class="p">)</span>
<span class="n">x</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>

<span class="n">tau</span> <span class="o">=</span> <span class="mi">100</span>                                     <span class="c1"># excited state lifetime,  in update_step</span>
<span class="n">kk</span>  <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">tau</span>                                   <span class="c1"># used as - kk*dt*c0[1:-1] in update step</span>
<span class="n">q</span>   <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">Lambda</span><span class="o">/</span><span class="n">dx</span><span class="p">)</span>                        <span class="c1"># start grating q, and  nx-q stop grating</span>
<span class="n">c00</span> <span class="o">=</span> <span class="mi">2</span>                                       <span class="c1"># value when no grating just two lasers</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">nx</span><span class="o">-</span><span class="n">q</span><span class="p">):</span>
    <span class="n">c0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">c00</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">Lambda</span><span class="p">)</span>   <span class="c1"># initial sinusoidal profile  </span>

<span class="c1">#--------------------</span>
<span class="k">def</span> <span class="nf">update_step</span><span class="p">(</span><span class="n">c0</span><span class="p">,</span><span class="n">c</span><span class="p">):</span>     <span class="c1"># Propagate with forward-difference in time, central-difference in space</span>
    <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">c0</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">sigma</span><span class="o">*</span><span class="p">(</span><span class="n">c0</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">c0</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">c0</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>   <span class="o">-</span> <span class="n">kk</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">c0</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>    <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>                            <span class="c1"># Neumann condition   dc/dt=const</span>
    <span class="n">c</span><span class="p">[</span><span class="n">nx</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">nx</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">c</span>
<span class="c1">#-------------------</span>

<span class="n">tsteps</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">/</span><span class="mi">10</span><span class="o">*</span><span class="n">nsteps</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">2</span><span class="p">)]</span>    <span class="c1"># plot at these timesteps</span>

<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">c</span>  <span class="o">=</span> <span class="n">update_step</span><span class="p">(</span><span class="n">c0</span><span class="p">,</span><span class="n">c</span><span class="p">)</span>
    <span class="n">c0</span> <span class="o">=</span> <span class="n">c</span>                     <span class="c1"># make copy as starting data for next iteration</span>
    <span class="k">if</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">tsteps</span><span class="p">:</span>            <span class="c1"># plot only at these times</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="n">Lambda</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">3.15</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">w</span><span class="o">/</span><span class="n">Lambda</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">20</span><span class="o">/</span><span class="n">Lambda</span><span class="p">,</span><span class="mf">2.5</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:0.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">dt</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39; ns&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
        <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">c00</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">c00</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">m</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">tau</span><span class="p">),</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/num-methods-B_14_0.png" src="../_images/num-methods-B_14_0.png" />
</div>
</div>
<p>Figure 10 b. This plot shows the grating amplitude decreasing due to diffusion, the total amount of excited state present is also reduced by excited state decay. In the last frame the upper horizontal line shows the initial amount when all the grating has decayed assuming no excited state decay, and the lower line the amount left as a result of the excited state decay, in this example <span class="math notranslate nohighlight">\(\tau=100\)</span>. The signal that would be diffracted of this grating thus decays as diffusion occurs and as the excited state decays.</p>
</section>
</section>
<hr class="docutils" />
<section id="d-diffusion-in-a-plate">
<h2>4.12 2D diffusion in a plate.<a class="headerlink" href="#d-diffusion-in-a-plate" title="Permalink to this headline">#</a></h2>
<p>We now use the integration scheme described at the start of this section but in two dimensions. The reason for using the simpler scheme is because the Crank-Nicholson scheme, described below, produces equations that are hard to solve in 2D and alternative, and complicated,  methods as described by Prest et al. (Numerical Recipes) are then used.</p>
<p>The two-dimensional diffusion equation is</p>
<div class="math notranslate nohighlight">
\[\frac{\partial U}{\partial t}=D\left(  \frac{\partial^2 U }{\partial x^2 }+\frac{\partial ^2U }{\partial y^2}\right) \]</div>
<p>where <span class="math notranslate nohighlight">\(U\)</span> represents temperature or concentration as necessary. Since there no terms involving both <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> the two dimensions can be treated separately and this greatly simplifies the calculation. It is also assumed that the diffusion coefficient is the same in all directions and is constant as the temperature changes, which implies that any temperature change must be small.</p>
<p>A numerical solution on the domain of the unit square <span class="math notranslate nohighlight">\(0 \le x \lt 1,\;0\le y \lt 1\)</span> approximates <span class="math notranslate nohighlight">\(U(x,y;t)\)</span> by the discrete function <span class="math notranslate nohighlight">\(u^{j}_{i,k}\)</span> where <span class="math notranslate nohighlight">\(x=i\Delta x, y=k\Delta y , t = j\Delta t\)</span>. If a unit square is not what is required then we suppose that <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> are fractions of the true dimensions and adjust the graphs plotted at the end as appropriate.  Applying a finite difference approximations yields</p>
<div class="math notranslate nohighlight">
\[\frac{u^{(j+1)}_{i,k}- u^{j}_{i,k}}{Î”t} =D\left( \frac{u^{j}_{i+1,k}- 2u^{j}_{i,k} + u^{j}_{i-1,k}}{\Delta x^2} +\frac{u^{j}_{i,k+1}- 2u^{j}_{i,k} + u^{j}_{i,k-1}}{\Delta y^2}\right) \]</div>
<p>and hence time step <span class="math notranslate nohighlight">\(j+1, u^{(j+1)}_{i,k}\)</span> may be calculated from its state at time step <span class="math notranslate nohighlight">\(j, u^{j}_{i,k}\)</span> via this equation by factoring terms as was done in one dimension</p>
<div class="math notranslate nohighlight">
\[u^{(j+1)}_{i,k}= u^j_{i,k}+\frac{D\Delta t}{\Delta x^2} \left( \cdots \right)\]</div>
<p>Consider the diffusion equation applied to a plate initially at temperature <span class="math notranslate nohighlight">\(T_0\)</span> apart from a disc of a specified size which is at temperature <span class="math notranslate nohighlight">\(T_1\)</span>. We suppose that the edges of the plate are held fixed at <span class="math notranslate nohighlight">\(T_0\)</span>. Experimentally this might correspond to heating a spot in a thin sample with pulse from a laser and then observing the change in temperature. A related experiment is to ablate a region in a cell membrane into which a protein of other molecule is labelled with a fluorescent dye. The ablation is such that it bleaches the dye without appreciably heating the sample, and then the re-appearance of the fluorescence is monitored after the ablating laser pulse has ended. This measurement produces the diffusion coefficient of the labelled molecules and  is  what occurs in a FRAP (Fluorescence Recovery after Photo-bleaching) experiment.</p>
<p>The following code applies the above formula to follow the evolution of the temperature of a plate. The initial spot is heated with respect to the rest of the plate. The code used is similar to that given above in the subroutine â€˜update_stepâ€™.</p>
<p>It can be shown that the maximum time step, <span class="math notranslate nohighlight">\(\Delta t\)</span> that we can allow without the process becoming unstable is</p>
<div class="math notranslate nohighlight">
\[\displaystyle \Delta t=\frac{(\Delta x\Delta y)^2}{2D(\Delta x^2+\Delta y^2)}\]</div>
<p>The Neumann initial condition is used and ensures that no heat is lost, which can be checked by summing the total temperature of the plate at different times.  The images clearly show how the energy deposited into the central spot diffuses into the surroundings as time passes. Calculating the temperature  at the centre of the disc (or at any other position) indicates how the energy spreads with time.</p>
<p>The average distance heat or molecules diffuse in time <span class="math notranslate nohighlight">\(t\)</span> is given by</p>
<div class="math notranslate nohighlight">
\[\displaystyle \langle r\rangle =\sqrt{2nDt}\]</div>
<p>in dimension <span class="math notranslate nohighlight">\(n\)</span> thus <span class="math notranslate nohighlight">\(\langle r\rangle =\sqrt{4Dt}\)</span> in this example. The rate of increase in <span class="math notranslate nohighlight">\(\langle r\rangle\)</span> is</p>
<div class="math notranslate nohighlight">
\[\displaystyle \frac{d}{dt}\langle r\rangle =\sqrt{\frac{D}{t}}\]</div>
<p>These average distances are shown on the plots and show how the radial distance diffused slows down with increasing time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Algorithm 13b; 2D diffusion in a plate</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">})</span>  <span class="c1"># set font size for plots</span>

<span class="n">w</span><span class="p">,</span> <span class="n">h</span>  <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span>               <span class="c1">#  keep fixed plate size unity mm.</span>
<span class="n">dx</span><span class="p">,</span><span class="n">dy</span> <span class="o">=</span> <span class="mf">0.002</span><span class="p">,</span> <span class="mf">0.002</span>          <span class="c1"># intervals in x-, y- directions, mm</span>
<span class="n">D</span>     <span class="o">=</span> <span class="mf">0.08</span>                  <span class="c1"># 0.08 mm^2/s typical of organic liquid,  Thermal diffusivity</span>

<span class="n">Tcool</span><span class="p">,</span> <span class="n">Thot</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">310</span>        <span class="c1"># plate temperaqture and init temp in heated area</span>
<span class="n">nsteps</span> <span class="o">=</span> <span class="mi">2000</span>
<span class="n">nx</span><span class="p">,</span> <span class="n">ny</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">w</span><span class="o">/</span><span class="n">dx</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="o">/</span><span class="n">dy</span><span class="p">)</span>
<span class="n">dx2</span> <span class="o">=</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span>
<span class="n">dy2</span> <span class="o">=</span> <span class="n">dy</span><span class="o">**</span><span class="mi">2</span>
<span class="n">dt</span>  <span class="o">=</span> <span class="n">dx2</span> <span class="o">*</span> <span class="n">dy2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">D</span> <span class="o">*</span> <span class="p">(</span><span class="n">dx2</span> <span class="o">+</span> <span class="n">dy2</span><span class="p">))</span>  <span class="c1"># time in seconds </span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1"> </span><span class="si">{:g}</span><span class="s1"> </span><span class="si">{:s}</span><span class="s1"> </span><span class="si">{:g}</span><span class="s1"> </span><span class="si">{:s}</span><span class="s1"> </span><span class="si">{:g}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;dx &#39;</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span><span class="s1">&#39;dy &#39;</span><span class="p">,</span><span class="n">dy</span><span class="p">,</span><span class="s1">&#39;dt &#39;</span><span class="p">,</span><span class="n">dt</span><span class="p">)</span> <span class="p">)</span>
<span class="n">alphax</span> <span class="o">=</span> <span class="n">D</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx2</span>
<span class="n">alphay</span> <span class="o">=</span> <span class="n">D</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dy2</span>

<span class="n">u0</span> <span class="o">=</span> <span class="n">Tcool</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">),</span><span class="n">dtype</span> <span class="o">=</span> <span class="nb">float</span><span class="p">)</span>       <span class="c1"># initial values everywhere</span>
<span class="n">u</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">),</span><span class="n">dtype</span> <span class="o">=</span> <span class="nb">float</span><span class="p">)</span>
<span class="n">p</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

<span class="c1"># Initial conditions - ring of inner radius r (mm), width dr centred at (cx,cy) (mm), r &gt; dx</span>
<span class="n">r</span><span class="p">,</span> <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span> <span class="o">=</span> <span class="mf">0.05</span><span class="o">*</span><span class="n">w</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">w</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">h</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">r</span><span class="o">**</span><span class="mi">2</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;spot radius&#39;</span><span class="p">,</span><span class="n">r</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span><span class="s1">&#39; micron&#39;</span><span class="p">)</span>

<span class="c1">#--------------------</span>
<span class="k">def</span> <span class="nf">hot_spot</span><span class="p">(</span><span class="n">u0</span><span class="p">,</span><span class="n">Thot</span><span class="p">):</span>                     <span class="c1"># check where to put hot molecules</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nx</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ny</span><span class="p">):</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">dx</span><span class="o">-</span><span class="n">cx</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">j</span><span class="o">*</span><span class="n">dy</span><span class="o">-</span><span class="n">cy</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># in mm</span>
            <span class="k">if</span> <span class="n">p2</span> <span class="o">&lt;=</span> <span class="n">r2</span><span class="p">:</span>
                <span class="n">u0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">Thot</span>
    <span class="k">return</span> <span class="n">u0</span>        
<span class="c1">#-------------------</span>
<span class="k">def</span> <span class="nf">aring</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">cx</span><span class="p">,</span><span class="n">cy</span><span class="p">):</span>                        <span class="c1"># returns list of x and y coords of circle in mm</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="mi">360</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">cx</span> <span class="o">+</span> <span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">cy</span> <span class="o">+</span> <span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span>  <span class="c1"># in mm</span>
            
<span class="c1">#--------------------</span>
<span class="k">def</span> <span class="nf">update_step2D</span><span class="p">(</span><span class="n">u0</span><span class="p">):</span>                     <span class="c1"># Neumann conditions added at end</span>
    <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">u0</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">alphax</span><span class="o">*</span><span class="p">(</span><span class="n">u0</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">u0</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">u0</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> \
                                   <span class="o">+</span> <span class="n">alphay</span><span class="o">*</span><span class="p">(</span><span class="n">u0</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:]</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">u0</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">u0</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> 
    <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">ny</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>    <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">ny</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>           <span class="c1"># Neumann boundary condition</span>
    <span class="n">u</span><span class="p">[</span><span class="n">nx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">ny</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="n">nx</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">ny</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">nx</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>    <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">nx</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">nx</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">ny</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">nx</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">ny</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">u</span>
<span class="c1">#-------------------</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1"> </span><span class="si">{:g}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="s1">&#39;maxtime (ms)&#39;</span><span class="p">,</span> <span class="n">nsteps</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="mi">1000</span> <span class="p">)</span> <span class="p">)</span>
<span class="n">xring</span><span class="p">,</span> <span class="n">yring</span> <span class="o">=</span> <span class="n">aring</span><span class="p">(</span> <span class="n">r</span><span class="p">,</span> <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span> <span class="p">)</span>          <span class="c1"># coords of circle radius r </span>
<span class="n">u0</span> <span class="o">=</span> <span class="n">hot_spot</span><span class="p">(</span> <span class="n">u0</span><span class="p">,</span> <span class="n">Thot</span> <span class="p">)</span>                  <span class="c1"># make initial hot spot</span>
<span class="n">mfig</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">nsteps</span><span class="o">*</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">nsteps</span><span class="o">*</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">nsteps</span><span class="o">*</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">nsteps</span><span class="o">*</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">nsteps</span><span class="p">]</span> <span class="c1"># plot at these timesteps</span>
<span class="n">fignum</span> <span class="o">=</span> <span class="mi">0</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;start calculation&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>

    <span class="n">u</span>  <span class="o">=</span> <span class="n">update_step2D</span><span class="p">(</span><span class="n">u0</span><span class="p">)</span>
    <span class="n">u0</span> <span class="o">=</span> <span class="n">u</span>                                 <span class="c1">#  make copy as starting data for next iteration</span>
    <span class="n">p</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="n">nx</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span><span class="n">ny</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">mfig</span><span class="p">:</span>                          <span class="c1"># plot only at these times</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;time steps&#39;</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
        <span class="n">fignum</span> <span class="o">=</span> <span class="n">fignum</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">230</span> <span class="o">+</span> <span class="n">fignum</span><span class="p">)</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;viridis_r&#39;</span><span class="p">)</span> <span class="p">,</span> <span class="n">vmin</span> <span class="o">=</span> <span class="n">Tcool</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">Thot</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">nx</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span><span class="n">nx</span><span class="o">*</span><span class="mi">2</span><span class="o">//</span><span class="mi">3</span><span class="p">])</span>  <span class="c1"># only show part of plot 1/3 to 2/3 </span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">ny</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span><span class="n">ny</span><span class="o">*</span><span class="mi">2</span><span class="o">//</span><span class="mi">3</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">fignum</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:6.3g}</span><span class="s1"> </span><span class="si">{:s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span><span class="s1">&#39;ms, red ring initial spot&#39;</span><span class="p">)</span>  <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:6.3g}</span><span class="s1"> </span><span class="si">{:s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span><span class="s1">&#39;ms&#39;</span><span class="p">)</span>  <span class="p">)</span>
            
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mf">1.1</span><span class="o">*</span><span class="n">nx</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span> <span class="mf">1.1</span><span class="o">*</span><span class="n">nx</span><span class="o">//</span><span class="mi">3</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.05</span><span class="o">/</span><span class="n">w</span><span class="p">)</span><span class="o">*</span><span class="n">nx</span><span class="o">//</span><span class="mi">3</span><span class="p">],[</span><span class="mf">1.85</span><span class="o">*</span><span class="n">ny</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span> <span class="mf">1.85</span><span class="o">*</span><span class="n">ny</span><span class="o">//</span><span class="mi">3</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>   <span class="c1"># plot bar size 50 micron</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">nx</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span> <span class="n">ny</span><span class="o">*</span><span class="mf">1.9</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span> <span class="sa">r</span><span class="s1">&#39;$\;50\,\mu m$&#39;</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xring</span><span class="o">*</span><span class="n">nx</span><span class="p">,</span> <span class="n">yring</span><span class="o">*</span><span class="n">nx</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="n">av_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">D</span><span class="o">*</span><span class="mf">1e-6</span><span class="o">*</span><span class="n">m</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span>                <span class="c1"># average distance diffused at this time ( metres)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">nx</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span><span class="mf">1.1</span><span class="o">*</span><span class="n">ny</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$\;\langle r\rangle =$&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:6.3g}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">av_r</span><span class="o">*</span><span class="mf">1e6</span><span class="p">))</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39; $\mu m$&#39;</span><span class="p">)</span>
        <span class="k">pass</span>

<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">right</span> <span class="o">=</span> <span class="mf">0.85</span><span class="p">)</span>
<span class="n">cbar_ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.88</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">])</span>
<span class="n">cbar_ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$T$ / K&#39;</span><span class="p">,</span> <span class="n">labelpad</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cax</span> <span class="o">=</span> <span class="n">cbar_ax</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dx  0.002 dy  0.002 dt  1.25e-05
spot radius 50.0  micron
maxtime (ms) 25
start calculation
time steps 0
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time steps 400
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time steps 800
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time steps 1200
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time steps 1600
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time steps 2000
</pre></div>
</div>
<img alt="../_images/num-methods-B_17_6.png" src="../_images/num-methods-B_17_6.png" />
</div>
</div>
</section>
<section id="crank-nicholson-method-the-time-dependent-schroedinger-equation">
<h2>4.13 Crank-Nicholson Method. The time-dependent Schroedinger equation<a class="headerlink" href="#crank-nicholson-method-the-time-dependent-schroedinger-equation" title="Permalink to this headline">#</a></h2>
<p>The best method with which to perform 1D diffusion type calculations and the 1D time-dependent Schroedinger equation, is, according to Prest (Numerical Recipes), the Crank-Nicholson approach as it is second order in time and space. This method is still, however, subject to numerical instability as are all such methods. This method is computationally a little more complex than the approach in section 4.11. The method uses the stencil shown below and is based on using the trapezoidal rule to perform the integration.</p>
<p><img alt="Drawing" src="../_images/num-methods-fig10c.png" /></p>
<p>Figure 10c. Stencil for the Crank-Nicholson calculation. The top three values labelled with <span class="math notranslate nohighlight">\(j+1\)</span> are unknown.</p>
<hr class="docutils" />
<p>The method is explained  with the time-dependent Schroedinger equation.</p>
<div class="math notranslate nohighlight">
\[\displaystyle i\hbar \frac{\partial \psi}{\partial t}=-\frac{\hbar^2}{2m}\frac{\partial^2 \psi}{\partial x^2}+V(x)\psi\]</div>
<p>where <span class="math notranslate nohighlight">\(\psi\)</span> is a function of time and space, or <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(t\)</span>. Atomic units are used which means that <span class="math notranslate nohighlight">\(\hbar=m=1\)</span> where <span class="math notranslate nohighlight">\(m\)</span> is the mass of the electron.  The unit of distance is <span class="math notranslate nohighlight">\(a_0\)</span>, the Bohr atom radius, (<span class="math notranslate nohighlight">\(a_0=5.21\times 10^{-11}\)</span> m) and the unit of time is <span class="math notranslate nohighlight">\(\hbar/E_H=2.419\times 10^{-17}\)</span> s where <span class="math notranslate nohighlight">\(E_H\)</span> is the Hartree = <span class="math notranslate nohighlight">\(4.3597\times 10^{-18}\)</span> J which is twice the ionisation energy of an hydrogen atom. If we wish to do the calculation with a different mass all that has to happen is to change the time, energy etc. at the end of the calculation when changing back to SI units.</p>
<p>The atomic units simplify the Schroedinger equation to</p>
<div class="math notranslate nohighlight">
\[\displaystyle i \frac{\partial \psi}{\partial t}=-\frac{1}{2}\frac{\partial^2 \psi}{\partial x^2}+V\psi\]</div>
<p>The potential energy <span class="math notranslate nohighlight">\(V\)</span> depends only on a spatial coordinate. Expanding in a manner similar to that of eqn. 31b except that a better approximation is made to the second derivative, which is the average of the past and future time points. The spatial grid has index <span class="math notranslate nohighlight">\(k\)</span>, time time grid <span class="math notranslate nohighlight">\(j\)</span> and after dividing by <span class="math notranslate nohighlight">\(i=\sqrt{-1}\)</span>,</p>
<div class="math notranslate nohighlight">
\[\displaystyle \frac{\psi_k^{j+1}-\psi_k^j}{\Delta t}=i\frac{1}{2(\Delta x)^2}\bigg(\left(\psi_{k+1}^{j+1}-2\psi_k^{j+1}+\psi_{k-1}^{j+1}\right) + \left(\psi_{k+1}^j-2\psi_k^j+\psi_{k-1}^j  \right )\bigg)-i V_k(\psi_k^{j+1}+\psi_k^j)\]</div>
<p>Expanding on a grid means that the end points effectively form an infinitely high barrier, i.e the calculation takes place within a square well or â€˜particle in a boxâ€™ potential so normally the calculation is stopped before the ends are reached. If not you do this you should observe the wavepacket being reflected of the wall and then its continued motion.</p>
<p>To solve the equation it is far easier to convert it into matrix form. This means calculating all the spatial dimension terms before calculating in time. Its not so obvious, but it becomes clear later on, that it helps to rewrite the equations by collecting terms in <span class="math notranslate nohighlight">\(\psi^{j+1}\)</span> and in <span class="math notranslate nohighlight">\(\psi^j\)</span> as</p>
<div class="math notranslate nohighlight">
\[\displaystyle - \sigma\psi_{k-1}^{j+1}+(1+2\sigma)\psi_k^{j+1}- \sigma\psi_{k+1}^{j+1}+i V_k\psi_k^{j+1}\Delta t = \sigma \psi_{k-1}^{j}+(1-2\sigma)\psi_k^{j}+ \sigma\psi_{k+1}^{j} -i V_k\psi_k^j\Delta t  \qquad\tag{31c}\]</div>
<p>where <span class="math notranslate nohighlight">\(\sigma=i\Delta t/(2(\Delta x)^2)\)</span>. The tri-diagonal form the equations have can be seen in the <span class="math notranslate nohighlight">\(k-1,\, k,\,k+1\)</span> terms on either side of the equation. Thus, given the initial wavefunction/wavepacket and the boundary conditions that <span class="math notranslate nohighlight">\(\psi\to 0 \)</span> at <span class="math notranslate nohighlight">\(x\to \pm \infty\)</span>, <span class="math notranslate nohighlight">\(\psi\)</span> can be calculated at later times.</p>
<p>To solve the equations it is necessary to iterate in time and at each time solve the equations above in spatial coordinates. The best way to do this is to solve for all <span class="math notranslate nohighlight">\(x\)</span> at a given time then increment time and repeat. Although it looks very complex, the simplest approach is to transform the equations into matrix form. The <span class="math notranslate nohighlight">\(\psi\)</span> (eqn 31c) can be put into matrix form by defining a column vector,</p>
<div class="math notranslate nohighlight">
\[\displaystyle \mathbf{P}^J=\left[ \psi_0^j,\psi_1^j\cdots \psi_{m-1}^j \right]^T\]</div>
<p>and then the â€˜tri-diagonalâ€™ matrices for the coefficients in eqn. 31c are,</p>
<div class="math notranslate nohighlight">
\[\begin{split}\small\left(\begin{bmatrix}
1+2\sigma &amp; -\sigma &amp; 0 &amp; 0 &amp;\dots\\
-\sigma &amp; 1+2\sigma &amp; -\sigma &amp;0 &amp;\\
&amp; &amp; \vdots&amp; &amp; &amp;\\
 &amp; \cdots &amp;-\sigma &amp; 1+2\sigma &amp;-\sigma \\
&amp; &amp; \cdots &amp;-\sigma &amp; 1+2\sigma 
\end{bmatrix} +
\begin{bmatrix}
iV_0\Delta t&amp;0&amp;\cdots\\
0 &amp; V_1\Delta t &amp; 0 \\
&amp; \vdots\\
\dots &amp; 0 &amp; iV_{m-1}\Delta t
\end{bmatrix}\right)
\begin{bmatrix}
\psi_0^{j+1}\\
\psi_1^{j+1}\\
\vdots\\
\psi_{m-1}^{j+1}
\end{bmatrix} \\= 
\left(\begin{bmatrix}
1-2\sigma &amp; +\sigma &amp; 0 &amp; 0 &amp; \dots\\
+\sigma &amp; 1-2\sigma &amp; +\sigma &amp;0 &amp;   \\
&amp;  \vdots&amp; &amp; &amp;\\
 &amp; \cdots &amp;+\sigma &amp; 1-2\sigma &amp;+\sigma \\
&amp;  &amp;\cdots &amp;+\sigma &amp; 1-2\sigma 
\end{bmatrix} -
\begin{bmatrix}
iV_0\Delta t&amp;0&amp;\cdots\\
0 &amp; iV_1\Delta t &amp; 0 \\
&amp; \vdots\\
\dots &amp; 0 &amp; iV_{m-1}\Delta t
\end{bmatrix}\right)
\begin{bmatrix}
\psi_0^{j}\\
\psi_1^{j}\\
\vdots\\
\psi_{m-1}^{}
\end{bmatrix}
\end{split}\]</div>
<p>and in matrix notation this is</p>
<div class="math notranslate nohighlight">
\[\displaystyle  \mathbf{(A'+V) P}^{j+1} = \mathbf{(B'-V) P}^{j} \]</div>
<p>where the matrix of the potential is diagonal and can therefore be added to the diagonals of the tri-diagonal. Letting <span class="math notranslate nohighlight">\(\mathbf{A'+V\to A}\)</span> and similarly <span class="math notranslate nohighlight">\(\mathbf {B'-V\to B}\)</span>, multiplying both sides by <span class="math notranslate nohighlight">\(\mathbf{A^{-1}}\)</span> gives</p>
<div class="math notranslate nohighlight">
\[\displaystyle  \mathbf{P}^{j+1} = \mathbf{A^{-1}}\mathbf{B P}^{j}\]</div>
<p>thus in the iteration scheme the <span class="math notranslate nohighlight">\(\mathbf A\)</span> and <span class="math notranslate nohighlight">\(\mathbf{B}\)</span> matrices needs to be inverted once only, as they contain only constant terms. This saves considerable effort. Time in the numerical model has index <span class="math notranslate nohighlight">\(j\)</span> so once initial values are determined, a loop with the matrix equation can be performed. As <span class="math notranslate nohighlight">\(\mathbf{A}^{-1}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{B}\)</span> are constant in time they are only evaluated once and outside the time loop. Only <span class="math notranslate nohighlight">\(\mathbf{P}\)</span> vectors vary in time, we could write the last equation as</p>
<div class="math notranslate nohighlight">
\[\displaystyle  \mathbf{P}^{new} = \mathbf{A^{-1}}\mathbf{B P}^{old}   \qquad\tag{31d}\]</div>
<p>and this equation is iterated as</p>
<p><span class="math notranslate nohighlight">\(P^{old}=\text{initial wavepacket}\\
\text{loop over time}\\
\quad{P}^{new} = {A^{-1}}{B P}^{old}\\
\quad  P^{old} = {P^{new}}\\
\quad\text{save }P^{new}\\
\text{repeat}\)</span></p>
<section id="wavepacket-motion">
<h3><strong>Wavepacket motion</strong><a class="headerlink" href="#wavepacket-motion" title="Permalink to this headline">#</a></h3>
<p>The following calculation illustrates a particle moving inside an infinite square-well potential and encountering a barrier. Because we are dealing with an atomic sized particle this is represented as a wavepacket. Depending on the initial conditions, i.e., the height and thickness of the barrier and its momentum the wavepacket either may reflect from the barrier, pass completely through (quantum tunnelling) or be split into two parts, one part being reflected the other tunnelling through.  The calculationâ€™s parameters are set up the illustrate the latter process.</p>
<p>The wavepacket used has the form of a plane wave multiplied by a gaussian envelope and has the normalised form,</p>
<div class="math notranslate nohighlight">
\[\displaystyle W(x,t) = \frac{1}{(2\pi\sigma^2)^{1/4}}e^{-x^2/(4 \sigma^2) }e^{ip_0x}\]</div>
<p>where  <span class="math notranslate nohighlight">\(p_0\)</span> the initial momentum. Notice that <span class="math notranslate nohighlight">\(W(x,t)\)</span> is a complex quantity, we usually plot it as the probability distribution <span class="math notranslate nohighlight">\(W^*W\)</span> where * indicated the complex conjugate. Mathematically normalisation means that <span class="math notranslate nohighlight">\(\int_{-\infty}^\infty W^*Wdx=1\)</span> and physically is equivalent to conservation of mass since the particle always exists somewhere.</p>
<p>To form a wavepacket the particle must have a range of momenta, which also means a range of energies, so it cannot be in a single eigenstate and, because of the uncertainty principle, it must also occupy one of a range of positions. Experimentally, wavepackets of vibrational levels are made by exciting a molecule with a laser pulse of short (femtosecond) duration.</p>
<p>In our calculation the wavepacket <span class="math notranslate nohighlight">\(W(x,t)\)</span> is in its <em>minimum-uncertainty state</em> in which the product <span class="math notranslate nohighlight">\(\Delta p\Delta x =\hbar/2\)</span>, i.e. the Heisenberg uncertainty is obeyed. Thus the particle represented by this wavepacket is localised at time <span class="math notranslate nohighlight">\(t=0\)</span> within space <span class="math notranslate nohighlight">\(\Delta x\)</span> and momenta <span class="math notranslate nohighlight">\(\Delta p\)</span>. If this were a molecule, proton or electron the particle does not itself â€˜spread outâ€™ i.e. a particle always has a well defined size (and shape if a molecule), but to detect it the detector will have to be large enough to cover its whole distribution of positions.</p>
<p>The uncertainty in position is <span class="math notranslate nohighlight">\(\delta x=\sigma\)</span> and in momentum <span class="math notranslate nohighlight">\(\Delta p=\hbar/2\sigma\)</span>.  The momentum is also defined as <span class="math notranslate nohighlight">\(p=\hbar k_0\)</span> where <span class="math notranslate nohighlight">\(k_0\)</span> is the wavevector and the energy is given by <span class="math notranslate nohighlight">\(E=(\hbar k_0)^2/2m\)</span>. As time progresses the wavepacket moves and its width increases. Initially the fwhm. of the gaussian shape is <span class="math notranslate nohighlight">\(2\sqrt{2\ln(2)}\)</span>. Its group velocity is</p>
<div class="math notranslate nohighlight">
\[\displaystyle v_g=\frac{dE}{dp}=\frac{\hbar k}{m}\]</div>
<p>which is the speed at which the envelope moves and is the velocity of a classical particle. Its phase velocity is</p>
<div class="math notranslate nohighlight">
\[\displaystyle v_{ph}=\frac{E}{p}=\frac{\hbar k}{2m}\]</div>
<p>The phase velocity is the speed at which the peak of the wave inside the envelope moves. This can be viewed if the real or imaginary part of  <span class="math notranslate nohighlight">\(W\)</span> is plotted and has spatial frequency <span class="math notranslate nohighlight">\(p_0\)</span>. The energy of the particle is <span class="math notranslate nohighlight">\(E=\hbar\omega\)</span> where <span class="math notranslate nohighlight">\(\omega\)</span> is the wave frequency in radians/sec (<span class="math notranslate nohighlight">\(\omega=2\pi\nu\)</span> where <span class="math notranslate nohighlight">\(\nu\)</span> is the frequency in s<span class="math notranslate nohighlight">\(^{-1}\)</span>). The energy is also <span class="math notranslate nohighlight">\(p^2/2m\)</span> so that <span class="math notranslate nohighlight">\(k^2=2m\omega/\hbar\)</span>, so that <span class="math notranslate nohighlight">\(k\)</span> is proportional to frequency.</p>
<p>As the wavepacket moves, in the absence of a barrier, its overall shape remains the same but its width spreads and amplitude decreases, this is called dispersion.. It is simpler to look at the probability distribution <span class="math notranslate nohighlight">\(|W|^2\)</span> rather than the wavepacket itself. This is</p>
<div class="math notranslate nohighlight">
\[\displaystyle p(x,t)=|W(x,t)|^2 \sim \exp\left(-\frac{\left(x-\hbar k_0 t/m\right)^2}{2\sigma_t^2}\right),\qquad \sigma_t^2=\sigma^2+\frac{\hbar^2 t^2}{4m^2\sigma^2}\]</div>
<p>where <span class="math notranslate nohighlight">\(\sigma_t\)</span> shows how the wavepacket width spreads in time while moving with velocity <span class="math notranslate nohighlight">\(\hbar k_0/m\)</span>. Its amplitude must decreases because the total probability is unity at all times and over the whole range of positions.  (At negative times the wavepacket compresses to its minimum value at <span class="math notranslate nohighlight">\(t=0\)</span> and then expands as positive time).</p>
<p>In the following calculation we use atomic units, <span class="math notranslate nohighlight">\(\hbar=m=1\)</span> and allow the wavepacket to collide with a thin barrier, a very hard calculation if not done numerically. You can see that as the wavepacket moves its amplitude becomes smaller and its width increases just as described above. When the barrier is reached, some tunnelling and some reflection occurs. The reflected part shows rapid oscillations due to interference of the incoming and out going  waves. Recall that the wavepacket we show is only the envelope <span class="math notranslate nohighlight">\(W^*W\)</span>, <span class="math notranslate nohighlight">\(W\)</span> itself contains <span class="math notranslate nohighlight">\(e^{ik_0x}\)</span> which is also <span class="math notranslate nohighlight">\(\cos(k_0x)+i\sin(k_0x)\)</span> so clearly has wavelike nature. It is this that interferes and caused huge oscillations in <span class="math notranslate nohighlight">\(W^*W\)</span> as shown in the calculation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Algorithm 13c Crank-Nicholson method.</span>
<span class="c1"># 1D time dependent Schroedinger eqn with potential V. </span>
<span class="c1"># Calculation using Atomic Units. hbar  = m = 1, m is the mass of electron</span>

<span class="c1">#-------------------------</span>
<span class="k">def</span> <span class="nf">barrier</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">V0</span><span class="p">,</span><span class="n">w</span><span class="p">):</span>                         <span class="c1"># barrier is a rectangle -w to w</span>
    <span class="n">V</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nx</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nx</span><span class="p">,</span><span class="n">nx</span><span class="p">)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">nx</span><span class="o">//</span><span class="mi">2</span><span class="o">-</span><span class="n">w</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">nx</span><span class="o">//</span><span class="mi">2</span><span class="o">+</span><span class="n">w</span><span class="p">)</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">V0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">V</span>
<span class="c1">#-------------------------</span>

<span class="k">def</span> <span class="nf">wavepacket</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">x0</span><span class="p">,</span><span class="n">sig</span><span class="p">,</span><span class="n">k0</span><span class="p">):</span>                 <span class="c1"># Gaussian wavepacket</span>
    <span class="n">wp</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">dtype</span> <span class="o">=</span> <span class="nb">complex</span><span class="p">)</span> 
    <span class="n">wp</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="p">[:]</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">sig</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">k0</span><span class="o">*</span><span class="n">x</span><span class="p">[:])</span>  
    <span class="k">return</span> <span class="n">wp</span>
<span class="c1">#--------------------------------------</span>

<span class="k">def</span> <span class="nf">make_tri_matrix</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">sig</span><span class="p">):</span>                   <span class="c1"># tri-diagonal matrix</span>
    <span class="n">ss</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">M</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">J</span><span class="p">,</span><span class="n">J</span><span class="p">],</span><span class="n">dtype</span> <span class="o">=</span> <span class="nb">complex</span><span class="p">)</span>
    <span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">sig</span><span class="o">*</span><span class="n">ss</span>
    <span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">sig</span><span class="o">*</span><span class="n">ss</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">sig</span>
        <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]</span>   <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">sig</span>
        <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">sig</span>
        <span class="k">pass</span>
    <span class="n">M</span><span class="p">[</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">J</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span>  <span class="o">-</span><span class="n">sig</span><span class="o">*</span><span class="n">ss</span>
    <span class="n">M</span><span class="p">[</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">sig</span><span class="o">*</span><span class="n">ss</span>
        
    <span class="k">return</span> <span class="n">M</span>

<span class="c1">#-------------------------</span>
<span class="k">def</span> <span class="nf">V_diag_matrix</span><span class="p">(</span><span class="n">J</span><span class="p">):</span>                          <span class="c1"># poetntial energy    </span>
    
    <span class="n">M</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">J</span><span class="p">,</span><span class="n">J</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">complex</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">J</span><span class="p">):</span>
        <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span>
    <span class="k">return</span> <span class="n">M</span>      
<span class="c1">#-------------------------</span>

<span class="k">def</span> <span class="nf">updatePsi</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span><span class="n">pnew</span><span class="p">):</span>                             <span class="c1"># update all x at new time t+1</span>
    
    <span class="n">pnew</span> <span class="o">=</span>  <span class="n">invAmat</span> <span class="o">@</span> <span class="p">(</span><span class="n">Bmat</span> <span class="o">@</span> <span class="n">p0</span> <span class="p">)</span>                  <span class="c1"># Crank-Nicholson  </span>
    <span class="n">pnew</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">pnew</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>                               <span class="c1"># boundary</span>
    <span class="n">pnew</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span> <span class="n">pnew</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">nn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dx</span><span class="o">*</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">pnew</span><span class="p">[:])</span><span class="o">*</span><span class="n">pnew</span><span class="p">[:]))</span>  <span class="c1"># normalise</span>
    <span class="n">pnew</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">pnew</span><span class="p">[:]</span><span class="o">/</span><span class="n">nn</span>
    <span class="k">return</span> <span class="n">pnew</span>
<span class="c1">#--------------------------</span>

<span class="k">def</span> <span class="nf">inits</span><span class="p">():</span>                                         <span class="c1"># initial values</span>
    <span class="n">nt</span> <span class="o">=</span> <span class="mi">1500</span>        <span class="c1"># number time points (integer)</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.125</span>       <span class="c1"># can be tricky to get this right.</span>
    <span class="n">nx</span> <span class="o">=</span> <span class="mi">600</span>         <span class="c1"># num grid x points</span>
    <span class="n">Lb</span> <span class="o">=</span> <span class="mi">200</span>         <span class="c1"># grid end  (integer)</span>
    <span class="n">La</span> <span class="o">=</span> <span class="o">-</span><span class="mi">200</span>        <span class="c1"># grid start (integer)</span>
    <span class="n">V0</span> <span class="o">=</span> <span class="mf">0.25</span>         <span class="c1"># barrier height</span>
    <span class="n">w</span>  <span class="o">=</span> <span class="mi">3</span>           <span class="c1"># half barrier width (integer)</span>
    <span class="n">k0</span> <span class="o">=</span> <span class="mi">1</span>           <span class="c1"># wavepacket momentum</span>
    <span class="n">sig</span><span class="o">=</span> <span class="mi">5</span>           <span class="c1"># wavepacket width sigma</span>
    <span class="n">x0</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span>         <span class="c1"># wave packet centre</span>
    
    <span class="k">return</span> <span class="n">nx</span><span class="p">,</span><span class="n">nt</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">k0</span><span class="p">,</span><span class="n">La</span><span class="p">,</span><span class="n">Lb</span><span class="p">,</span><span class="n">V0</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">sig</span><span class="p">,</span><span class="n">x0</span>
<span class="c1">#--------------------------</span>

<span class="n">nx</span><span class="p">,</span><span class="n">nt</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">k0</span><span class="p">,</span><span class="n">La</span><span class="p">,</span><span class="n">Lb</span><span class="p">,</span><span class="n">V0</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">sig</span><span class="p">,</span><span class="n">x0</span> <span class="o">=</span> <span class="n">inits</span><span class="p">()</span>

<span class="n">x</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">La</span><span class="p">,</span><span class="n">Lb</span><span class="p">,</span><span class="n">nx</span><span class="p">)</span>                <span class="c1"># x range </span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">psi0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">dtype</span> <span class="o">=</span> <span class="nb">complex</span><span class="p">)</span>       <span class="c1"># initial wavefunction/wavepacket</span>
<span class="n">psi</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">nt</span><span class="p">,</span><span class="n">nx</span><span class="p">],</span><span class="n">dtype</span> <span class="o">=</span> <span class="nb">complex</span> <span class="p">)</span> <span class="c1"># final results</span>
<span class="n">p</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">dtype</span> <span class="o">=</span> <span class="nb">complex</span><span class="p">)</span>       <span class="c1"># array to hold intermediate values</span>

<span class="n">psi0</span> <span class="o">=</span> <span class="n">wavepacket</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">x0</span><span class="p">,</span><span class="n">sig</span><span class="p">,</span><span class="n">k0</span><span class="p">)</span>           <span class="c1"># make wavepacket</span>
<span class="n">psi0</span> <span class="o">=</span> <span class="n">psi0</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">dx</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">psi0</span><span class="p">[:]))</span>       <span class="c1"># normalise wavepacket</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}{:g}</span><span class="s1"> </span><span class="si">{:s}</span><span class="s1"> </span><span class="si">{:g}</span><span class="s1"> </span><span class="si">{:s}</span><span class="s1"> </span><span class="si">{:g}</span><span class="s1">&#39;</span>\
      <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;dx = &#39;</span><span class="p">,</span><span class="n">dx</span><span class="p">,</span><span class="s1">&#39;dt = &#39;</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="s1">&#39;dt/dx^2 = &#39;</span><span class="p">,</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>

<span class="n">sig</span> <span class="o">=</span> <span class="mf">0.25</span><span class="o">*</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span>                    <span class="c1"># i hbar/(2m)dt/dx^2   constants</span>
<span class="n">V</span> <span class="o">=</span> <span class="n">barrier</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">V0</span><span class="p">,</span><span class="n">w</span><span class="p">)</span>                      <span class="c1"># make barrier</span>

<span class="n">Amat</span>    <span class="o">=</span> <span class="n">make_tri_matrix</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">sig</span><span class="p">)</span>  <span class="o">+</span> <span class="n">V_diag_matrix</span><span class="p">(</span><span class="n">nx</span><span class="p">)</span>  <span class="c1"># start Crank-Nicholson</span>
<span class="n">Bmat</span>    <span class="o">=</span> <span class="n">make_tri_matrix</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="o">-</span><span class="n">sig</span><span class="p">)</span>  <span class="o">-</span> <span class="n">V_diag_matrix</span><span class="p">(</span><span class="n">nx</span><span class="p">)</span>
<span class="n">invAmat</span> <span class="o">=</span> <span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Amat</span><span class="p">)</span>
    
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nt</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>                   <span class="c1"># main calculation here, time loop. </span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">updatePsi</span><span class="p">(</span><span class="n">psi0</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
    <span class="n">psi0</span> <span class="o">=</span> <span class="n">p</span>
    <span class="n">psi</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">psi0</span><span class="p">[:]</span>
    <span class="k">pass</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;finished calculation&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dx = 0.66778 dt =  0.125 dt/dx^2 =  0.280313
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>finished calculation
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">})</span>        <span class="c1"># set font size for plots</span>

<span class="n">f0</span> <span class="o">=</span> <span class="n">dt</span><span class="o">*</span><span class="mf">2.41888e-17</span><span class="o">*</span><span class="mf">1e15</span>                      <span class="c1"># atomic units to femtoseconds</span>
<span class="n">mx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span><span class="o">*</span><span class="n">psi</span> <span class="p">)</span> <span class="p">)</span>      <span class="c1"># global maximum</span>

<span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">7</span><span class="o">-</span><span class="n">j</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">psi</span><span class="p">[</span><span class="mi">100</span><span class="p">,:]),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span><span class="mi">400</span><span class="p">,</span><span class="mi">800</span><span class="p">,</span><span class="mi">900</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">1200</span><span class="p">,</span><span class="mi">1400</span><span class="p">]</span> <span class="p">:</span>   <span class="c1"># I choose to plot at these time points</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">6</span><span class="o">-</span><span class="n">j</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">psi</span><span class="p">[</span><span class="n">i</span><span class="p">,:])</span><span class="o">*</span><span class="n">psi</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span><span class="o">/</span><span class="n">mx</span><span class="p">)</span> <span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">6</span><span class="o">-</span><span class="n">j</span><span class="o">+</span><span class="mf">0.95</span><span class="o">*</span><span class="n">V</span><span class="o">/</span><span class="n">V0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{:d}{:6.2f}{:s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="o">*</span><span class="n">f0</span><span class="p">,</span><span class="s1">&#39; fs&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.35</span><span class="o">*</span><span class="n">Lb</span><span class="p">,</span><span class="mi">6</span><span class="o">-</span><span class="n">j</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span><span class="n">fmt</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">j</span><span class="o">=</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">pass</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$x/a_0$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\psi^*\psi\; (a.u.)$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">150</span><span class="p">,</span><span class="mi">150</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/num-methods-B_20_0.png" src="../_images/num-methods-B_20_0.png" />
</div>
</div>
<p>Figure 10 d. The figure above shows the probability <span class="math notranslate nohighlight">\(\psi^*\psi\)</span> vs <span class="math notranslate nohighlight">\(x\)</span> at different times. The scattering of the wavepacket and its subsequent re-phasing is clear. The <span class="math notranslate nohighlight">\(\displaystyle e^{ik_0x}\)</span> term of the wavepacket generates high spatial frequencies which are observed when the wavepacket is dephased at the barrier. Subsequently these reform and a smooth wavepacket is reproduced.  The probability is scaled to the maximum value at any time, the area is the same in each plot as the wavepacket is normalised.  The real part of the wavepacket is show above its envelope. This shows oscillatory behaviour due to the  <span class="math notranslate nohighlight">\(e^{ik_0x}\)</span> term.</p>
</section>
<section id="wavepacket-animation">
<h3><strong>Wavepacket Animation</strong><a class="headerlink" href="#wavepacket-animation" title="Permalink to this headline">#</a></h3>
<p>The following script produces an animation of the wavepacket motion. The axes and calculation are the same as the figure above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ipywidgets.widgets</span>  <span class="k">as</span> <span class="nn">wgt</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact</span><span class="p">,</span> <span class="n">interactive</span><span class="p">,</span> <span class="n">fixed</span><span class="p">,</span> <span class="n">interact_manual</span><span class="p">,</span><span class="n">VBox</span><span class="p">,</span><span class="n">HBox</span><span class="p">,</span><span class="n">Layout</span><span class="p">,</span><span class="n">HTML</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>

<span class="n">fig22</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">})</span>                 <span class="c1"># set font size for plots</span>
 
<span class="n">mx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span><span class="o">*</span><span class="n">psi</span> <span class="p">)</span> <span class="p">)</span>  <span class="p">)</span>   <span class="c1"># global max</span>

<span class="k">def</span> <span class="nf">wpacket</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
    <span class="n">fmtt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1"> </span><span class="si">{:4.2f}</span><span class="s1"> </span><span class="si">{:s}</span><span class="s1"> </span><span class="si">{:d}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;t = &#39;</span><span class="p">,</span> <span class="p">((</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">f0</span><span class="p">),</span><span class="s1">&#39;fs # &#39;</span><span class="p">,(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> 
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">fmtt</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">V</span><span class="o">/</span><span class="n">V0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$x/ a_0$&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\psi^*\psi$&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.1</span><span class="p">])</span>
    <span class="n">temp</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">psi</span><span class="p">[</span><span class="n">k</span><span class="p">,:])</span><span class="o">*</span><span class="n">psi</span><span class="p">[</span><span class="n">k</span><span class="p">,:]</span> <span class="p">)</span><span class="o">/</span><span class="n">mx</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">temp</span><span class="p">[:],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">pass</span>

<span class="n">f02</span> <span class="o">=</span> <span class="n">wgt</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;push triangle to start, must push (square) stop before restart &quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">f02</span><span class="p">)</span>

<span class="n">f01</span> <span class="o">=</span> <span class="n">wgt</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">wpacket</span><span class="p">,</span><span class="n">k</span> <span class="o">=</span> <span class="n">wgt</span><span class="o">.</span><span class="n">Play</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nb">max</span><span class="o">=</span><span class="n">nt</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">step</span><span class="o">=</span><span class="mi">20</span><span class="p">))</span>  <span class="c1"># step changes speed</span>
<span class="n">display</span><span class="p">(</span><span class="n">f01</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"version_major": 2, "version_minor": 0, "model_id": "823dc9af85144125a7e0edda56f1a253"}
</script><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 600x400 with 0 Axes&gt;
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"version_major": 2, "version_minor": 0, "model_id": "1f688cd0ec124db799567752b6a0349d"}
</script><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;function __main__.wpacket(k)&gt;
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>


<script type="application/vnd.jupyter.widget-state+json">
{"state": {"123c7abc434a4c7798c6b8ca2d0be418": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "b5e96b33726f4e688949f9699b8dd50c": {"model_name": "DescriptionStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": ""}}, "823dc9af85144125a7e0edda56f1a253": {"model_name": "HTMLModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "HTMLView", "description": "", "description_tooltip": null, "layout": "IPY_MODEL_123c7abc434a4c7798c6b8ca2d0be418", "placeholder": "\u200b", "style": "IPY_MODEL_b5e96b33726f4e688949f9699b8dd50c", "value": "push triangle to start, must push (square) stop before restart "}}, "c9578094f14749248c25cf51e3382a76": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "7da7febf44d84e1baa728940e0448398": {"model_name": "DescriptionStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": ""}}, "20dc6b0c32b9470a8a76316755d04f84": {"model_name": "PlayModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "PlayModel", "_playing": false, "_repeat": false, "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "PlayView", "description": "k", "description_tooltip": null, "disabled": false, "interval": 100, "layout": "IPY_MODEL_c9578094f14749248c25cf51e3382a76", "max": 1499, "min": 0, "show_repeat": true, "step": 20, "style": "IPY_MODEL_7da7febf44d84e1baa728940e0448398", "value": 0}}, "8eee81eceacd4b0db5a6fd1152837dd6": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "1f688cd0ec124db799567752b6a0349d": {"model_name": "VBoxModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_dom_classes": ["widget-interact"], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "VBoxModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "VBoxView", "box_style": "", "children": ["IPY_MODEL_20dc6b0c32b9470a8a76316755d04f84", "IPY_MODEL_e5cb6f5d849b407bb52669653c3bf08f"], "layout": "IPY_MODEL_8eee81eceacd4b0db5a6fd1152837dd6"}}, "f8ebbf26585e40fc8a92c7527a4c05b4": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "e5cb6f5d849b407bb52669653c3bf08f": {"model_name": "OutputModel", "model_module": "@jupyter-widgets/output", "model_module_version": "1.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/output", "_model_module_version": "1.0.0", "_model_name": "OutputModel", "_view_count": null, "_view_module": "@jupyter-widgets/output", "_view_module_version": "1.0.0", "_view_name": "OutputView", "layout": "IPY_MODEL_f8ebbf26585e40fc8a92c7527a4c05b4", "msg_id": "", "outputs": [{"output_type": "display_data", "metadata": {}, "data": {"text/plain": "<Figure size 640x480 with 1 Axes>", "image/png": "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FRkZKUlasWKFTp48qXr16nmsb+lquNu0aZNat25tC0uS9PXXX6t27dpup0QBlEZgAlCpAgICJEkFBQVu29hvElmrVq0K77c815Z1PGXxwAMPqFmzZvrhhx8UERGhhIQEde3aVb/61a/UqVMnh/VF1+Prr79WUVGRevfubTu2d+9eZWZm6r777ivTVCeAq/jTAqBShYWFSZJOnz7ttk3JFJmvr6+Cg4PL1e/Zs2dlGIbLabmSfu3bl3dM9tfdqICAAK1du1aTJ0/WggULtGzZMi1btkzS1X2MRowYocmTJ5c5pM2dO1dz5861fX3o0CFJ0ieffKJVq1Y53MfWrVsd1rR9+umnCg8P98h9ATcjAhNwC6kOi76bNWsm6eoP88uXL7tc+L1v3z5JUnR0dJmrICX9FhQU6NChQ7bpLlf9+vv7O5wvufann35y23/JtSVtPaVevXqaOXOm3njjDf34449at26d0tLS9J///EevvPKKsrKytHDhwjL1dejQIZfr1Hbv3l1qsfrhw4d1+PBh29fX+9EvwK2CwAR4ifL+tpQr1WHRd6dOnSRdDTbr16932H26RMmv2Ze0LYtWrVrJ399fly5d0po1azR06FC3/bZv3962pYD9+xw8eFBZWVkuf8vuesZUHhaLRTExMYqJidETTzyhJUuW6De/+Y0WLVqkf/3rX6pTp45pHy+88ILtN/FOnz6tevXqqWvXrraxS1LDhg1VUFCgkydPeuS/KeBWwcaVgJcomZa5kUXHhmFc16tk80VPuPPOO237Cs2aNavU+VOnTunTTz+VpHJ9PEpgYKCSkpIkSbNnzy51Pj8/33Yfzv3Gx8fr9ttvdzumXbt2afXq1bJYLPr9739f5jHdCPvfXivLhwY7y8jIkGEYDoF03759ys7OVpcuXQhLQDkRmAAvUVLl+eabb6p4JDdu0qRJkqT58+frzTfftP323pkzZzRw4ECdP39eHTt2tAUge126dFFUVJRmzJhR6tyECRPk6+urdevW6a9//asuX74s6WrIHD58uA4cOKDIyEg9/vjjDtf5+fnp+eeflyRNnz5dqamptnNZWVkaMGCAioqK9Pvf/14xMTEe+R5I0quvvqp//vOftl3cS/z888+2SlFISIiaNGlS7r5LPivO1efHuarqATBRyR/FAuA6ffrpp7ZPfI+Ojja6du1qxMfHG1OnTq3qoV2X5ORk2/00bNjQaN26tREQEGBIMiIiIozMzEyX15V8pp67z2abNWuW4ePjY0gy6tata7Rp08YIDg42JBmhoaHGli1bXF5XVFRkDBkyxDamxo0bG3FxcUaNGjUMSUaLFi0cPoutrB555BG34x0zZozt/Ro0aGC0bdvWaNGihREYGGhIMvz8/IwFCxaU+z0NwzDat29v+Pr6Grm5ubZjjz32mCHJ2LBhw3X1WR6HDh0y6tSpY3uVfD6gj4+Pw/Hf/va3FT4WwBOoMAFeol+/fpo7d646dOigkydPKiMjQ6tXr7ZtfuhtXnrpJX355Zfq2bOnLl26pB9++EF33HGH/vznP2v79u2lPkakrEaOHKm1a9fqgQcekMVi0Y4dOxQaGqpRo0Zpx44datWqlcvrLBaLPvjgA73//vvq0qWLzpw5o927d6tp06b6+9//rg0bNjh8FpsnPPnkk3rxxRfVvXt31axZUz/88IN2796t8PBwPfroo9q8eXO5piVL/Pzzz9qyZYtatGih2rVr246vXbtWtWrVKtdHrVyvwsJCnT592vY6f/68JKmoqMjheE5OToWPBfAEi2FUg53sAAAAqjEqTAAAACYITAAAACYITAAAACYITAAAACYITAAAACYITAAAACb4LDkPKCoq0tGjR1W7dm0+bgAAAC9hGIbOnz+vhg0bOny+pCsEJg84evSoyw/rBAAA1V9WVpb+53/+55ptCEweULKTblZWloKDg6t4NAAAoCxyc3MVERHhsCO+OwQmDyiZhgsODiYwAQDgZcqynIZF3wAAACYITAAAACYITAAAACYITAAAACYITAAAACYITAAAACYITAAAACYITAAAACYITAAAACYITAAAACYITAAAACYITAAAACYITAAAACYITAAAACYITAAAACYITAAAACYITAAAACYITAAAACYITAAAACYITAAAACYITAAAACYITAAAACYITAAAACYITAAAACa8LjB9+OGHGjlypNq2bSur1SqLxaJ58+aVu5+ioiLNnDlTsbGxCggIUL169TRo0CDt37/f84MGAABezesC03PPPad33nlHmZmZatCgwXX3M3LkSP3pT3+SYRj605/+pN69e+uzzz5Tu3bttHfvXg+OGAAAeDuvC0xz5szRwYMHdfLkSY0aNeq6+li1apXmzJmjbt26acuWLZo2bZo+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yV5CQoIkaevWrR4YMQCv5hyYANyyvCowxcfHS5KWL19e6lxaWppDG3cKCgokud824OTJk5JEBQm41bGtAAA7XhWYunfvrujoaM2fP1/btm2zHc/JydGUKVNUs2ZNPfzww7bj2dnZ2rVrl8MUXp06ddSsWTMdOnRIc+bMcej/3Llzmj59uqT/VpoA3KKYkgNgx6sCk5+fn+bMmaOioiJ169ZNTzzxhMaOHauWLVtqz549mjJliqKiomztx48fr+bNm+vf//63Qz+vvfaa/Pz8NGLECPXo0UPPPvushg8frqZNm2rXrl3q16+fevToUcl3BwAAqiuvWvQtXa38ZGRkaOLEiVq4cKEuX76s2NhYTZs2TQMGDChTH3369NG3336rl19+WRkZGVq9erX8/f3VvHlzTZgwQU8++WQF3wWAao8KEwA7XvVZctUVnyUH3IR++9ur//zPf67+c9QoadOmqy8AN4Wb9rPkAKDSUGECYIfABADusK0AgGIEJgBwhW0FANghMAGAK0zJAbBDYAIAADBBYAIAV6gwAbBDYAIAADBBYAIAV6gwAbBDYAIAVwhMAOwQmAAAAEwQmADAFSpMAOwQmAAAAEwQmADAFSpMAOwQmAAAAEwQmADAFSpMAOwQmADAFQITADsEJgAAABMEJgBwhQoTADsEJgAAABMEJgBwhQoTADsEJgAAABMEJgBwhQoTADsEJgBwhcAEwA6BCQAAwASBCQBcocIEwA6BCQAAwASBCQBcocIEwA6BCQAAwASBCQBcocIEwA6BCQBcITABsENgAgAAMEFgAgBXqDABsENgAgAAMEFgAgBXqDABsENgAgAAMEFgAgBXqDABsENgAgBXCEwA7BCYAAAATBCYAMAVKkwA7BCYAAAATBCYAMAVKkwA7BCYAMAd58AE4JZFYAIAV1xVk6gwAbcsAhMAuMKUHAA7BCYAAAATBCYAcIUKEwA7BCYAAAATBCYAcIUKEwA7BCYAcIdtBQAUIzABgCtsKwDADoEJAFxhSg6AHQITAACACa8MTBs3blRSUpJCQ0MVGBiojh07atGiReXu58SJE3r66afVpEkT+fv7q06dOurUqZPefvvtChg1AK9ChQmAHb+qHkB5rVq1SomJifL399fAgQNVu3ZtpaamasCAAcrKytLYsWPL1M+2bdvUq1cvnT17Vvfee6/69++vvLw8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NElBQUEaM2ZMqT0GJemBBx5QXFycpGr8DD0Su1Buq1atMiRd8+WuUvHhhx8abdu2NQICAoyQkBAjKSnJ2Lx5s9v32rBhg9G7d28jODjYCAgIMNq3b1/qs3twfcryHF3hGVZ/fM+rj5LqhLvXI4884tD+3LlzxlNPPWVEREQYNWrUMBo1amSMHTvWyM3Nddl/YWGh8frrrxsxMTGG1Wo16tSpYwwYMMD46aefKuHubn5mz08uKobV8RlSYQIAADDBom8AAAATBCYAAAATBCYAAAATBCYAAAATBCYAAAATBCYAAAATBCYAAAATBCYAAAATBCYAAAATBCYAAAATBCYAcGHTpk2yWCx68803q3ooAKoBAhMAuPD5559Lku6///4qHgmA6oAP3wUAF1q0aKEaNWpo8+bNVT0UANUAFSYAN7VOnTrJYrHou+++cziem5uruLg4Wa1WrVixwuHcgQMHtGPHjlLVpXfffVe/+93vdOedd6pWrVqqX7++evbsqbVr11b4fQCoWgQmADe1adOmSZKee+4527GCggL17dtX//d//6eUlBT17NnT4ZrFixdLcpyOy8rK0ujRo3X27Fn16NFDY8aMUUJCgjIyMtSzZ09t27atwu8FQNXxq+oBAEBF6tatm+69914tWbJE6enpio+P17Bhw7Ry5UrNmDFDAwcOLHXN559/rqioKLVs2dJ2LDg4WMeOHVOdOnUc2n799dfq2bOn5s+fr7i4uIq+HQBVhAoTgJve1KlT5ePjo+eff15//vOf9fHHH2v8+PEaM2ZMqbanT59WRkZGqem4kJCQUmFJklq3bi1JOnr0aMUMHkC1QGACcNOLjY3VkCFDlJGRoVdffVWPPfaYpkyZ4rLtkiVLVFhYWCownThxQsnJyWrdurWCg4Pl4+Mji8ViC1GNGjVyaP/6668rMjJS/v7+6tKli7Zv314xNwegUjAlB+CWUK9ePUlS7dq19dZbb7ltt3jxYt12223q2rWr7dj//u//qnfv3srJyVGXLl30yCOPKDQ0VL6+vsrIyNA333yjFi1a2NrPnz9f48aN0zvvvKM2bdro5ZdfVmJiovbs2aPg4OCKu0kAFYZtBQDc9N588039v//3/1S/fn0dP35cs2bN0siRI0u1u3TpkurWravf/e53ev/99yVJhmGoWbNmOnbsmNLT021TcCX69OmjZcuWadeuXWrWrJkkqV27durcubNmzJghSbpy5YrCw8P14osvatSoURV7swAqBFNyAG5qixYtsv1G29atWxUSEqJJkybp559/LtX266+/1oULFxym43766Sft3btXSUlJpcLSDz/8oK+//lpBQUFq2rSppKu/gbd161b16NHD1s7Pz0/33HNPqa0NAHgPAhOAm9Y333yjoUOHKjY2VosXL1aDBg309NNPKzs7W6+//nqp9p9//rmsVqsSExNtx6xWq6Srwcm+IP/TTz+pX79+unLliuLi4mSxWCRJp06dUmFhoerXr+/Q9+23365jx45VxG0CqAQEJgA3pS1btqhv375q2LChli5dals79PTTT+u2227TtGnTdObMGVv7oqIiffHFF+revbuCgoJsxxs1aqROnTpp8+bN6tKli8aNG6ff//73atGihWJjYyVJrVq1qtybA1DpCEwAbjr79u1TUlKSatasqWXLlqlBgwa2c8HBwRo3bpxycnI0depU2/H169fr+PHjeuCBB0r1l5qaqgcffFA7d+7UrFmzdPbsWX3++efq06ePJDlM1dWtW1e+vr46fvy4Qx8nTpxQeHi4h+8UQGVh0TcASBo3bpxefvllHT169IaDTbt27dSlSxe99tprklj0DdwM2FYAAHR1/VKHDh08UgV6+umn9fjjj6tNmzZq3bq1pk+fLj8/Pw0ePNgDIwVQFQhMACBp165dHutr8ODBOnnypJKTk3X8+HG1bdtWaWlp7MEEeDGm5AAAAEyw6BsAAMAEgQkAAMAEgQkAAMAEgQkAAMAEgQkAAMAEgQkAAMAEgQkAAMAEgQkAAMAEgQkAAMAEgQkAAMAEgQkAAMDE/wfMwBZUjzBPDQAAAABJRU5ErkJggg==\n"}}]}}}, "version_major": 2, "version_minor": 0}
</script>


    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./chapter-11"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="num-methods-Q1-7.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Questions 1 - 7</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="num-methods-Q8-12.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Questions 8 - 12</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Godfrey Beddard<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>